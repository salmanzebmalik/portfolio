(function(g){var window=this;'use strict';var LJd=function(n){var q=new g.HR("und",new g.B$("Default","und",!0));q.captionTracks=n.captionTracks;return q},P9S=function(n){return new g.v5(function(q,M){var t=n.length,c=[];
if(t)for(var Y=function(d,N){t--;c[d]=N;t==0&&q(c)},G=function(d){M(d)},k,b=0;b<n.length;b++)k=n[b],g.ZNk(k,g.dT(Y,b),G);
else q(c)})},Dp=function(n){this.X=n},A7=function(){Dp.apply(this,arguments)},vbF=function(){A7.apply(this,arguments)},TlF=function(){A7.apply(this,arguments)},l8Q=function(){A7.apply(this,arguments)},UOF=function(){A7.apply(this,arguments)},u7Q=function(){A7.apply(this,arguments)},BlA=function(){A7.apply(this,arguments)},DOD=function(){A7.apply(this,arguments)},Atd=function(){Dp.apply(this,arguments)},mOQ=function(){A7.apply(this,arguments)},$Os=function(){A7.apply(this,arguments)},FJF=function(){A7.apply(this,
arguments)},ZCF=function(){A7.apply(this,arguments)},a8w=function(){A7.apply(this,arguments)},RwD=function(){A7.apply(this,arguments)},obn=function(){A7.apply(this,arguments)},wLS=function(){A7.apply(this,arguments)},zwd=function(){A7.apply(this,arguments)},Jts=function(){A7.apply(this,arguments)},VZF=function(){A7.apply(this,arguments)},C9n=function(){A7.apply(this,arguments)},rtS=function(){Dp.apply(this,arguments)},xOF=function(){A7.apply(this,arguments)},Qqd=function(){A7.apply(this,arguments)},
pLs=function(){A7.apply(this,arguments)},n4Q=function(){A7.apply(this,arguments)},qNs=function(){A7.apply(this,arguments)},Mgd=function(){A7.apply(this,arguments)},i1F=function(){A7.apply(this,arguments)},tgO=function(){A7.apply(this,arguments)},cbs=function(){A7.apply(this,arguments)},YNs=function(){Dp.apply(this,arguments)},GDL=function(){Dp.apply(this,arguments)},K5S=function(){Dp.apply(this,arguments)},kDD=function(){A7.apply(this,arguments)},b1L=function(){A7.apply(this,arguments)},den=function(){A7.apply(this,
arguments)},NMS=function(){A7.apply(this,arguments)},O1F=function(){A7.apply(this,arguments)},g4s=function(){A7.apply(this,arguments)},ecs=function(){A7.apply(this,arguments)},E4L=function(){A7.apply(this,arguments)},hcL=function(){A7.apply(this,arguments)},W5A=function(){A7.apply(this,arguments)},ybF=function(){A7.apply(this,arguments)},s9G=function(){A7.apply(this,arguments)},X5O=function(){A7.apply(this,arguments)},j9G=function(){A7.apply(this,arguments)},SNn=function(){A7.apply(this,arguments)},
I5w=function(){A7.apply(this,arguments)},f5n=function(){A7.apply(this,arguments)},H1G=function(){A7.apply(this,arguments)},L5K=function(){A7.apply(this,arguments)},Pgn=function(){A7.apply(this,arguments)},v4n=function(){A7.apply(this,arguments)},TMG=function(){A7.apply(this,arguments)},l5S=function(){A7.apply(this,arguments)},Ues=function(){A7.apply(this,arguments)},uGL=function(){A7.apply(this,arguments)},BMs=function(){A7.apply(this,arguments)},DeL=function(){A7.apply(this,arguments)},AbK=function(){Dp.apply(this,
arguments)},meS=function(){A7.apply(this,arguments)},$eS=function(){A7.apply(this,arguments)},F5F=function(){A7.apply(this,arguments)},Z1s=function(){A7.apply(this,arguments)},a5T=function(){A7.apply(this,arguments)},RcF=function(){A7.apply(this,arguments)},o4K=function(){A7.apply(this,arguments)},w5K=function(){A7.apply(this,arguments)},zcd=function(){A7.apply(this,arguments)},Jbn=function(){A7.apply(this,arguments)},VgD=function(){A7.apply(this,arguments)},CgQ=function(){A7.apply(this,arguments)},
rbD=function(){A7.apply(this,arguments)},xeT=function(){A7.apply(this,arguments)},Q9L=function(){A7.apply(this,arguments)},p5F=function(){A7.apply(this,arguments)},nCF=function(){A7.apply(this,arguments)},qow=function(){A7.apply(this,arguments)},MPF=function(){A7.apply(this,arguments)},iYs=function(){A7.apply(this,arguments)},tPS=function(){A7.apply(this,arguments)},cQO=function(){A7.apply(this,arguments)},YoG=function(){A7.apply(this,arguments)},GMQ=function(){A7.apply(this,arguments)},KRG=function(){A7.apply(this,
arguments)},kMd=function(){A7.apply(this,arguments)},bYT=function(){A7.apply(this,arguments)},dAO=function(){A7.apply(this,arguments)},NQF=function(){A7.apply(this,arguments)},OYs=function(){A7.apply(this,arguments)},gCF=function(){A7.apply(this,arguments)},eMT=function(){A7.apply(this,arguments)},ECn=function(){A7.apply(this,arguments)},hMD=function(){A7.apply(this,arguments)},WRn=function(n){n=n.key||n.id;
if(!n)throw Error("Entity key is missing");return n},yQA=function(){if(mF)return mF();
var n={};mF=g.rz("PersistentEntityStoreDb",{IK:(n.EntityStore={nx:1},n.EntityAssociationStore={nx:2},n),shared:!1,upgrade:function(q,M){M(1)&&g.lQ(g.fM(q,"EntityStore",{keyPath:"key"}),"entityType","entityType");M(2)&&(q=g.fM(q,"EntityAssociationStore",{keyPath:["parentEntityKey","childEntityKey"]}),g.lQ(q,"byParentEntityKey","parentEntityKey"),g.lQ(q,"byChildEntityKey","childEntityKey"))},
version:3});return mF()},s8T=function(n){return g.F0(yQA(),n)},X2T=function(n){return g.F0((0,g.nvw)(),n)},$U=function(n){this.token=n},Fk=function(n,q){q=q===void 0?{}:q;
g.aE.call(this,g.qPD[n],Object.assign({},{name:"PESEncoderError",type:n},q));this.type=n;this.level="WARNING";Object.setPrototypeOf(this,Fk.prototype)},j8w=function(n){return new Fk("WRONG_DATA_TYPE",{TI:n})},SoK=function(n){return n instanceof Error?new Fk("UNKNOWN_ENCODE_ERROR",{originalMessage:n.message}):new Fk("UNKNOWN_ENCODE_ERROR")},ImD=function(n){return n instanceof Error?new Fk("UNKNOWN_DECODE_ERROR",{originalMessage:n.message}):new Fk("UNKNOWN_DECODE_ERROR")},fmn=function(n,q){n=n instanceof
Fk?n:q(n);
g.Ly(n);throw n;},HYn=function(){},LRw=function(n,q,M){try{return n.Z(q,M)}catch(t){fmn(t,SoK)}},P$G=function(n){n=(new TextEncoder).encode(n).subarray(0,16);
var q=new Uint8Array(16);q.set(n);return q},Zp=function(n){this.X=n},TQd=function(n){var q=vCK[n];
if(q)return q;g.PJ(new g.aE("Entity model not found.",{entityType:n}))},lmS=function(n,q){this.X=n;
this.W=q;this.Z={}},uyD=function(n,q){a:{n=UAO(n.W,q.version);
try{var M=n.W(q.data,q.key);break a}catch(t){fmn(t,ImD)}M=void 0}return M},av=function(n,q,M){return n.X.objectStore("EntityStore").get(q).then(function(t){if(t){if(M&&t.entityType!==M)throw Error("Incorrect entity type");
return uyD(n,t)}})},Rv=function(n,q,M){return M?(M=M.map(function(t){return av(n,t,q)}),g.W6.all(M)):n.X.objectStore("EntityStore").index("entityType").getAll(IDBKeyRange.only(q)).then(function(t){return t.map(function(c){return uyD(n,c)})})},ws=function(n,q,M){var t=WRn(q),c=UAO(n.W,1),Y=Object.assign({},q);
return n.X.objectStore("EntityStore").get(t).then(function(G){if(G){if(G.entityType!==M)throw Error("Incorrect entity type");Y.entityMetadata||(G=uyD(n,G),Y.entityMetadata=G.entityMetadata)}}).then(function(){var G={key:t,
entityType:M,data:LRw(c,Y,t),version:1};return g.W6.all([g.P6(n.X.objectStore("EntityStore"),G),BQF(n,Y,M)])}).then(function(){ov(n,t,M);
return t})},DAA=function(n,q,M){q=q.map(function(t){return ws(n,t,M)});
return g.W6.all(q)},zA=function(n,q,M){if(M==null?0:M.gE){var t=new Set;
return AQF(n,q,t).then(function(){for(var Y=[],G=g.S(t),k=G.next();!k.done;k=G.next())Y.push(zA(n,k.value));return g.W6.all(Y).then(function(){})})}var c=g.Co(q).entityType;
return g.W6.all([n.X.objectStore("EntityStore").delete(q),mAK(n,q)]).then(function(){ov(n,q,c)})},$AQ=function(n,q){return g.Dg(n.X.objectStore("EntityStore").index("entityType"),{query:IDBKeyRange.only(q)},function(M){return g.W6.all([M.delete(),
mAK(n,M.cursor.primaryKey)]).then(function(){ov(n,M.cursor.primaryKey,q);return g.uQ(M)})})},FRD=function(n,q,M,t){var c=UAO(n.W,1);
return av(n,q,t).then(function(Y){if(Y){Y=g.iS(Y,M);var G={key:q,entityType:t,data:LRw(c,Y,q),version:1};return g.W6.all([g.P6(n.X.objectStore("EntityStore"),G),BQF(n,Y,t)])}}).then(function(){ov(n,q,t);
return q})},ov=function(n,q,M){var t=n.Z[M];
t||(t=new Set,n.Z[M]=t);t.add(q)},ZYG=function(n,q,M){var t=WRn(q);
M=TQd(M);if(!M)return g.W6.resolve([]);M=new M(q);n=n.X.objectStore("EntityAssociationStore");q=[];M=g.S(M.W());for(var c=M.next();!c.done;c=M.next())q.push(g.P6(n,{parentEntityKey:t,childEntityKey:c.value}));return g.W6.all(q).then(function(Y){return Y.map(function(G){return G[1]})})},mAK=function(n,q){return n.X.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(q))},BQF=function(n,q,M){var t=WRn(q);
return mAK(n,t).then(function(){return ZYG(n,q,M)})},AQF=function(n,q,M){if(M.has(q))return g.W6.resolve(void 0);
M.add(q);return amT(n,q).then(function(t){return n.X.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(q)).then(function(){return t})}).then(function(t){var c=g.W6.resolve(void 0);
t=g.S(t);for(var Y=t.next(),G={};!Y.done;G={PX:void 0},Y=t.next())G.PX=Y.value,c=c.then(function(k){return function(){return AQF(n,k.PX,M)}}(G));
return c}).then(function(){})},amT=function(n,q){var M=n.X.objectStore("EntityAssociationStore");
return M.index("byParentEntityKey").getAll(IDBKeyRange.only(q)).then(function(t){var c=[];t=g.S(t);for(var Y=t.next();!Y.done;Y=t.next())Y=Y.value,c.push(M.index("byChildEntityKey").getAll(Y.childEntityKey));return g.W6.all(c)}).then(function(t){var c=[];
t=g.S(t);for(var Y=t.next();!Y.done;Y=t.next())Y=Y.value,Y.length===1&&c.push(Y[0].childEntityKey);return c})},J7=function(){},RML=function(){this.X={};
this.X[0]=new J7;if(!g.EH("aes_pes_encoder_killswitch")){var n=this.X;try{var q=g.RE();var M=P$G(q);var t=new Zp(new g.bT(M),new g.dc(M))}catch(c){throw n=c instanceof Error?new Fk("KEY_CREATION_FAILED",{originalMessage:c.message}):new Fk("KEY_CREATION_FAILED"),g.Ly(n),n;}n[1]=t}},UAO=function(n,q){q=q===void 0?0:q;
n=n.X[q];if(!n)throw q=new Fk("INVALID_ENCODER_VERSION",{TI:q}),g.Ly(q),q;return n},Vq=function(n,q){g.F.call(this);
this.token=n;this.X=q;this.observers=[];n=new g.pa.BroadcastChannel("PERSISTENT_ENTITY_STORE_SYNC:"+g.RE());n.onmessage=this.W.bind(this);this.channel=n},CR=function(n,q,M){var t,c,Y,G;
return g.u(function(k){if(k.X==1)return g.U(k,s8T(n.token),2);if(k.X!=3)return t=k.W,g.U(k,g.LM(t,["EntityStore","EntityAssociationStore"],q,function(b){c=new lmS(b,n.X);return M(c)}),3);
Y=k.W;c&&(G=c.Z,Object.keys(G).length>0&&(n.channel.postMessage(G),oCw(n,G)));return k.return(Y)})},rs=function(n,q,M){return CR(n,{mode:"readwrite",
fd:!0},function(t){return ws(t,q,M)})},w2w=function(n,q){return CR(n,{mode:"readwrite",
fd:!0},function(M){return DAA(M,q,"offlineOrchestrationActionWrapperEntity")})},zMw=function(n,q){return CR(n,{mode:"readwrite",
fd:!0},function(M){return zA(M,q)})},JQA=function(n){return CR(n,{mode:"readwrite",
fd:!0},function(q){return $AQ(q,"videoPlaybackPositionEntity")})},xU=function(n,q,M){return CR(n,{mode:"readonly",
fd:!0},function(t){return av(t,q,M)})},Qq=function(n,q,M){return CR(n,{mode:"readonly",
fd:!0},function(t){return Rv(t,q,M)})},oCw=function(n,q){n=g.S(n.observers);
for(var M=n.next();!M.done;M=n.next())M=M.value,M(q)},VPS=function(){var n,q,M;
return g.u(function(t){if(t.X==1)return g.Ij(t,2),g.U(t,g.VW(),4);if(t.X!=2){n=t.W;if(!n||!g.oE()||typeof g.pa.BroadcastChannel==="undefined")return t.return();q=new RML;return t.return(new Vq(n,q))}M=g.TU(t);M instanceof Error&&g.Ly(M);return t.return()})},pR=function(){C$F||(C$F=VPS());
return C$F},rQS=function(n){var q;
n=(q=n.options)==null?void 0:q.persistenceOption;return n==="ENTITY_PERSISTENCE_OPTION_PERSIST"||n==="ENTITY_PERSISTENCE_OPTION_INMEMORY_AND_PERSIST"},xAF=function(n){var q;
return g.u(function(M){return M.X==1?g.U(M,pR(),2):(q=M.W)?g.U(M,CR(q,"readwrite",function(t){for(var c={},Y=g.S(n),G=Y.next(),k={};!G.done;k={K1:void 0,cB:void 0},G=Y.next())k.K1=G.value,k.K1.entityKey&&rQS(k.K1)&&(k.cB=g.tf(k.K1.payload),G=void 0,k.K1.type==="ENTITY_MUTATION_TYPE_REPLACE"&&(G=function(b){return function(){return ws(t,b.K1.payload[b.cB],b.cB)}}(k)),k.K1.type==="ENTITY_MUTATION_TYPE_DELETE"&&(G=function(b){return function(){return zA(t,b.K1.entityKey)}}(k)),k.K1.type==="ENTITY_MUTATION_TYPE_UPDATE"&&
(G=function(b){return function(){return FRD(t,b.K1.entityKey,b.K1.payload[b.cB],b.cB)}}(k)),G&&(c[k.K1.entityKey]=c[k.K1.entityKey]?c[k.K1.entityKey].then(G):G()));
return g.W6.all(Object.values(c))}),0):M.return()})},Q8n=function(n){var q;
return g.u(function(M){if(M.X==1){q=n.mutations;if(!q||q.length<=0)return M.return();if(g.vO){var t={type:"ENTITY_LOADED"};q!==void 0&&(t.payload=q);g.vO.dispatch(t)}return g.U(M,xAF(q),2)}q.length=0;g.Sk(M)})},p2s=function(n){return n!==void 0},nDs=function(n){var q=g.cO();
q=Object.assign({},q);n=Object.assign({},n);for(var M in q)n[M]?(q[M]!==4&&(q[M]=n[M]),delete n[M]):q[M]!==2&&(q[M]=4);Object.assign(q,n);g.wIs(q);JSON.stringify(q);return q},q$w=function(n){var q,M;
return g.u(function(t){if(t.X==1)return g.U(t,g.VW(),2);if(t.X!=3)return(q=t.W)?g.U(t,g.Kt(q),3):t.return();M=t.W;return t.return(g.LM(M,["index","media","captions"],{mode:"readwrite",fd:!0},function(c){var Y=IDBKeyRange.bound(n+"|",n+"~");c=[c.objectStore("index").delete(Y),c.objectStore("media").delete(Y),c.objectStore("captions").delete(Y)];return g.W6.all(c).then(function(){})}))})},MwO=function(){var n,q;
return g.u(function(M){if(M.X==1)return g.U(M,g.VW(),2);if(M.X!=3){n=M.W;if(!n)throw g.El("rvdfd");return g.U(M,g.Kt(n),3)}q=M.W;return M.return(g.LM(q,["index","media"],{mode:"readwrite",fd:!0},function(t){var c={};return g.Ul(t.objectStore("index"),{},function(Y){var G=Y.cursor.key.match(/^([\w\-_]+)\|(a|v)$/),k=g.W6.resolve(void 0);if(G){var b=G[1];G=G[2];c[b]=c[b]||{};var d;c[b][G]=g.rOm((d=Y.getValue())==null?void 0:d.fmts)}else k=Y.delete().then(function(){});
return g.W6.all([g.uQ(Y),k]).then(function(N){return g.S(N).next().value})}).then(function(){for(var Y={},G=g.S(Object.keys(c)),k=G.next();!k.done;k=G.next()){k=k.value;
var b=c[k].v;Y[k]=c[k].a&&b?1:2}var d=nDs(Y);return g.fDJ(t.objectStore("media"),{},function(N){var O=N.cursor.key.match(g.nWs);O&&Y[O[1]]||t.objectStore("media").delete(N.cursor.key);return g.ED1(N)}).then(function(){return d})})}))})},iOA=function(n,q){var M,t;
return g.u(function(c){if(c.X==1)return g.U(c,g.VW(),2);if(c.X!=3){M=c.W;if(!M)throw g.El("wct");return g.U(c,g.Kt(M),3)}t=c.W;return g.U(c,g.LM(t,["captions"],{mode:"readwrite",fd:!0},function(Y){var G=[];Y=Y.objectStore("captions");for(var k=0;k<q.length;k++){var b=g.P6(Y,q[k],n+"|"+q[k].metadata.vss_id);G.push(b)}return g.W6.all(G)}),0)})},twd=function(n){var q,M,t;
return g.u(function(c){if(c.X==1)return q=IDBKeyRange.bound(n+"|",n+"~"),g.U(c,g.VW(),2);if(c.X!=3){M=c.W;if(!M)throw g.El("gactfv");return g.U(c,g.Kt(M),3)}t=c.W;return c.return(t.getAll("captions",q))})},cdn=function(n){return g.u(function(q){g.GT(n,0);
return q.return(q$w(n))})},Y$G=function(n){return{context:g.Cz(),
videoIds:n}},GwS=function(n){return{context:g.Cz(),
playlistIds:n}},KXs=function(n){return{context:g.Cz(),
offlinePlaylistSyncChecks:n}},kwF=function(){this.X=new Map},dbK=function(){bOG||(bOG=new kwF);
return bOG},NET=function(n,q){return{eventType:{flowEventNamespace:"FLOW_EVENT_NAMESPACE_OFFLINE_ORCHESTRATION",
flowEventType:n},metadata:q,statusCode:void 0,csn:void 0,can:void 0}},OOQ=function(n,q,M){if(!M){var t=t===void 0?!1:t;
M=n.X.get("FLOW_TYPE_OFFLINE_ORCHESTRATION");if(!M||t)M=g.Ec(16),n.X.set("FLOW_TYPE_OFFLINE_ORCHESTRATION",M)}n={flowNonce:M,flowType:"FLOW_TYPE_OFFLINE_ORCHESTRATION",flowEventType:q.eventType};q.metadata&&(n.flowMetadata=q.metadata);q.statusCode!==void 0&&(n.flowEventStatus=q.statusCode);q.csn&&(n.csn=q.csn);q.can&&(n.can=q.can);g.tx("flowEvent",n,void 0)},gDn=function(n){var q,M,t,c,Y,G,k,b,d,N,O,e,E,h,I,L,T,v,B,m,a,x,V,bf,Ka,dd,gd,MR,lf,rd,gT,ND,V1,uf,K3,$w,zL,ku,l,uV;
return g.u(function(LQ){if(LQ.X==1)return g.U(LQ,CR(n,{mode:"readonly",fd:!0},function(t_){return Rv(t_,"playbackData").then(function(Ps){var f=Ps.map(function(aG){return aG.transfer}).filter(function(aG){return!!aG}),qR=Ps.map(function(aG){return aG.offlineVideoPolicy}).filter(function(aG){return!!aG}),v7=Ps.filter(function(aG){return!!aG.key}).map(function(aG){return g.rb(g.Co(aG.key).entityId,"downloadStatusEntity")});
f=Rv(t_,"transfer",f);qR=Rv(t_,"offlineVideoPolicy",qR);v7=Rv(t_,"downloadStatusEntity",v7);var xu=f.then(function(aG){aG=aG.reduce(function(Ca,MD){(MD==null?0:MD.offlineVideoStreams)&&Ca.push.apply(Ca,g.EJ(MD.offlineVideoStreams));return Ca},[]).filter(function(Ca){return!!Ca});
return Rv(t_,"offlineVideoStreams",aG)});
return g.W6.all([f,qR,xu,v7]).then(function(aG){var Ca=g.S(aG);aG=Ca.next().value;var MD=Ca.next().value;var cg=Ca.next().value;Ca=Ca.next().value;return[Ps,aG,MD,cg,Ca]})})}),2);
if(LQ.X!=3)return q=LQ.W,g.U(LQ,CR(n,{mode:"readonly",fd:!0},function(t_){return Rv(t_,"mainDownloadsListEntity").then(function(Ps){var f,qR;return(qR=(f=Ps[0])==null?void 0:f.downloads)!=null?qR:[]})}),3);
M=LQ.W;t=g.S(q);c=t.next().value;Y=t.next().value;G=t.next().value;k=t.next().value;b=t.next().value;d=c;N=Y;O=G;e=k;E=b;h={};I={};L={};T={};v={};B=[];m=g.S(N);for(a=m.next();!a.done;a=m.next())(x=a.value)&&(h[x.key]=x);V=g.S(O);for(bf=V.next();!bf.done;bf=V.next())(Ka=bf.value)&&(I[Ka.key]=Ka);dd=g.S(E);for(gd=dd.next();!gd.done;gd=dd.next())(MR=gd.value)&&(L[MR.key]=MR);lf=g.S(e);for(rd=lf.next();!rd.done;rd=lf.next())(gT=rd.value)&&(T[gT.key]=gT);ND=g.S(M);for(V1=ND.next();!V1.done;V1=ND.next())uf=
V1.value,K3=void 0,v[(K3=uf.videoItem)!=null?K3:""]=!0,uf.videoItem&&(zL=$w=void 0,ku=(zL=($w=g.Co(uf.videoItem))==null?void 0:$w.entityId)!=null?zL:"",B.push({externalVideoId:ku}));l=d.filter(function(t_){if(!t_||!t_.key||!t_.offlineVideoPolicy)return!1;t_=g.Co(t_.key).entityId;t_=g.rb(t_,"downloadStatusEntity");var Ps;return!(t_&&((Ps=L[t_])==null?void 0:Ps.downloadState)==="DOWNLOAD_STATE_USER_DELETED")});
uV=l.map(function(t_){var Ps=h[t_.transfer],f=[];if(Ps==null?0:Ps.offlineVideoStreams)for(var qR=g.S(Ps.offlineVideoStreams),v7=qR.next();!v7.done;v7=qR.next())(v7=T[v7.value])&&f.push(v7);qR=I[t_.offlineVideoPolicy];v7=v;var xu=t_==null?void 0:t_.playerResponseTimestamp,aG=g.Co(qR.key).entityId;t_=g.rb(aG,"mainVideoEntity");if(qR.action==="OFFLINE_VIDEO_POLICY_ACTION_DISABLE"){var Ca="OFFLINE_VIDEO_STATE_DISABLED";qR.expirationTimestamp&&Number(qR.expirationTimestamp)<Date.now()/1E3&&(Ca="OFFLINE_VIDEO_STATE_EXPIRED")}else if(qR.action===
"OFFLINE_VIDEO_POLICY_ACTION_DOWNLOAD_FAILED")Ca="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";else{switch(Ps==null?void 0:Ps.transferState){case "TRANSFER_STATE_TRANSFER_IN_QUEUE":Ca="OFFLINE_VIDEO_STATE_PENDING";break;case "TRANSFER_STATE_TRANSFERRING":Ca="OFFLINE_VIDEO_STATE_TRANSFERRING";break;case "TRANSFER_STATE_PAUSED_BY_USER":Ca="OFFLINE_VIDEO_STATE_PAUSED_TRANSFER";break;case "TRANSFER_STATE_FAILED":Ca="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";break;case "TRANSFER_STATE_COMPLETE":Ca="OFFLINE_VIDEO_STATE_PLAYABLE";
break;case "TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH":Ca="OFFLINE_VIDEO_STATE_STREAMS_OUT_OF_DATE";break;default:Ca="OFFLINE_VIDEO_STATE_UNKNOWN"}if(Ca==="OFFLINE_VIDEO_STATE_OFFLINE_FAILED")switch(Ps==null?void 0:Ps.failureReason){case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":Ca="OFFLINE_VIDEO_STATE_OUT_OF_STORAGE_ERROR";break;case "TRANSFER_FAILURE_REASON_STREAM_MISSING":Ca="OFFLINE_VIDEO_STATE_STREAMS_MISSING";break;case "TRANSFER_FAILURE_REASON_NETWORK":case "TRANSFER_FAILURE_REASON_NETWORK_LOST":Ca=
"OFFLINE_VIDEO_STATE_NETWORK_ERROR"}}aG={id:aG,videoState:Ca};if(Ps==null?0:Ps.cotn)aG.cotn=Ps.cotn;if(Ps==null?0:Ps.maximumDownloadQuality)aG.selectedVideoQuality=Ps==null?void 0:Ps.maximumDownloadQuality;if(Ps==null?0:Ps.lastProgressTimeMs)aG.lastProgressTimeMs=Ps.lastProgressTimeMs;xu&&(aG.playerResponseSavedTimeMs=String(Number(xu)*1E3));Ps=String;xu=0;f=g.S(f);for(Ca=f.next();!Ca.done;Ca=f.next())if(Ca=Ca.value,Ca.streamsProgress){Ca=g.S(Ca.streamsProgress);for(var MD=Ca.next();!MD.done;MD=Ca.next()){var cg=
void 0;xu+=Number((cg=MD.value.numBytesDownloaded)!=null?cg:0)}}aG.downloadedBytes=Ps(xu);aG.selectedOfflineMode=v7[t_]?"OFFLINE_MODE_TYPE_AUTO_OFFLINE":"OFFLINE_NOW";qR.action==="OFFLINE_VIDEO_POLICY_ACTION_DISABLE"&&(aG.offlinePlaybackDisabledReason=qR.offlinePlaybackDisabledReason);return aG});
return LQ.return({offlineVideos:uV,additionalOfflineClientState:{mainAppAdditionalOfflineClientState:{smartDownloadVideos:B}}})})},eBQ=function(){this.locks=navigator.locks},EDs=function(){try{var n=g.qD("ytglobal.locks_");
if(n)return n;var q;if(q=navigator){var M=navigator;q="locks"in M&&!!M.locks}if(q)return g.pa.localStorage&&g.pa.localStorage.getItem("noop"),n=new eBQ,g.nQ("ytglobal.locks_",n),n}catch(t){}},nG=function(){},hBK=function(){},WXO=function(n){if(n.includes(":"))throw Error("Invalid user cache name: "+n);
return n+":"+g.RE("CacheStorage get")},ydL=function(){return g.u(function(n){if(qx!==void 0)return n.return(qx);
qx=new Promise(function(q){var M;return g.u(function(t){switch(t.X){case 1:return g.Ij(t,2),g.U(t,Mx.open("test-only"),4);case 4:return g.U(t,Mx.delete("test-only"),5);case 5:g.vd(t,3);break;case 2:if(M=g.TU(t),M instanceof Error&&M.name==="SecurityError")return q(!1),t.return();case 3:q("caches"in window),g.Sk(t)}})});
return n.return(qx)})},XCK=function(){return g.u(function(n){if(n.X==1)return g.U(n,ydL(),2);
if(!n.W)return n.return(void 0);sDF||(sDF=new hBK);return n.return(sDF)})},iH=function(n,q,M){g.PJ(new g.aE("Woffle: "+n,M?{cotn:M}:""));
q instanceof Error&&g.PJ(q)},jDw=function(n){var q;
return g.u(function(M){if(M.X==1)return g.U(M,gDn(n),2);q=M.W;g.tx("offlineStateSnapshot",q);g.Sk(M)})},t6=function(n){g.F.call(this);
var q=this;this.api=n;this.vg={k9E:function(){return q.X},
zbJ:function(){return q.W}};
typeof g.pa.BroadcastChannel!=="undefined"&&(this.X=new g.pa.BroadcastChannel("PLAYER_OFFLINE_ERROR_SYNC:"+g.RE()),this.X.onmessage=this.Z.bind(this),this.W=new g.pa.BroadcastChannel("PLAYER_OFFLINE_PAUSE_SYNC:"+g.RE()),this.W.onmessage=this.J.bind(this))},c1=function(n,q){n.api.Km("onOfflineOperationFailure",q);
var M;(M=n.X)==null||M.postMessage(q)},S$O=function(n,q,M){var t=this;
this.B=n;this.U=q;this.visibility=M;this.S=this.N=this.C=this.Z=this.X=!1;this.J=new g.zw(function(){t.Rb()});
this.vg={S5:function(){return t.W},
Rb:function(){t.Rb()},
fYy:function(){return t.J}};
this.visibility.subscribe("visibilitystatechange",function(){t.Lu()})},IDO=function(n){if(!n.Z&&!n.X){var q=EDs();
if(q){n.Z=!0;var M=g.RE("OfflineLockManager");q.request("woffle_orchestration_leader:"+M,{},function(){var t,c;return g.u(function(Y){switch(Y.X){case 1:return g.Ij(Y,2),n.W=new g.NA,n.X=!0,n.Z=!1,g.U(Y,n.B(),4);case 4:return g.U(Y,n.W.promise,5);case 5:g.vd(Y,0);break;case 2:t=g.TU(Y),n.Rb(),t instanceof Error&&(c=t,c.args=[{name:"WoLockManagerError",DL:t.name}],g.Ly(c)),g.Sk(Y)}})})}}},fDF=function(n){n.X&&(n.S=!0,Y_(n))},HOT=function(n,q){n.X&&(n.C=q,Y_(n))},LXT=function(n,q){n.X&&(n.N=q,Y_(n))},
Y_=function(n){n.N&&n.C&&n.S&&n.visibility.isBackground()?g.Jd(n.J,6E4):n.J.stop()},G9=function(n){var q;
n.offlineDeleteReason=(q=n.offlineDeleteReason)!=null?q:"OFFLINE_DELETE_REASON_UNKNOWN";var M;n.offlineModeType=(M=n.offlineModeType)!=null?M:"OFFLINE_NOW";g.tx("offlineDeleteEvent",n)},KG=function(n,q){var M=q.videoId;
var t=q.Qw;q=q.offlineModeType;n.encryptedVideoId=M;n.cotn=t==null?void 0:t.cotn;n.offlineabilityFormatType=t==null?void 0:t.maximumDownloadQuality;var c;n.isRefresh=(c=t==null?void 0:t.isRefresh)!=null?c:!1;var Y;n.softErrorCount=(Y=t==null?void 0:t.transferRetryCount)!=null?Y:0;n.offlineModeType=q!=null?q:"OFFLINE_NOW";(n.transferStatusType==="TRANSFER_STATUS_TYPE_UNKNOWN"&&n.statusType==="UNKNOWN_STATUS_TYPE"||!n.transferStatusType&&!n.statusType)&&g.PJ(Error("Woffle unknown transfer status"));
g.tx("offlineTransferStatusChanged",n)},PMs=function(n){KG({transferStatusType:"TRANSFER_STATUS_TYPE_ENQUEUED",
statusType:"ADDED_TO_QUEUE"},n)},vDA=function(n,q,M,t){t={transferStatusType:"TRANSFER_STATUS_TYPE_PROCESSING",
statusType:"OFFLINING_STARTED",transferFirstStarted:!!t};q&&M&&(q=Math.floor(q/1024).toFixed(),M=Math.floor(M/1024).toFixed(),t.alreadyDownloadedKbytes=q,t.totalFetchedKbytes=q,t.totalContentKbytes=M);KG(t,n)},TEw=function(n){KG({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_PLAYER_RESPONSE_REFRESH"},n)},lDn=function(n){KG({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_USER_PAUSE",
statusType:"SUSPENDED"},n)},UbK=function(n){switch(n){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":return"OFFLINE_DATABASE_ERROR";
case "TRANSFER_FAILURE_REASON_PLAYABILITY":return"NOT_PLAYABLE";case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":return"TOO_MANY_RETRIES";case "TRANSFER_FAILURE_REASON_INTERNAL":return"OFFLINE_DOWNLOAD_CONTROLLER_ERROR";case "TRANSFER_FAILURE_REASON_STREAM_MISSING":return"STREAM_VERIFICATION_FAILED";case "TRANSFER_FAILURE_REASON_SERVER":case "TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING":return"OFFLINE_REQUEST_FAILURE";case "TRANSFER_FAILURE_REASON_NETWORK":return"OFFLINE_NETWORK_ERROR";default:return"UNKNOWN_FAILURE_REASON"}},
k_=function(n){var q,M,t;
return((t=(q=n.actionMetadata)==null?void 0:(M=q.retryScheduleIntervalsInSeconds)==null?void 0:M.length)!=null?t:0)>0},bH=function(n){return n.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD"&&!!n.entityKey},dR=function(n){return n.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&!!n.entityKey},Nx=function(n){return n.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&!!n.entityKey},uWT=function(n){return n.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE"&&!!n.entityKey},
OB=function(n,q,M,t,c){c=c===void 0?!1:c;
var Y,G,k,b,d,N;return g.u(function(O){if(O.X==1)return Y=g.rb(n,q),G=g.rb(n,"downloadStatusEntity"),g.U(O,CR(M,{mode:"readonly",fd:!0},function(e){return g.W6.all([av(e,Y,q),av(e,G,"downloadStatusEntity")])}),2);
k=O.W;b=k.length?k[0]:void 0;if(!b)return O.Fy(0);d=BEL;if(N=k.length>1?k[1]:void 0){if(N.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&!c)return O.return();N.downloadState=t}else N={key:G,downloadState:t};g.uo(b,d,N);return g.U(O,CR(M,{mode:"readwrite",fd:!0},function(e){return g.W6.all([ws(e,b,q),ws(e,N,"downloadStatusEntity")])}),0)})},gR=function(n,q){return n.actionType===q.actionType&&n.entityKey===q.entityKey},eD=function(n,q){if(n&&n.transferState!=="TRANSFER_STATE_COMPLETE"&&n.transferState!==
"TRANSFER_STATE_FAILED"){var M=g.Co(n.key).entityId;
KG({transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_BY_USER",statusType:"CANCELLED"},{videoId:M,Qw:n,offlineModeType:q})}},EB=function(n){if(!n||!n.thumbnails)return[];
var q=[];n=g.S(n.thumbnails);for(var M=n.next();!M.done;M=n.next())M=M.value,M.url&&q.push(M.url);return q},Dbs=function(n,q,M){M=M===void 0?[]:M;
var t,c,Y,G,k,b,d,N,O,e,E,h,I;return g.u(function(L){if(L.X==1)return M.length?g.U(L,Qq(n,q),2):L.return([]);t=L.W;c=new Set;Y=g.S(t);for(G=Y.next();!G.done;G=Y.next())if(k=G.value,b=k.id||k.key)d=g.Co(b).entityId,c.add(d);N=[];O=g.S(M);for(e=O.next();!e.done;e=O.next())E=e.value,h=E.offlineVideoData,I=void 0,((I=h)==null?0:I.videoId)&&!c.has(h.videoId)&&N.push(E);return L.return(N)})},AdS=function(n,q,M){return new g.sh(n,{cotn:q,
raw_player_response:M,download_media:!0,start:Infinity,disable_watch_next:!0})},mbd=function(){return{priority:1,
retryScheduleIntervalsInSeconds:[1,2,4]}},h6=function(n,q,M,t,c,Y,G,k,b,d,N){this.entityType=n;
this.actionId=q;this.action=M;this.parentActionId=t;this.rootActionId=c===void 0?q:c;this.childActionIds=Y;this.prereqActionId=G;this.postreqActionIds=k;this.hasChildActionFailed=d;this.retryScheduleIndex=0;this.X=N||Date.now();this.retryScheduleIndex=b||0},W1=function(n){if(!n.key)throw Error("Entity key is required.");
if(!n.actionProto)throw Error("OfflineOrchestrationAction is required.");var q=g.Co(n.key),M=g.Co(n.actionProto.entityKey);return new h6(M.entityType,q.entityId,n.actionProto,n.parentActionId,n.rootActionId,n.childActionIds,n.prereqActionId,n.postreqActionIds,n.retryScheduleIndex,n.hasChildActionFailed,Number(n.enqueueTimeSec)*1E3)},yF=function(n){return{key:g.rb(n.actionId,"offlineOrchestrationActionWrapperEntity"),
actionProto:n.action,parentActionId:n.parentActionId,rootActionId:n.rootActionId,childActionIds:n.childActionIds,prereqActionId:n.prereqActionId,postreqActionIds:n.postreqActionIds,retryScheduleIndex:n.retryScheduleIndex,hasChildActionFailed:n.hasChildActionFailed,enqueueTimeSec:(n.X/1E3).toFixed()}},$bs=function(){var n;
return g.u(function(q){return q.X==1?g.U(q,XCK(),2):(n=q.W)?q.return(n.delete("yt-player-local-img")):q.return(!0)})},sB=function(n){var q,M;
return g.u(function(t){if(t.X==1)return g.U(t,XCK(),2);if(t.X!=3){q=t.W;if(!q)throw Error("Cache API not supported");return n.length?g.U(t,q.open("yt-player-local-img"),3):t.return()}M=t.W;return g.U(t,Promise.all(n.map(function(c){return M.delete(c)})),0)})},XZ=function(n){var q,M;
return g.u(function(t){if(t.X==1)return g.U(t,XCK(),2);if(t.X!=3){q=t.W;if(!q)throw Error("Cache API not supported");return n.length?g.U(t,q.open("yt-player-local-img"),3):t.return()}M=t.W;return g.U(t,M.addAll(n),0)})},jD=function(n,q,M,t,c){var Y,G,k,b,d,N,O,e,E,h,I,L,T,v,B,m,a,x,V,bf,Ka,dd,gd,MR,lf,rd,gT,ND,V1,uf,K3;
return g.u(function($w){switch($w.X){case 1:return Y=g.rb(n,"mainVideoEntity"),G=g.rb(n,"ytMainChannelEntity"),k=g.rb(n,"transfer"),b=g.rb(n,"videoDownloadContextEntity"),g.U($w,CR(q,{mode:"readonly",fd:!0},function(zL){return g.W6.all([av(zL,Y,"mainVideoEntity"),av(zL,G,"ytMainChannelEntity"),av(zL,k,"transfer"),av(zL,b,"videoDownloadContextEntity"),Rv(zL,"ytMainChannelEntity"),Rv(zL,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:d=$w.W;N=g.S(d);O=N.next().value;e=N.next().value;E=N.next().value;h=N.next().value;I=N.next().value;L=N.next().value;T=O;v=e;B=E;m=h;a=I;x=L;if(!T&&!v){$w.Fy(3);break}V=T?EB(T.thumbnail):[];if(!v){bf=[];$w.Fy(4);break}return g.U($w,FXw(v,a),5);case 5:bf=$w.W;case 4:return Ka=bf,g.U($w,sB(V.concat(Ka)),3);case 3:dd=[];gd=g.rb(n,"downloadStatusEntity");MR=g.S(x);for(lf=MR.next();!lf.done;lf=MR.next())rd=lf.value,gT=g.Co(rd.key).entityId,ND=W1(rd),V1=g.Co(ND.action.entityKey).entityId,gT!==n&&
V1!==n||gR(M,rd.actionProto)||dd.push(rd.key);return g.U($w,CR(q,{mode:"readwrite",fd:!0},function(zL){var ku=dd.map(function(l){return zA(zL,l)});
ku.push(zA(zL,Y,{gE:!0}));ku.push(zA(zL,gd,{gE:!0}));return g.W6.all(ku)}),7);
case 7:K3=(uf=m)==null?void 0:uf.offlineModeType,c&&(G9(c),c.offlineModeType&&(K3=c.offlineModeType)),eD(B,K3),c1(t,{entityKey:Y,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"}),g.Sk($w)}})},RBL=function(n,q,M,t){var c,Y,G,k,b,d,N,O,e,E,h,I,L,T,v,B,m,a,x,V,bf,Ka,dd,gd,MR,lf,rd,gT,ND,V1,uf,K3,$w,zL,ku,l,uV,LQ,t_,Ps,f,qR,v7,xu,aG,Ca,MD,cg,w0,H;
return g.u(function(X){switch(X.X){case 1:return c=g.rb(n,"mainPlaylistEntity"),Y=g.rb(n,"ytMainChannelEntity"),g.U(X,CR(q,{mode:"readonly",fd:!0},function(P){return g.W6.all([av(P,c,"mainPlaylistEntity"),av(P,Y,"ytMainChannelEntity"),Rv(P,"mainPlaylistEntity"),Rv(P,"mainDownloadsListEntity"),Rv(P,"ytMainChannelEntity"),Rv(P,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:G=X.W;k=g.S(G);b=k.next().value;d=k.next().value;N=k.next().value;O=k.next().value;e=k.next().value;E=k.next().value;h=b;I=d;L=N;T=O;v=e;B=E;if(!h&&!I){X.Fy(3);break}m=h?ZOA(h):[];if(!I){a=[];X.Fy(4);break}return g.U(X,FXw(I,v),5);case 5:a=X.W;case 4:return x=a,g.U(X,sB(m.concat(x)),3);case 3:V=[];bf=new Map;if(!h){X.Fy(7);break}return g.U(X,aDS(h,L,T),8);case 8:V=X.W;Ka=g.S(V);for(dd=Ka.next();!dd.done;dd=Ka.next())gd=dd.value,bf.set(gd,{videoId:gd,playlistId:n,offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});
return g.U(X,CR(q,{mode:"readonly",fd:!0},function(P){return g.W6.all([Rv(P,"transfer"),Rv(P,"videoDownloadContextEntity")])}),9);
case 9:MR=X.W;lf=g.S(MR);rd=lf.next().value;gT=lf.next().value;ND=rd;V1=gT;uf=g.S(ND);for(K3=uf.next();!K3.done;K3=uf.next())$w=K3.value,zL=g.Co($w.key).entityId,(ku=bf.get(zL))&&$w&&(ku.cotn=$w.cotn);l=g.S(V1);for(uV=l.next();!uV.done;uV=l.next())LQ=uV.value,t_=g.Co(LQ.key).entityId,(Ps=bf.get(t_))&&LQ&&(Ps.offlineModeType=LQ.offlineModeType);case 7:f=[];qR=g.S(B);for(v7=qR.next();!v7.done;v7=qR.next())xu=v7.value,aG=g.Co(xu.key).entityId,Ca=W1(xu),aG!==n&&Ca.rootActionId!==n||gR(M,xu.actionProto)||
f.push(xu.key);MD=g.rb(n,"mainPlaylistEntity");return g.U(X,CR(q,{mode:"readwrite",fd:!0},function(P){var D=f.map(function(J){return zA(P,J)});
D.push(zA(P,MD,{gE:!0}));return g.W6.all(D)}),10);
case 10:if(!h){X.Fy(0);break}V.reverse();if(!V){X.Fy(0);break}cg=g.S(V);w0=cg.next();case 13:if(w0.done){X.Fy(0);break}H=w0.value;return g.U(X,jD(H,q,M,t,bf.get(H)),14);case 14:w0=cg.next(),X.Fy(13)}})},wCF=function(n,q,M,t){var c,Y,G,k,b,d,N,O,e;
return g.u(function(E){if(E.X==1)return c=g.rb("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),Y=new Map,g.U(E,CR(n,{mode:"readwrite",fd:!0},function(h){var I=Rv(h,"transfer"),L=Rv(h,"offlineOrchestrationActionWrapperEntity"),T=Rv(h,"videoDownloadContextEntity"),v=av(h,c,"mainDownloadsListEntity");return g.W6.all([I,L,T,v]).then(function(B){B=g.S(B);var m=B.next().value;var a=B.next().value;var x=B.next().value;var V=B.next().value;B=oDL.map(function(Ka){return $AQ(h,Ka)});
a=g.S(a);for(var bf=a.next();!bf.done;bf=a.next())bf=bf.value,gR(q,bf.actionProto)||B.push(zA(h,bf.key,{gE:!0}));V&&(V.downloads=[],B.push(ws(h,V,"mainDownloadsListEntity")));if(x)for(x=g.S(x),V=x.next();!V.done;V=x.next())V=V.value,a=g.Co(V.key).entityId,a=g.rb(a,"transfer"),Y.set(a,V.offlineModeType);return g.W6.all(B).then(function(){return m})})}),2);
G=E.W;k=g.S(G);for(b=k.next();!b.done;b=k.next())d=b.value,eD(d,Y.get(d.key)),N=g.Co(d.key).entityId,O={videoId:N,offlineDeleteReason:t,cotn:d.cotn,offlineModeType:Y.get(d.key)},G9(O),e=g.rb(N,"mainVideoEntity"),c1(M,{entityKey:e,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});return g.U(E,$bs(),0)})},ZOA=function(n,q){var M=[];
if(n.thumbnailStyleData){n=g.S(n.thumbnailStyleData);for(var t=n.next();!t.done;t=n.next()){var c=void 0,Y=void 0,G=void 0;M=M.concat(EB((c=t.value)==null?void 0:(Y=c.value)==null?void 0:(G=Y.collageThumbnail)==null?void 0:G.coverThumbnail))}}q=EB(q);return M.concat(q)},aDS=function(n,q,M){var t,c,Y,G,k,b,d,N,O,e,E,h,I,L,T,v,B,m,a,x,V,bf,Ka;
return g.u(function(dd){t=[];c=new Set;if(M.length)for(Y=g.S(M),G=Y.next();!G.done;G=Y.next())if(k=G.value,b=void 0,(b=k.downloads)==null?0:b.length)for(d=g.S(k.downloads),N=d.next();!N.done;N=d.next())O=N.value,O.videoItem&&(e=g.Co(O.videoItem).entityId,c.add(e));if(n.videos){E=g.S(n.videos);for(h=E.next();!h.done;h=E.next())I=h.value,L=JSON.parse(g.Co(I).entityId),L.videoId&&!c.has(L.videoId)&&t.push(L.videoId);T=g.S(q);for(v=T.next();!v.done;v=T.next())if(B=v.value,B.key!==n.key&&(m=B.videos))for(a=
g.S(m),x=a.next();!x.done;x=a.next())V=x.value,bf=JSON.parse(g.Co(V).entityId),bf.videoId&&(Ka=t.indexOf(bf.videoId),Ka!==-1&&t.splice(Ka,1))}return dd.return(t)})},FXw=function(n,q){var M,t,c,Y,G,k,b,d;
return g.u(function(N){M=EB(n.avatar);t=g.S(q);for(c=t.next();!c.done;c=t.next())if(Y=c.value,Y.id!==n.id)for(G=g.S(EB(Y.avatar)),k=G.next();!k.done;k=G.next())b=k.value,d=M.indexOf(b),d!==-1&&M.splice(d,1);return N.return(M)})},zBQ=function(n){var q;
return g.u(function(M){q=g.R(n.frameworkUpdates,SD);return n.frameworkUpdates&&q?g.U(M,Q8n(q),0):M.return()})},Vwd=function(n){var q;
if((q=n.onResponseReceivedActions)!=null&&q.length){var M;n=(M=g.R(g.R(n.onResponseReceivedActions[0],JdL),g.CPF))==null?void 0:M.actions;if(n!=null&&n.length)return n}},CMn=function(n){var q,M,t;
return g.u(function(c){if(c.X==1)return n?g.U(c,xU(n,g.mj,"mainDownloadsListEntity"),2):c.return([]);q=c.W;return((M=q)==null?0:(t=M.downloads)==null?0:t.length)?c.return(q.downloads.map(function(Y){var G;return(G=Y.videoItem)!=null?G:""})):c.return([])})},xbs=function(n,q){var M;
return g.u(function(t){return t.X==1?g.U(t,rdT(n,q),2):(M=t.W)?g.U(t,CR(n,{mode:"readwrite",fd:!0},function(c){var Y=[ws(c,M.mainDownloadsLibraryEntity,"mainDownloadsLibraryEntity")];M.mainDownloadsListEntity&&Y.push(ws(c,M.mainDownloadsListEntity,"mainDownloadsListEntity"));return g.W6.all(Y)}),0):t.Fy(0)})},rdT=function(n,q){var M,t,c,Y,G,k,b,d,N,O,e,E,h,I,L,T,v,B;
return g.u(function(m){if(m.X==1)return M=g.rb("main_downloads_library_id","mainDownloadsLibraryEntity"),t=g.rb("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),g.U(m,CR(n,{mode:"readonly",fd:!0},function(a){return g.W6.all([av(a,M,"mainDownloadsLibraryEntity"),av(a,t,"mainDownloadsListEntity")])}),2);
c=m.W;Y=g.S(c);G=Y.next().value;k=Y.next().value;b=G;d=k;b||(b={id:M});N=g.S(q);for(O=N.next();!O.done;O=N.next())if(e=O.value,e===g.mj){if(b.smartDownloadsList)return m.return();b.smartDownloadsList=e}else if(E=g.Co(e).entityType,h={},E==="mainPlaylistEntity"?h.playlistItem=e:E==="mainVideoEntity"&&(h.videoItem=e),!g.g0(h)){I=void 0;if((I=d)==null?0:I.downloads){L=!1;T=g.S(d.downloads);for(v=T.next();!v.done;v=T.next())if(B=v.value,B.playlistItem===e||B.videoItem===e){L=!0;break}L||d.downloads.push(h)}else d=
{id:t,downloads:[h]};b.downloadsList=t}return m.return({mainDownloadsLibraryEntity:b,mainDownloadsListEntity:d})})},QDK=function(n,q){var M,t,c,Y,G,k,b,d,N,O,e,E,h,I,L;
return g.u(function(T){if(T.X==1)return M=g.rb("main_downloads_library_id","mainDownloadsLibraryEntity"),t=g.rb("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),g.U(T,CR(n,{mode:"readonly",fd:!0},function(v){return g.W6.all([av(v,M,"mainDownloadsLibraryEntity"),av(v,t,"mainDownloadsListEntity"),av(v,g.mj,"mainDownloadsListEntity")])}),2);
c=T.W;Y=g.S(c);G=Y.next().value;k=Y.next().value;b=Y.next().value;d=G;N=k;O=b;if(!d)return T.Fy(0);if(q===g.mj&&((e=O)==null?0:e.downloads))O.downloads=[];else if((E=N)==null?0:E.downloads)for(h=g.Co(q).entityType,I=0;I<N.downloads.length;I++)if(L=N.downloads[I],h==="mainVideoEntity"&&L.videoItem===q){N.downloads.splice(I,1);break}else if(h==="mainPlaylistEntity"&&L.playlistItem===q){N.downloads.splice(I,1);break}return g.U(T,CR(n,{mode:"readwrite",fd:!0},function(v){var B=[ws(v,d,"mainDownloadsLibraryEntity")];
N&&B.push(ws(v,N,"mainDownloadsListEntity"));O&&B.push(ws(v,O,"mainDownloadsListEntity"));return g.W6.all(B)}),0)})},IC=function(n,q){var M,t,c,Y,G,k,b,d,N,O,e;
return g.u(function(E){if(E.X==1)return M=g.rb(q,"transfer"),t=g.rb(q,"videoDownloadContextEntity"),g.U(E,CR(n,{mode:"readonly",fd:!0},function(h){return g.W6.all([av(h,M,"transfer"),av(h,t,"videoDownloadContextEntity")])}),2);
c=E.W;Y=g.S(c);G=Y.next().value;k=Y.next().value;b=G;d=k;e={videoId:q,cotn:(N=b)==null?void 0:N.cotn,offlineModeType:(O=d)==null?void 0:O.offlineModeType};return E.return(e)})},fG=function(n,q,M,t,c){var Y,G,k,b,d,N,O,e,E,h,I,L,T,v,B,m,a,x,V,bf;
return g.u(function(Ka){switch(Ka.X){case 1:return Y=g.rb(n,"musicTrack"),G=g.rb(n,"transfer"),g.U(Ka,CR(q,{mode:"readonly",fd:!0},function(dd){return g.W6.all([av(dd,Y,"musicTrack"),av(dd,G,"transfer"),Rv(dd,"musicTrack"),Rv(dd,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:k=Ka.W;b=g.S(k);d=b.next().value;N=b.next().value;O=b.next().value;e=b.next().value;E=d;h=N;I=O;L=e;if(!E){Ka.Fy(3);break}return g.U(Ka,pCL(E,I),4);case 4:return T=Ka.W,g.U(Ka,sB(T),3);case 3:v=[];B=g.S(L);for(m=B.next();!m.done;m=B.next())a=m.value,x=g.Co(a.key).entityId,V=W1(a),bf=g.Co(V.action.entityKey).entityId,x!==n&&bf!==n||gR(M,a.actionProto)||v.push(a.key);return g.U(Ka,CR(q,{mode:"readwrite",fd:!0},function(dd){var gd=v.map(function(MR){return zA(dd,MR)});
gd.push(zA(dd,Y,{gE:!0}));return g.W6.all(gd)}),6);
case 6:eD(h),c&&G9(c),c1(t,{entityKey:Y,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"}),g.Sk(Ka)}})},H1=function(n,q,M,t,c){var Y,G,k,b,d,N,O,e,E,h,I,L,T,v,B,m,a,x,V,bf,Ka,dd,gd,MR,lf,rd,gT,ND,V1,uf,K3,$w,zL,ku,l,uV;
return g.u(function(LQ){switch(LQ.X){case 1:return Y=g.rb(n,q),G=g.rb("music_downloads_library_id","musicDownloadsLibraryEntity"),g.U(LQ,CR(M,{mode:"readonly",fd:!0},function(t_){return g.W6.all([av(t_,Y,q),av(t_,G,"musicDownloadsLibraryEntity"),Rv(t_,q),Rv(t_,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:k=LQ.W;b=g.S(k);d=b.next().value;N=b.next().value;O=b.next().value;e=b.next().value;E=d;h=N;I=O;L=e;if(!E){LQ.Fy(3);break}return g.U(LQ,pCL(E,I),4);case 4:return T=LQ.W,g.U(LQ,sB(T),3);case 3:v=[];B=new Map;if(!E){LQ.Fy(6);break}return g.U(LQ,niQ(E,I,h),7);case 7:v=LQ.W;m=g.S(v);for(a=m.next();!a.done;a=m.next())x=a.value,V=g.Co(x).entityId,B.set(V,{videoId:V,playlistId:n,offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});return g.U(LQ,Qq(M,"transfer"),8);case 8:for(bf=LQ.W,Ka=
g.S(bf),dd=Ka.next();!dd.done;dd=Ka.next())gd=dd.value,MR=g.Co(gd.key).entityId,(lf=B.get(MR))&&gd&&(lf.cotn=gd.cotn);case 6:rd=[];gT=g.S(L);for(ND=gT.next();!ND.done;ND=gT.next())V1=ND.value,uf=g.Co(V1.key).entityId,K3=W1(V1),uf!==n&&K3.rootActionId!==n||gR(t,V1.actionProto)||rd.push(V1.key);$w=g.rb(n,q);return g.U(LQ,CR(M,{mode:"readwrite",fd:!0},function(t_){var Ps=rd.map(function(f){return zA(t_,f)});
Ps.push(zA(t_,$w,{gE:!0}));return g.W6.all(Ps)}),9);
case 9:if(!E){LQ.Fy(0);break}v.reverse();if(!v.length){LQ.Fy(0);break}zL=g.S(v);ku=zL.next();case 12:if(ku.done){LQ.Fy(0);break}l=ku.value;uV=g.Co(l).entityId;if(!uV){LQ.Fy(13);break}return g.U(LQ,fG(uV,M,t,c,B.get(uV)),13);case 13:ku=zL.next(),LQ.Fy(12)}})},LG=function(n,q,M){var t,c,Y,G,k,b,d;
return g.u(function(N){if(N.X==1)return g.U(N,CR(n,{mode:"readwrite",fd:!0},function(O){var e=Rv(O,"transfer"),E=Rv(O,"offlineOrchestrationActionWrapperEntity");return g.W6.all([e,E]).then(function(h){h=g.S(h);var I=h.next().value;var L=h.next().value;h=qXK.map(function(m){return $AQ(O,m)});
L=g.S(L);for(var T=L.next();!T.done;T=L.next()){T=T.value;var v=g.Co(T.actionProto.entityKey).entityType==="musicTrack",B=T.actionProto.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD";gR(q,T.actionProto)||v&&(!v||B)||h.push(zA(O,T.key,{gE:!0}))}return g.W6.all(h).then(function(){return I})})}),2);
t=N.W;c=g.S(t);for(Y=c.next();!Y.done;Y=c.next())G=Y.value,eD(G),k=g.Co(G.key).entityId,b={videoId:k,offlineDeleteReason:void 0,cotn:G.cotn},G9(b),d=g.rb(k,"musicTrack"),c1(M,{entityKey:d,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});return g.U(N,$bs(),0)})},MAd=function(n){for(var q,M=g.S(n.additionalMetadatas),t=M.next();!t.done;t=M.next())t=t.value,t.offlineMusicVideoData&&(q=t.offlineMusicVideoData);
var c,Y,G,k,b;return{id:g.rb(n.videoId,"musicTrack"),videoId:n.videoId,title:n.title,thumbnailDetails:n.thumbnail,lengthMs:String(Number(n.lengthSeconds)*1E3),albumTitle:(c=q)==null?void 0:c.releaseTitle,musicVideoType:(Y=q)==null?void 0:Y.musicVideoType,contentRating:{explicitType:(G=q)==null?void 0:G.explicitType},artistNames:((k=q)==null?void 0:k.byline)||((b=q)==null?void 0:b.channelName),downloadMetadata:g.rb(n.videoId,"musicTrackDownloadMetadataEntity")}},niQ=function(n,q,M){var t,c,Y,G,k,b,
d,N,O,e,E,h,I,L,T,v,B,m;
return g.u(function(a){t=[];c=new Set;if((Y=M)==null?0:(G=Y.downloadedTracks)==null?0:G.length)for(k=g.S(M.downloadedTracks),b=k.next();!b.done;b=k.next())d=b.value,c.add(d);if(n.tracks){N=g.S(n.tracks);for(O=N.next();!O.done;O=N.next())e=O.value,c.has(e)||t.push(e);E=g.S(q);for(h=E.next();!h.done;h=E.next())if(I=h.value,I.id!==n.id&&(L=I.tracks))for(T=g.S(L),v=T.next();!v.done;v=T.next())B=v.value,m=t.indexOf(B),m!==-1&&t.splice(m,1)}return a.return(t)})},pCL=function(n,q){var M,t,c,Y,G,k,b,d;
return g.u(function(N){M=EB(n.thumbnailDetails);t=g.S(q);for(c=t.next();!c.done;c=t.next())if(Y=c.value,Y.id!==n.id)for(G=g.S(EB(Y.thumbnailDetails)),k=G.next();!k.done;k=G.next())b=k.value,d=M.indexOf(b),d!==-1&&M.splice(d,1);return N.return(M)})},i4S=function(n,q){var M,t,c,Y,G,k,b,d,N;
return g.u(function(O){if(O.X==1)return M=g.rb("music_downloads_library_id","musicDownloadsLibraryEntity"),g.U(O,xU(n,M,"musicDownloadsLibraryEntity"),2);(t=O.W)||(t={id:M});c=g.Co(q).entityType;c==="musicTrack"?(Y=t.downloadedTracks)!=null&&Y.includes(q)||(t.downloadedTracks=((G=t.downloadedTracks)!=null?G:[]).concat(q)):c==="musicPlaylist"?(k=t.downloadedPlaylists)!=null&&k.includes(q)||(t.downloadedPlaylists=((b=t.downloadedPlaylists)!=null?b:[]).concat(q)):c!=="musicAlbumRelease"||(d=t.downloadedAlbumReleases)!=
null&&d.includes(q)||(t.downloadedAlbumReleases=((N=t.downloadedAlbumReleases)!=null?N:[]).concat(q));return g.U(O,rs(n,t,"musicDownloadsLibraryEntity"),0)})},tAG=function(n,q){var M,t,c,Y,G,k,b;
return g.u(function(d){if(d.X==1)return M=g.rb("music_downloads_library_id","musicDownloadsLibraryEntity"),g.U(d,xU(n,M,"musicDownloadsLibraryEntity"),2);t=d.W;if(!t)return d.Fy(0);c=g.Co(q).entityType;c==="musicTrack"?Y=t.downloadedTracks:c==="musicPlaylist"&&(Y=t.downloadedPlaylists);if((G=Y)==null?0:G.length)for(k=0;k<Y.length;k++)if(b=Y[k],b===q){Y.splice(k,1);break}return g.U(d,rs(n,t,"musicDownloadsLibraryEntity"),0)})},csT=function(n){var q=n.videos;
n=[];var M=[];if(q){q=g.S(q);for(var t=q.next();!t.done;t=q.next()){var c=t.value.offlineVideoData.videoId;t=g.rb(c,"musicTrack");c=g.rb(c,"musicTrackDownloadMetadataEntity");n.push(t);M.push(c)}}return{nD:n,GO:M}},P1=function(n,q,M){q={track:MAd(q)};
M&&(q.playlistId=M);if(n=g.R(n.actionMetadata,YXd))q.maximumDownloadQuality=n.maximumDownloadQuality;return{musicTrackEntityActionMetadata:q}},Kvn=function(n){var q,M,t,c,Y,G,k,b;
return g.u(function(d){switch(d.X){case 1:return q=g.zj(),M=Y$G(n),t=g.QQ(GSF),g.Ij(d,2),Y={CC:!0},g.U(d,g.B_(q,M,t,void 0,Y),4);case 4:c=d.W;g.vd(d,3);break;case 2:G=g.TU(d);if(G instanceof g.Rt)throw k="GetOffline network manager error: "+G.message,iH(k,G),Error(k);iH("GetOffline fetch request error",G);throw Error("GetOffline fetch request error");case 3:b=v1(c);if(!c)throw iH("Network request failed"),Error("Network request failed");if(b!==void 0)T9(b);else if(!c.videos||!c.videos.length)throw iH("No data"),
Error("No data");return d.return(c.videos.map(function(N){return N.offlineVideoData}))}})},kSs=function(n){var q,M,t,c,Y,G,k,b;
return g.u(function(d){switch(d.X){case 1:return q=g.zj(),M=GwS(n),t=g.QQ(GSF),g.Ij(d,2),Y={CC:!0},g.U(d,g.B_(q,M,t,void 0,Y),4);case 4:c=d.W;g.vd(d,3);break;case 2:G=g.TU(d);if(G instanceof g.Rt)throw k="GetOffline network manager error for playlist: "+G.message,iH(k,G),Error(k);iH("GetOffline fetch request error for playlist",G);throw Error("GetOffline fetch request error for playlist");case 3:b=v1(c);if(!c)throw iH("Network request failed for playlist"),Error("Network request failed for playlist");
if(b!==void 0)T9(b,"playlist");else if(!c.playlists||!c.playlists.length)throw iH("No data for playlist"),Error("No data for playlist");return d.return(c.playlists.map(function(N){return N.offlinePlaylistData}))}})},dNO=function(n,q,M,t){var c,Y,G,k,b,d,N,O,e,E,h,I,L,T,v,B,m,a,x,V,bf,Ka,dd,gd,MR,lf,rd,gT,ND,V1;
return g.u(function(uf){switch(uf.X){case 1:return g.U(uf,pR(),2);case 2:c=uf.W;if(!c)return uf.return([]);Y=[];if((G=t)==null?0:G.length){Y=t;uf.Fy(3);break}return g.U(uf,Qq(c,"mainPlaylistEntity"),4);case 4:Y=uf.W;case 3:if(!Y.length)return uf.return([]);k=[];b=Date.now()/1E3;d=g.S(Y);N=d.next();case 5:if(N.done)return k.length?g.U(uf,b4Q(k),10):uf.return([]);O=N.value;if(!O.downloadState){e=void 0;uf.Fy(8);break}return g.U(uf,xU(c,O.downloadState,"mainPlaylistDownloadStateEntity"),9);case 9:e=
uf.W;case 8:E=e;h=void 0;L=(I=(h=O)==null?void 0:h.entityMetadata)&&I.nextAutoRefreshIntervalSeconds?Number(I.nextAutoRefreshIntervalSeconds):NaN;T=Number.isNaN(L)?n:L;B=v=void 0;m=((v=E)==null?0:v.lastSyncedTimestampMillis)?Number((B=E)==null?void 0:B.lastSyncedTimestampMillis)/1E3:0;x=a=void 0;V=((a=E)==null?0:a.addedTimestampMillis)?Number((x=E)==null?void 0:x.addedTimestampMillis)/1E3:0;if(M||!I||m+T<=b){bf=[];Ka=void 0;if((Ka=O.videos)==null?0:Ka.length)for(dd=g.S(O.videos),gd=dd.next();!gd.done;gd=
dd.next())MR=gd.value,lf=JSON.parse(g.Co(MR).entityId),lf.videoId&&bf.push(lf.videoId);rd="0";I&&(gT=void 0,rd=String(Number((gT=I.offlineLastModifiedTimestampSeconds)!=null?gT:0).toFixed()));ND={playlistId:O.playlistId,videoIds:bf,offlineLastModifiedTimestamp:rd,autoSync:q,offlineDateAddedTimestamp:String(V.toFixed())};k.push(ND)}N=d.next();uf.Fy(5);break;case 10:return V1=uf.W,uf.return(V1)}})},NYw=function(){var n,q,M,t,c;
return g.u(function(Y){if(Y.X==1)return g.U(Y,pR(),2);if(Y.X!=3)return(n=Y.W)?g.U(Y,Qq(n,"refresh"),3):Y.return(!1);q=Y.W;if((M=q[0])==null||!M.refreshTime)return Y.return(!1);t=Number(q[0].refreshTime);c=Date.now()/1E3;return Y.return(isFinite(t)&&c>=t)})},giQ=function(n,q){var M,t,c;
return g.u(function(Y){switch(Y.X){case 1:return g.Ij(Y,2),g.U(Y,O4G(n,q),4);case 4:return t=Y.W,g.U(Y,zBQ(t),5);case 5:M=Vwd(t);g.vd(Y,3);break;case 2:c=g.TU(Y),iH("getAndProcessSmartDownloadsResponse request or processing error",c);case 3:return Y.return(M)}})},eQs=function(n,q,M,t){var c,Y,G,k,b,d,N,O,e,E,h,I,L,T,v,B,m,a,x,V,bf,Ka,dd,gd,MR,lf,rd,gT,ND,V1;
return g.u(function(uf){switch(uf.X){case 1:return g.U(uf,pR(),2);case 2:c=uf.W;if(!c)return uf.return([]);Y=[];if((G=t)==null?0:G.length){Y=t;uf.Fy(3);break}return g.U(uf,Qq(c,"musicPlaylist"),4);case 4:Y=uf.W;case 3:if(!Y.length)return uf.return([]);k=[];b=Date.now()/1E3;d=g.S(Y);N=d.next();case 5:if(N.done)return k.length?g.U(uf,b4Q(k),10):uf.return([]);O=N.value;e=void 0;h=(E=(e=O)==null?void 0:e.entityMetadata)&&E.nextAutoRefreshIntervalSeconds?Number(E.nextAutoRefreshIntervalSeconds):NaN;I=
Number.isNaN(h)?n:h;T=L=0;v="DOWNLOAD_SYNC_STATE_UNKNOWN";if(!O.downloadMetadata){uf.Fy(8);break}return g.U(uf,xU(c,O.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),9);case 9:B=uf.W,a=m=void 0,L=Number((a=(m=B)==null?void 0:m.addedTimestampMillis)!=null?a:"0")/1E3,V=x=void 0,T=Number((V=(x=B)==null?void 0:x.lastModifiedTimestampMillis)!=null?V:"0")/1E3,Ka=bf=void 0,v=(Ka=(bf=B)==null?void 0:bf.syncState)!=null?Ka:"DOWNLOAD_SYNC_STATE_UNKNOWN";case 8:dd=void 0;if(M||v!=="DOWNLOAD_SYNC_STATE_UP_TO_DATE"||
!E||Number((dd=E.lastSyncedTimestampSeconds)!=null?dd:0)+I<=b){gd=[];MR=void 0;if((MR=O.tracks)==null?0:MR.length)for(lf=g.S(O.tracks),rd=lf.next();!rd.done;rd=lf.next())gT=rd.value,gd.push(g.Co(gT).entityId);ND={playlistId:O.playlistId,videoIds:gd,offlineLastModifiedTimestamp:String(T.toFixed()),autoSync:q,offlineDateAddedTimestamp:String(L.toFixed())};k.push(ND)}N=d.next();uf.Fy(5);break;case 10:return V1=uf.W,uf.return(V1)}})},O4G=function(n,q){var M,t,c,Y,G,k,b,d,N,O;
return g.u(function(e){switch(e.X){case 1:return M=g.zj(),g.U(e,pR(),2);case 2:t=e.W;if(!t){e.Fy(3);break}return g.U(e,gDn(t),4);case 4:c=e.W;case 3:var E=c;Y={context:g.Cz(),browseId:"FEdownloads",browseRequestSupportedMetadata:{downloadsBrowseParams:{offlineFeatureSettingState:{isSdEnabled:n},offlineClientState:E,clientStateRequestData:{preferredFormatType:q}}}};G=g.QQ(Eis);g.Ij(e,5);b={CC:!0};return g.U(e,g.B_(M,Y,G,void 0,b),7);case 7:k=e.W;g.vd(e,6);break;case 5:d=g.TU(e);if(d instanceof g.Rt)throw N=
"DPS network manager error for smart downloads: "+d.message,iH(N,d),Error(N);iH("DPS fetch request error for smart downloads",d);throw Error("DPS fetch request error for smart downloads");case 6:O=v1(k);if(k)O!==void 0&&T9(O,"smart downloads");else throw iH("Network request failed for smart downloads"),Error("Network request failed for smart downloads");return e.return(k)}})},WvT=function(n,q){var M,t,c,Y,G,k,b,d;
return g.u(function(N){switch(N.X){case 1:return M=g.zj(),t={context:g.Cz(),videoPlaybackPositionEntities:n,lastSyncTimestampUsec:q},c=g.QQ(hQn),g.Ij(N,2),G={CC:!0},g.U(N,g.B_(M,t,c,void 0,G),4);case 4:Y=N.W;g.vd(N,3);break;case 2:k=g.TU(N);if(k instanceof g.Rt)throw b="VPPS network manager error: "+k.message,iH(b,k),Error(b);iH("VPPS fetch request error",k);throw Error("VPPS fetch request error");case 3:d=v1(Y);if(Y)d!==void 0&&T9(d,"position sync");else throw iH("Network request failed for position sync"),
Error("Network request failed for position sync");return N.return(Y)}})},s7T=function(n,q,M){var t,c,Y,G,k,b,d,N;
return g.u(function(O){switch(O.X){case 1:t=g.zj();var e=M.refreshData,E=M.isEnqueuedForExpiredStreamUrlRefetch,h=M.kA,I=M.offlineSourceData,L=M.mediaCapabilities,T={entityKey:n};e&&(T.refreshData=e);E&&(T.isExpiredStreamUrlRefetch=E);h&&(T.downloadParameters=h);I&&(T.offlineSourceData=I);e={context:g.Ho(q),signatureTimestamp:20328,videos:[T]};L&&(e.mediaCapabilities=L);c=e;Y=g.QQ(ysn);g.Ij(O,2);k={CC:!0};return g.U(O,g.B_(t,c,Y,void 0,k),4);case 4:G=O.W;g.vd(O,3);break;case 2:b=g.TU(O);if(b instanceof
g.Rt)throw d="GetPDE network manager error: "+b.message,iH(d,b),Error(d);iH("GetPDE fetch request error",b);throw Error("GetPDE fetch request error");case 3:N=v1(G);if(G)N!==void 0&&T9(N,"PDE");else throw iH("Network request failed for PDE"),Error("Network request failed for PDE");return O.return(G)}})},v1=function(n){var q;
return(q=n.errorMetadata)==null?void 0:q.status},T9=function(n,q){q=q?" for "+q:"";
if(n===0)throw n="Empty response body"+q,iH(n),Error(n);n="Response with error"+q;iH(n);throw Error(n);},b4Q=function(n){var q,M,t,c,Y,G,k,b;
return g.u(function(d){switch(d.X){case 1:return q=g.zj(),M=KXs(n),t=g.QQ(XXO),g.Ij(d,2),Y={CC:!0},g.U(d,g.B_(q,M,t,void 0,Y),4);case 4:c=d.W;g.vd(d,3);break;case 2:G=g.TU(d);if(G instanceof g.Rt)throw k="offlinePlaylistSyncCheck network manager error: "+G.message,iH(k,G),Error(k);iH("offlinePlaylistSyncCheck fetch request error",G);throw Error("offlinePlaylistSyncCheck fetch request error");case 3:b=v1(c);if(!c)throw iH("Network request failed for playlist sync"),Error("Network request failed for playlist sync");
if(b!==void 0)T9(b,"playlist sync");else if(!c.offlinePlaylistSyncCheckDatas||!c.offlinePlaylistSyncCheckDatas.length)throw iH("No data for playlist sync"),Error("No data for playlist sync");return d.return(c.offlinePlaylistSyncCheckDatas.map(function(N){return N.offlinePlaylistSyncCheckData}))}})},lH=function(n){this.X=n},j7s=function(n,q){var M,t,c,Y,G,k;
return g.u(function(b){switch(b.X){case 1:M=new Map,t=g.S(q),c=t.next();case 2:if(c.done){b.Fy(4);break}Y=c.value;G=M;k=G.set;return g.U(b,n.W(Y),5);case 5:k.call(G,Y,b.W);c=t.next();b.Fy(2);break;case 4:return b.return(M)}})},UB=function(n,q,M,t,c,Y){q=g.rb(q,M);
t=Object.assign({},Y,{priority:t,retryScheduleIntervalsInSeconds:c});return{actionType:n,entityKey:q,actionMetadata:t}},uH=function(n,q,M,t,c,Y){this.status=n;
this.X=q;this.J=M;this.W=t;this.Z=c;this.downloadState=Y},SXF=function(n,q,M){this.X=n;
this.Q1=q;this.Z=M},H4Q=function(n,q){var M,t,c,Y,G,k,b,d,N;
return g.u(function(O){switch(O.X){case 1:return M=q.entityKey,c=(t=g.R(q.actionMetadata,B1))==null?void 0:t.isEnqueuedForExpiredStreamUrlRefetch,g.Ij(O,2),Y=void 0,g.U(O,IHF(n,q),4);case 4:Y=O.W;g.Ij(O,5);var e=(e=g.R(q.actionMetadata,B1))?{maximumDownloadQuality:e.maximumDownloadQuality}:void 0;return g.U(O,s7T(M,n.Q1,{isEnqueuedForExpiredStreamUrlRefetch:c,kA:e,offlineSourceData:Y}),7);case 7:G=O.W;g.vd(O,6,2);break;case 5:return g.TU(O,2),k=k_(q)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":
"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR",iH("PDE handleAdd error"),O.return(DC(q,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",k,"DOWNLOAD_STATE_FAILED"));case 6:return g.U(O,fHL(n,G,q),8);case 8:return O.return(DC(q,!0,G.orchestrationActions));case 2:return b=g.TU(O),d="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",N="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",b instanceof g.dz&&b.type==="QUOTA_EXCEEDED"&&(d="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
N="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),iH("PDE handleAdd error"),O.return(DC(q,!1,void 0,d,N,"DOWNLOAD_STATE_FAILED"))}})},viT=function(n,q){var M,t,c,Y,G,k,b,d,N,O,e,E,h,I,L,T,v,B,m,a,x,V,bf,Ka;
return g.u(function(dd){switch(dd.X){case 1:return M=q.entityKey,t=g.Co(M).entityId,g.U(dd,CR(n.X,{mode:"readonly",fd:!0},function(gd){var MR=av(gd,M,"playbackData"),lf=av(gd,g.rb(t,"offlineVideoPolicy"),"offlineVideoPolicy");gd=av(gd,g.rb(t,"transfer"),"transfer");return g.W6.all([MR,lf,gd])}),2);
case 2:c=dd.W;Y=g.S(c);G=Y.next().value;k=Y.next().value;b=Y.next().value;d=G;N=k;O=b;if(!d||!N)return dd.return(DC(q,!0));e=[];I=((h=d)==null?0:h.playerResponseJson)?JSON.parse(d.playerResponseJson):null;if(!(O&&I&&n.Q1.D("html5_refresh_deprecated_downloads"))){dd.Fy(3);break}E=Lvd(n,I,O);return g.U(dd,PCw(n,O),4);case 4:e=dd.W;case 3:L={lastPlayerResponseTimestampSeconds:d.playerResponseTimestamp,offlineToken:N.offlineToken,formatIds:e};T={};if((v=O)==null?0:v.maximumDownloadQuality)T.maximumDownloadQuality=
O.maximumDownloadQuality;g.Ij(dd,5);B=void 0;return g.U(dd,IHF(n,q),7);case 7:return B=dd.W,g.Ij(dd,8),g.U(dd,s7T(M,n.Q1,{refreshData:L,kA:T,offlineSourceData:B,mediaCapabilities:E}),10);case 10:m=dd.W;g.vd(dd,9,5);break;case 8:return g.TU(dd,5),a=k_(q)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR",iH("PDE handleRefresh error"),dd.return(DC(q,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",a,
"DOWNLOAD_STATE_FAILED"));case 9:return g.U(dd,fHL(n,m,q),11);case 11:return dd.return(DC(q,!0,m.orchestrationActions));case 5:return x=g.TU(dd),V="PDE handleRefresh error",x instanceof Error&&(V="PDE handleRefresh error: "+x.message),bf="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",Ka="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",x instanceof g.dz&&x.type==="QUOTA_EXCEEDED"&&(bf="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",Ka="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
iH(V),dd.return(DC(q,!1,void 0,bf,Ka,"DOWNLOAD_STATE_FAILED"))}})},IHF=function(n,q){var M,t,c,Y;
return g.u(function(G){if(G.X==1)return M=g.Co(q.entityKey).entityId,t=g.rb(M,"videoDownloadContextEntity"),g.U(G,xU(n.X,t,"videoDownloadContextEntity"),2);c=G.W;return(Y=c)!=null&&Y.offlineModeType?G.return({offlineModeType:c.offlineModeType}):G.return(void 0)})},fHL=function(n,q,M){var t,c,Y,G,k;
return g.u(function(b){if(b.X==1){if(!q.frameworkUpdates||!g.R(q.frameworkUpdates,SD))return b.return();if(!(g.R(q.frameworkUpdates,SD).mutations&&g.R(q.frameworkUpdates,SD).mutations.length>0&&g.R(q.frameworkUpdates,SD).mutations[0].type==="ENTITY_MUTATION_TYPE_DELETE"))return b.Fy(2);t=g.Co(g.R(q.frameworkUpdates,SD).mutations[0].entityKey).entityId;return g.U(b,IC(n.X,t),3)}if(b.X!=2){c=b.W;Y=g.R(M.actionMetadata,B1);if(k=(G=Y)==null?void 0:G.playlistId)c.playlistId=k;c.offlineDeleteReason="OFFLINE_DELETE_REASON_UNKNOWN";
return g.fl(n.Q1)?g.U(b,jD(t,n.X,M,n.Z,c),2):g.BD(n.Q1)?g.U(b,fG(t,n.X,M,n.Z),2):b.Fy(2)}return g.U(b,Q8n(g.R(q.frameworkUpdates,SD)),0)})},DC=function(n,q,M,t,c,Y){return new uH(q?"OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS":"OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",k_(n),M,t,c,Y)},Lvd=function(n,q,M){q=AdS(n.Q1,M.cotn,q);
M=g.AK(q);return g.TVm(q,M,n.Q1)},PCw=function(n,q){var M,t,c,Y,G,k,b,d,N,O,e;
return g.u(function(E){if(E.X==1)return M=[],g.U(E,CR(n.X,{mode:"readonly",fd:!0},function(h){var I=[],L=q.offlineVideoStreams;if(L){L=g.S(L);for(var T=L.next();!T.done;T=L.next())I.push(av(h,T.value,"offlineVideoStreams"))}return g.W6.all(I)}),2);
if(t=E.W)for(c=g.S(t),Y=c.next();!Y.done;Y=c.next())if(G=Y.value,k=void 0,(k=G)==null?0:k.streamsProgress)for(b=G.streamsProgress,d=0;d<b.length;d++)N=b[d],O=JSON.parse(N.formatStreamBytes),e={itag:O.itag,lmt:O.lastModified,xtags:O.xtags},M.push(e);return E.return(M)})},TYF=function(n,q){this.X=n;
this.Q1=q},lHO=function(n,q){var M,t,c,Y,G,k,b,d,N,O,e,E;
return g.u(function(h){switch(h.X){case 1:return M=k_(q),g.U(h,Qq(n.X,"videoPlaybackPositionEntity"),2);case 2:t=h.W;if(t.length===0)return h.return(new uH("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",M));g.Ij(h,3);return g.U(h,$U.getInstance(),5);case 5:c=h.W;if(!c)throw Error("prefStorage is undefined");return g.U(h,c.get("psi"),6);case 6:return Y=h.W,b=(k=(G=Y)==null?void 0:G.bC)!=null?k:"0",g.U(h,WvT(t,b),7);case 7:return d=h.W,N={isPaused:d.watchHistoryPaused,bC:d.syncTimestampUsec},g.U(h,c.set("psi",
N),8);case 8:if(N.isPaused){h.Fy(9);break}O=g.R(d.frameworkUpdates,SD);if(!d.frameworkUpdates||!O){h.Fy(9);break}return g.U(h,Q8n(O),9);case 9:g.vd(h,4);break;case 3:return e=g.TU(h),E="PPE handleRefresh error: "+(e instanceof Error?e.message:"unknown error"),iH(E),h.return(new uH("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",M,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return h.return(new uH("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
M))}})},uAQ=function(n,q){var M,t,c,Y,G,k,b,d;
return g.u(function(N){switch(N.X){case 1:return M=k_(q),t=g.Co(q.entityKey).entityId,g.Ij(N,2),g.U(N,$U.getInstance(),4);case 4:c=N.W;if(!c)throw Error("prefStorage is undefined");return g.U(N,c.get("psi"),5);case 5:Y=N.W;G=g.R(q.actionMetadata,UNO);if(((k=Y)==null?void 0:k.isPaused)!==!1||(b=G)==null||!b.lastPlaybackPositionSeconds){N.Fy(6);break}d={key:g.rb(t,"videoPlaybackPositionEntity"),videoId:t,lastPlaybackPositionSeconds:G.lastPlaybackPositionSeconds};return g.U(N,rs(n.X,d,"videoPlaybackPositionEntity"),
6);case 6:g.vd(N,3);break;case 2:return g.TU(N),N.return(new uH("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",M,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return N.return(new uH("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",M))}})},BYD=function(n,q){var M,t,c;
return g.u(function(Y){switch(Y.X){case 1:M=k_(q);g.Ij(Y,2);t=g.Co(q.entityKey).entityId;if(t==="!*$_ALL_ENTITIES_!*$")return g.U(Y,JQA(n.X),5);c=g.rb(t,"videoPlaybackPositionEntity");return g.U(Y,zMw(n.X,c),5);case 5:g.vd(Y,3);break;case 2:return g.TU(Y),Y.return(new uH("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",M,void 0,"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return Y.return(new uH("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
M))}})},DNA=function(n,q){this.api=n;
this.X=q;this.logger=new g.jr("woffle");this.W=!1;this.vg={qE:this.qE};this.logger.debug("Initialized OfflineMediaManager")},AsS=function(n){return g.u(function(q){return q.return(cdn(n))})},mNT=function(n){var q;
return g.u(function(M){if(M.X==1)return g.U(M,g.x41(n),2);q=M.W;return M.return(q.filter(function(t){return!!t.url}).map(function(t){return t.url}))})},A6=function(n,q){var M=g.Yp(q);
if(M===1||M===0)return Promise.resolve();(M=$Ns(n,q))&&M.stopVideo();n.Z=0;return AsS(q)},mg=function(n,q,M,t){M=M===void 0?!1:M;
t=t===void 0?!0:t;var c=typeof q==="string"?q:q.videoDetails.videoId;g.Yp(c)===2&&((q=$Ns(n,c))?q.stopVideo():n.logger.info(function(){return"Corresponding player for "+c+" not found. Pausing anyway"}),g.GT(c,2),n.Z=2,M?Fvn(n.X):t&&Z4n(n.X))},$Ns=function(n,q){var M;
return((M=n.player)==null?void 0:M.getVideoData().videoId)===q?n.player:null},aHS=function(n,q,M){q.getPlayerResponse();
g.GT(q.videoId,2);n.Z=2;n.W=!1;var t;(t=n.player)==null||t.dispose();n.player=n.api.Wa(q);q={};n.player.xR((q.localmediachange=n.gb,q.signatureexpired=n.TB,q.statechange=n.Vis,q),n);n.D("html5_generate_content_po_token")&&n.player.hC();var c=n.qE(M);n.player.iW(g.PR(c,c,!0,"m"),!1);n.logger.debug(function(){return"Starting headless playback with quality: "+c});
n.player.HU(!1)},RQS=function(n,q){this.X=n;
this.Q1=q},wXd=function(n,q){var M,t;
return g.u(function(c){switch(c.X){case 1:return M=k_(q),g.U(c,xU(n.X,q.entityKey,"transfer"),2);case 2:if(t=c.W)return c.return(new uH("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",M));g.Ij(c,3);return g.U(c,oin(n,q),5);case 5:g.vd(c,4);break;case 3:return g.TU(c),c.return(new uH("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",M,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return c.return(new uH("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
M))}})},zQK=function(n,q){var M,t;
return g.u(function(c){switch(c.X){case 1:return M=k_(q),g.U(c,xU(n.X,q.entityKey,"transfer"),2);case 2:t=c.W;if(!t||t.transferState!=="TRANSFER_STATE_COMPLETE")return c.return(new uH("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",M));g.Ij(c,3);return g.U(c,oin(n,q,!0),5);case 5:g.vd(c,4);break;case 3:return g.TU(c),c.return(new uH("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",M,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));
case 4:return c.return(new uH("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",M))}})},Jss=function(n,q){var M,t,c,Y,G,k,b,d,N,O;
return g.u(function(e){switch(e.X){case 1:return M=k_(q),t=g.Co(q.entityKey).entityId,g.U(e,CR(n.X,{mode:"readonly",fd:!0},function(E){var h=av(E,q.entityKey,"transfer");E=av(E,g.rb(t,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.W6.all([h,E])}),2);
case 2:c=e.W;Y=g.S(c);G=Y.next().value;k=Y.next().value;b=G;d=k;if(!b||b.transferState!=="TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH")return e.return(new uH("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",M));g.Ij(e,3);b.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE";return g.U(e,rs(n.X,b,"transfer"),5);case 5:N=g.Co(b.key).entityId;TEw({videoId:N,Qw:b,offlineModeType:(O=d)==null?void 0:O.offlineModeType});g.vd(e,4);break;case 3:return g.TU(e),e.return(new uH("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",
M,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return e.return(new uH("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",M))}})},oin=function(n,q,M){M=M===void 0?!1:M;
var t,c,Y,G,k,b,d,N,O,e,E,h,I,L,T;return g.u(function(v){switch(v.X){case 1:return t=g.R(q.actionMetadata,VAK),c=g.Co(q.entityKey).entityId,Y=g.rb(c,"downloadStatusEntity"),g.U(v,CR(n.X,{mode:"readonly",fd:!0},function(B){var m=av(B,Y,"downloadStatusEntity");B=av(B,g.rb(c,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.W6.all([m,B])}),2);
case 2:return G=v.W,k=g.S(G),b=k.next().value,d=k.next().value,N=b,O=d,e="TRANSFER_STATE_TRANSFER_IN_QUEUE",((E=N)==null?void 0:E.downloadState)==="DOWNLOAD_STATE_USER_DELETED"&&(e="TRANSFER_STATE_PAUSED_BY_USER"),L={key:q.entityKey,transferState:e,cotn:g.Ec(16),enqueuedTimestampMs:Date.now().toString(),maximumDownloadQuality:(h=t)==null?void 0:h.maximumDownloadQuality,preferredAudioTrack:(I=t)==null?void 0:I.preferredAudioTrack,transferRetryCount:0,isRefresh:M,hasLoggedFirstStarted:!1},g.U(v,CR(n.X,
{mode:"readwrite",fd:!0},function(B){var m=[];M&&m.push(zA(B,g.rb(c,"offlineVideoStreams")));m.push(ws(B,L,"transfer"));return g.W6.all(m)}),3);
case 3:if(!M){v.Fy(4);break}return g.U(v,AsS(c),4);case 4:PMs({videoId:c,Qw:L,offlineModeType:(T=O)==null?void 0:T.offlineModeType}),g.Sk(v)}})},rsF=function(n,q,M,t){if(!n.action.entityKey)throw Error("entityKey is missing.");
var c=g.Co(n.action.entityKey);c={entityType:c.Q7,entityId:c.entityId,offlineOrchestrationActionType:n.action.actionType,orchestrationAction:{orchestrationActionId:n.actionId}};q&&(c.offlineOrchestrationActionResult=q.status,c.isRetryable=M?!1:q.X,q.Z&&(c.offlineOrchestrationFailureReason=CCd(q.Z,c.isRetryable)));var Y,G;if((Y=n.action.actionMetadata)==null?0:(G=Y.offlineLoggingData)==null?0:G.offlineModeType)c.offlineModeType=n.action.actionMetadata.offlineLoggingData.offlineModeType;t&&(c.additionalOrchestrationActions=
t.map(function(k){return{orchestrationActionId:k.actionId}}));
return c},CCd=function(n,q){return n!=="OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR"||q?n==="OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"&&q?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":n:"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"},xNQ=function(n,q){var M={offlineOrchestrationContext:rsF(n)};
q=NET(q,M);OOQ(dbK(),q,n.rootActionId)},Q7w=function(n,q,M,t){t=t===void 0?[]:t;
q={offlineOrchestrationContext:rsF(n,q,M,t)};q=NET(3,q);OOQ(dbK(),q,n.rootActionId)},pXT=function(){this.actions=[]},ndd=function(n,q){q=g.S(q);
for(var M=q.next();!M.done;M=q.next())M=M.value,xNQ(M,1),n.actions.push(M);n.actions.sort(n.X)},qkT=function(n,q){if(q)for(var M=0;M<n.actions.length;M++)if(q==="!*$_ALL_ENTITIES_!*$"&&n.actions[M].actionId!==q||q!=="!*$_ALL_ENTITIES_!*$"&&n.actions[M].rootActionId===q&&n.actions[M].actionId!==q)n.actions.splice(M,1),M--},MUD=function(n,q){n=g.S(n.actions);
for(var M=n.next();!M.done;M=n.next())if(M.value.actionId===q)return!0;return!1},$_=function(n,q,M,t,c){g.F.call(this);
var Y=this;this.W=n;this.wJ=q;this.xl=M;this.N=t;this.Q1=c;this.X=new pXT;this.C=new g.ZE;this.Z=new g.zw(function(){Y.retry()});
this.B=NaN;this.S=!1;this.vg={lYy:function(){return Y.X},
qe:function(){return Y.C},
ozg:function(){return Y.Z},
retry:function(){return Y.retry()}};
g.Z(this,this.Z);this.U=this.W.observe(this.RL.bind(this))},cos=function(n,q,M,t,c){var Y;
return g.u(function(G){if(G.X==1)return Y=new $_(n,q,M,t,c),g.U(G,irS(Y),2);tUO(Y);return G.return(Y)})},tUO=function(n){var q=n.X.actions[0];
return n.J?((q==null?void 0:q.action.actionType)==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&n.J[0].action.actionType!=="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(n.S=!0),Promise.resolve()):YkK(n)},YkK=function(n){var q,M,t,c,Y,G,k,b,d,N,O,e,E,h,I,L,T;
return g.u(function(v){switch(v.X){case 1:if(n.J)throw Error("Already processing an action");if(n.qm())return v.return();q=n.X.actions.shift();HOT(n.xl,!q);if(q===void 0)return v.return();q.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&q.actionId==="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS"&&qkT(n.X,q.actionId);M="";q.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&q.rootActionId===q.actionId&&(M=q.actionId);t=[q];n.J=t;if(c=n.wJ[q.entityType]){v.Fy(2);break}n.J=
void 0;return g.U(v,YkK(n),3);case 3:return v.return();case 2:Y=g.S(t);for(G=Y.next();!G.done;G=Y.next())k=G.value,xNQ(k,2);g.Ij(v,4,5);return g.U(v,j7s(c,t.map(function(B){return B.action})),7);
case 7:b=v.W,d=g.S(t),N=d.next();case 8:if(N.done){v.Fy(10);break}O=N.value;e=b.get(O.action);return g.U(v,G7S(n,O,e),9);case 9:N=d.next();v.Fy(8);break;case 10:qkT(n.X,M);case 5:g.Bd(v);n.J=void 0;g.Ds(v,6);break;case 4:return E=g.TU(v),iH("Orchestration error",E),g.Ij(v,12),g.U(v,K7D(n,t),14);case 14:g.vd(v,5);break;case 12:h=g.TU(v);iH("Orchestration retry error",h);I=g.S(t);for(L=I.next();!L.done;L=I.next())T=L.value,T.retryScheduleIndex<3&&ndd(n.X,[T]);v.Fy(5);break;case 6:return g.U(v,YkK(n),
0)}})},G7S=function(n,q,M){var t,c,Y,G,k,b,d,N,O,e,E,h;
return g.u(function(I){switch(I.X){case 1:t=q.retryScheduleIndex+2===3;if(M.status==="OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS"){I.Fy(2);break}if(M.status!=="OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE"){I.Fy(0);break}Q7w(q,M,t);if(M.X&&q.retryScheduleIndex+1<3)return g.U(I,K7D(n,[q]),0);Y=((c=M)==null?0:c.W)?M.W:"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN";G={entityKey:q.action.entityKey,failureReason:Y};k=void 0;g.fl(n.Q1)?k="mainVideoDownloadStateEntity":g.BD(n.Q1)&&(k="musicTrackDownloadMetadataEntity");
if(!k||!M.downloadState){I.Fy(7);break}b=g.Co(q.action.entityKey).entityId;return g.U(I,OB(b,k,n.W,M.downloadState),7);case 7:c1(n.N,G);if(M.downloadState==="DOWNLOAD_STATE_FAILED"&&n.Q1.D("html5_auto_retry_failed_pde_actions")){I.Fy(0);break}iH("Orchestration result is not retryable, deleting action");return g.U(I,zMw(n.W,yF(q).key),0);case 2:d=void 0;try{d=(N=M.J)==null?void 0:N.map(function(L){return n.createAction(L,q)})}catch(L){return Q7w(q,M,t),O={entityKey:q.action.entityKey,
failureReason:"OFFLINE_OPERATION_FAILURE_REASON_UNSUPPORTED_ENTITY_FAILED"},c1(n.N,O),iH("Orchestration subactions creation error",L),I.return()}Q7w(q,M,t,d);if(!d){I.Fy(12);break}e=d.map(function(L){return yF(L)});
E=0;case 13:if(!(E<d.length)||n.S){I.Fy(15);break}return g.U(I,CR(n.W,{mode:"readwrite",fd:!0},function(L){var T=[];T.push(DAA(L,e.slice(E,E+10),"offlineOrchestrationActionWrapperEntity"));return g.W6.all(T)}),16);
case 16:E+=10;I.Fy(13);break;case 15:if(n.S)return n.S=!1,I.return();case 12:return h=yF(q),g.U(I,zMw(n.W,h.key),17);case 17:xNQ(q,4),g.Sk(I)}})},NSd=function(n,q){var M,t,c,Y,G,k,b,d,N,O,e,E;
return g.u(function(h){M=[];t=Infinity;c=4E3;Y=g.S(q);for(G=Y.next();!G.done;G=Y.next())k=G.value,b=Number(k.enqueueTimeSec),d=k7T(b),N=k.retryScheduleIndex,O=N!=null&&N>0,d>0&&O?(t=Math.min(t,b),c=Math.min(d,c)):M.push(k);isFinite(t)&&(!n.Z.isActive()||t<n.B)&&(n.B=t,n.Z.start(c));n.C.nT()||(e=M.length,M=M.filter(function(I){var L;I=((L=I.actionProto)==null?void 0:L.actionType)||"OFFLINE_ORCHESTRATION_ACTION_TYPE_UNKNOWN";return!brd.includes(I)}),E=M.length<e,!n.Z.isActive()&&E&&n.Z.start(1));
M.length>0&&dwQ(n,M);return g.U(h,tUO(n),0)})},gdQ=function(n){var q,M,t,c,Y,G,k;
return g.u(function(b){if(b.X==1)return g.U(b,Orn(n),2);q=b.W;M=[];t=g.S(q);for(c=t.next();!c.done;c=t.next())Y=c.value,G=g.Co(Y.key),k=G.entityId,MUD(n.X,k)||M.push(Y);return g.U(b,NSd(n,M),0)})},k7T=function(n){n=n*1E3-Date.now();
return n>4E3?4E3:n},K7D=function(n,q){var M,t,c;
return g.u(function(Y){M=g.S(q);for(t=M.next();!t.done;t=M.next()){c=t.value;var G=void 0,k=void 0,b=((k=c.action)==null?void 0:(G=k.actionMetadata)==null?void 0:G.retryScheduleIntervalsInSeconds)||[1,2,4];G=1;c.retryScheduleIndex<b.length&&(G=b[c.retryScheduleIndex]);c.X=G*1E3+Date.now();c.retryScheduleIndex++}return g.U(Y,ekQ(n,q),0)})},irS=function(n){var q;
return g.u(function(M){if(M.X==1)return g.U(M,Qq(n.W,"offlineOrchestrationActionWrapperEntity"),2);q=M.W;return g.U(M,NSd(n,q),0)})},dwQ=function(n,q){q.length!==0&&q.forEach(function(M){M=W1(M);
M.retryScheduleIndex<3&&ndd(n.X,[M])})},Orn=function(n,q){var M;
return g.u(function(t){if(t.X==1)return g.U(t,Qq(n.W,"offlineOrchestrationActionWrapperEntity",q),2);M=t.W;return t.return(M.filter(p2s))})},ekQ=function(n,q){if(q.length===0)return Promise.resolve([]);
q=q.map(function(M){return yF(M)});
return w2w(n.W,q)},EdF=function(n){this.oL=n;
this.X=void 0},hkw=function(n,q){var M,t,c,Y;
return g.u(function(G){M=q.videoId;t=!0;if(q.captionTracks.length)c=LJd(q),n.X=new g.Le(n.oL,q,c);else if(q.K8)Y=g.tGa(q),n.X=new g.v0(n.oL,q.K8,M,Y,q.pL,q.eventId),t=q.pL;else return G.return();return G.return(new Promise(function(k){var b;(b=n.X)==null||b.nF({VP:function(){return g.u(function(d){if(d.X==1)return g.U(d,n.VP(M,t),2);k();g.Sk(d)})},
Cl:function(){}})}))})},W7S=function(n){var q;
return g.u(function(M){if(M.X==1)return g.U(M,twd(n),2);q=M.W;return M.return(!!q&&q.length>0)})},FZ=function(n){g.F.call(this);
this.X=n;this.W=this.X.observe(this.Z.bind(this))},yoQ=function(n,q){var M,t,c,Y,G,k,b;
return g.u(function(d){switch(d.X){case 1:if(q.length===0)return d.return([]);M=q.map(function(N){return g.rb(N,"transfer")});
return g.U(d,Qq(n.X,"transfer",M),2);case 2:t=d.W;c=t.filter(p2s).map(function(N){return g.Co(N.key).entityId});
Y=q.filter(function(N){return c.indexOf(N)===-1});
if(Y.length===0)return d.return([]);G=g.S(Y);k=G.next();case 3:if(k.done){d.Fy(5);break}b=k.value;return g.U(d,AsS(b),4);case 4:k=G.next();d.Fy(3);break;case 5:return d.return(Y)}})},jZs=function(n,q,M,t,c,Y){var G,k,b;
return g.u(function(d){G="STREAM_TYPE_UNKNOWN";M.video&&M.audio?(G="STREAM_TYPE_AUDIO_AND_VIDEO",iH("unexpected stream type")):M.video&&!M.audio?G="STREAM_TYPE_VIDEO":!M.video&&M.audio&&(G="STREAM_TYPE_AUDIO");k=g.rb(q,"offlineVideoStreams");b={numBytesDownloaded:c.toFixed(),numTotalBytes:Y.toFixed(),streamType:G,streamState:"DOWNLOAD_STREAM_STATE_IN_PROGRESS",formatStreamBytes:JSON.stringify(t),itag:G==="STREAM_TYPE_AUDIO_AND_VIDEO"?Number(M.itag):void 0};return g.U(d,CR(n,{mode:"readwrite",fd:!0},
function(N){var O=av(N,k,"offlineVideoStreams"),e=av(N,g.rb(q,"transfer"),"transfer");return g.W6.all([O,e]).then(function(E){E=g.S(E);var h=E.next().value;E=E.next().value;if(!E)return zA(N,k).then(function(){});
var I=sZn(h);h=XAd(h,t,b,k);var L=ws(N,h,"offlineVideoStreams");sZn(h)>I&&(E.lastProgressTimeMs=Date.now().toString());I=[L];E.offlineVideoStreams||(E.offlineVideoStreams=[]);E.offlineVideoStreams.indexOf(k)===-1&&(E.offlineVideoStreams.push(k),I.push(ws(N,E,"transfer")));return g.W6.all(I)})}),0)})},SkQ=function(n,q){var M,t,c,Y,G;
return g.u(function(k){if(k.X==1)return M=g.rb(q,"offlineVideoStreams"),g.U(k,xU(n,M,"offlineVideoStreams"),2);t=k.W;if(!t||!t.streamsProgress)return k.return();c=g.S(t.streamsProgress);for(Y=c.next();!Y.done;Y=c.next())G=Y.value,G.streamState="DOWNLOAD_STREAM_STATE_COMPLETE",G.numTotalBytes!==G.numBytesDownloaded&&(G.numBytesDownloaded=G.numTotalBytes);return g.U(k,rs(n,t,"offlineVideoStreams"),0)})},XAd=function(n,q,M,t){if(n&&n.streamsProgress){t=n;
a:{q=q.itag+";"+q.xtags;for(var c=n.streamsProgress,Y=0;Y<c.length;Y++){var G=JSON.parse(c[Y].formatStreamBytes);if(G.itag+";"+G.xtags===q){c[Y]=M;M=c;break a}}c.push(M);M=c}t.streamsProgress=M}else n={key:t,streamsProgress:[M]};return n},sZn=function(n){if(n==null?0:n.streamsProgress){var q=0;
n=n.streamsProgress;for(var M=0;M<n.length;M++){var t=n[M];isNaN(Number(t.numBytesDownloaded))?iH("stream progress bytes number invalid"):q+=Number(t.numBytesDownloaded)}return q}return 0},ITQ=function(n,q,M,t){g.F.call(this);
var c=this;this.W=n;this.api=q;this.AE=M;this.RL=t;this.C=new g.ZE;this.J=new g.zw(function(){c.X&&c.X.transferState==="TRANSFER_STATE_TRANSFERRING"&&c.C.nT()&&((c.X.transferRetryCount||0)<3?mg(c.N,c.S,!1,!1):A6(c.N,c.S.videoDetails.videoId),c.vr("TRANSFER_FAILURE_REASON_TIMEOUT_NO_PROGRESS"))});
this.xl=this.IL=0;this.U=this.B=!1;this.V1=g.ic(this.api.T().experiments,"html5_transfer_processing_logs_interval");this.rJ=new g.f8(this);this.vg={VQb:function(){return c.J},
dZk:function(){return c.RL},
qe:function(){return c.C}};
this.wJ=this.W.observe(this.mW.bind(this));this.N=new DNA(q,this);this.hE=new EdF(q);this.jX=new FZ(this.W);this.SX=this.C.listen("publicytnetworkstatus-online",this.ZQ.bind(this));this.nm=this.C.listen("publicytnetworkstatus-offline",this.dVd.bind(this));this.U=this.api.T().D("html5_less_transfer_processing_logs");g.Z(this,this.rJ);this.rJ.V(q,"offlinetransferpause",this.gBJ);if(g.fl(this.api.T()))this.Z="mainVideoDownloadStateEntity";else if(g.BD(this.api.T())||g.Ll(this.api.T()))this.Z="musicTrackDownloadMetadataEntity"},
fTQ=function(n){return g.u(function(q){if(q.X==1)q=g.U(q,MwO(),2);
else{var M=n.jX;var t=g.cO();t=Object.keys(t);M=yoQ(M,t);q=g.U(q,M,0)}return q})},aC=function(n,q){q=q===void 0?!1:q;
var M;return g.u(function(t){if(t.X==1){if(n.X)throw Error("Already downloading a video");n.xl=0;n.B=!1;return g.U(t,Hrs(n),2)}return t.X!=4?(M=t.W,LXT(n.AE,!M),M&&n.C.nT()?q?g.U(t,new Promise(function(c){g.bl(c,1E3)}),4):t.Fy(4):(!M&&n.X&&ZC(n),t.Fy(0))):g.U(t,L7F(n,M),0)})},PWA=function(n){return g.u(function(q){if(q.X==1)return n.S?g.U(q,A6(n.N,n.S.videoDetails.videoId),3):q.Fy(0);
ZC(n);g.Sk(q)})},vdL=function(n,q){var M,t,c;
return g.u(function(Y){switch(Y.X){case 1:return g.Ij(Y,2),(M=!!q.captionTracks.length||!!q.K8)?g.U(Y,W7S(q.videoId),4):Y.return();case 4:return(t=Y.W)?Y.return():g.U(Y,hkw(n.hE,q),5);case 5:g.vd(Y,0);break;case 2:c=g.TU(Y),iH("Caption downloading error",c,q.cotn),g.Sk(Y)}})},L7F=function(n,q){var M,t,c,Y,G,k;
return g.u(function(b){switch(b.X){case 1:if(n.B)return b.return();n.B=!0;n.X=q;M=g.Co(n.X.key);t=M.entityId;c=void 0;if(n.X.transferState==="TRANSFER_STATE_TRANSFERRING")return g.U(b,RC(n,t),7);if(n.X.transferState!=="TRANSFER_STATE_TRANSFER_IN_QUEUE"||n.X.transferRetryCount||n.X.hasLoggedFirstStarted){b.Fy(3);break}return g.U(b,RC(n,t),5);case 5:return c=b.W,n.X.hasLoggedFirstStarted=!0,g.U(b,TSF(n),6);case 6:vDA({videoId:t,Qw:n.X,offlineModeType:c},void 0,void 0,!0);b.Fy(3);break;case 7:c=b.W,
KG({transferStatusType:"TRANSFER_STATUS_TYPE_RESUME_PROCESSING",statusType:"OFFLINING_RETRIED"},{videoId:t,Qw:n.X,offlineModeType:c});case 3:return g.U(b,lTs(n),8);case 8:return Y=null,g.Ij(b,9),g.U(b,UwL(n,q),11);case 11:Y=b.W;n.S=Y;g.vd(b,10);break;case 9:return G=g.TU(b),iH("error getting player response",G,q.cotn),g.U(b,n.vr("TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING"),12);case 12:return b.return();case 10:return k=AdS(n.api.T(),q.cotn,Y),g.U(b,vdL(n,k),13);case 13:return g.U(b,mNT(k.videoId),
14);case 14:k.bD=b.W,aHS(n.N,k,q.maximumDownloadQuality),n.J.start(108E5),g.Sk(b)}})},Hrs=function(n){var q,M;
return g.u(function(t){if(t.X==1)return g.U(t,Qq(n.W,"transfer"),2);q=t.W;M=q.filter(uaS).sort(BSA);return M.length===0?t.return():t.return(M[0])})},lTs=function(n){var q,M,t;
return g.u(function(c){if(c.X==1){if(!n.X)return oC(n,"onTransferStart"),c.return();n.J.start(108E5);return g.U(c,wR(n,"TRANSFER_STATE_TRANSFERRING"),2)}q=n.X;return(t=((M=q)==null?0:M.key)?g.Co(q.key).entityId:"")&&n.Z?g.U(c,OB(t,n.Z,n.W,"DOWNLOAD_STATE_DOWNLOAD_IN_PROGRESS"),0):c.Fy(0)})},Fvn=function(n){var q,M,t,c;
g.u(function(Y){switch(Y.X){case 1:if(!n.X){oC(n,"onTransferPausedByUser");Y.Fy(2);break}q=n.X;n.J.stop();return g.U(Y,wR(n,"TRANSFER_STATE_PAUSED_BY_USER"),3);case 3:t=((M=q)==null?0:M.key)?g.Co(q.key).entityId:"";if(!t||!n.Z){Y.Fy(4);break}return g.U(Y,OB(t,n.Z,n.W,"DOWNLOAD_STATE_PAUSED"),4);case 4:return g.U(Y,RC(n,t),6);case 6:c=Y.W,lDn({videoId:t,Qw:q,offlineModeType:c});case 2:ZC(n),aC(n),g.Sk(Y)}})},Z4n=function(n){var q,M,t;
g.u(function(c){if(c.X==1){if(!n.X)return oC(n,"onTransferPausedByNetwork"),c.return();n.J.stop();return g.U(c,wR(n,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),2)}if(c.X!=3)return q=n.X,(t=((M=q)==null?0:M.key)?g.Co(q.key).entityId:"")&&n.Z?g.U(c,OB(t,n.Z,n.W,"DOWNLOAD_STATE_PAUSED"),3):c.Fy(3);ZC(n);g.Sk(c)})},DwS=function(n){var q,M,t,c,Y;
g.u(function(G){switch(G.X){case 1:if(!n.X)return oC(n,"onTransferComplete"),G.return();q=n.X;n.J.stop();if(!q||!n.S){G.Fy(2);break}M=AdS(n.api.T(),q.cotn,n.S);return g.U(G,vdL(n,M),2);case 2:return g.U(G,wR(n,"TRANSFER_STATE_COMPLETE","DOWNLOAD_STREAM_STATE_COMPLETE"),4);case 4:c=((t=q)==null?0:t.key)?g.Co(q.key).entityId:"";if(!c||!n.Z){G.Fy(5);break}return g.U(G,OB(c,n.Z,n.W,"DOWNLOAD_STATE_COMPLETE"),5);case 5:return g.U(G,SkQ(n.W,c),7);case 7:return g.U(G,RC(n,c),8);case 8:Y=G.W,KG({transferStatusType:"TRANSFER_STATUS_TYPE_COMPLETED",
statusType:"SUCCESS"},{videoId:c,Qw:q,offlineModeType:Y}),ZC(n),aC(n),g.Sk(G)}})},AoQ=function(n,q,M){var t,c;
g.u(function(Y){switch(Y.X){case 1:if(!n.X)return oC(n,"onTransferProgress: "+q),Y.return();if(n.X.transferState==="TRANSFER_STATE_TRANSFERRING"){Y.Fy(2);break}return g.U(Y,lTs(n),2);case 2:t=Date.now();if(!(t-n.IL>1E3)){Y.Fy(4);break}n.IL=t;return g.U(Y,jZs(n.W,M.videoId,M.W,M.u2,M.bytesDownloaded,M.X),5);case 5:if(n.U&&!(n.U&&t-n.xl>n.V1)){Y.Fy(4);break}n.xl=t;return g.U(Y,RC(n,q),7);case 7:c=Y.W,vDA({videoId:q,Qw:n.X,offlineModeType:c},M.bytesDownloaded,M.X);case 4:n.J.start(108E5),g.Sk(Y)}})},
mwT=function(n){var q=(n.X.transferRetryCount||0)<3;
q&&(n=n.X,n.transferRetryCount=(n.transferRetryCount||0)+1);return q},$ws=function(n,q){q=q===void 0?"TRANSFER_FAILURE_REASON_UNKNOWN":q;
var M,t,c,Y;return g.u(function(G){if(G.X==1)return n.X||oC(n,"setTransferToFailed: "+q),M="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",q==="TRANSFER_FAILURE_REASON_NETWORK"?M="OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED":q==="TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"&&(M="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED"),g.U(G,wR(n,"TRANSFER_STATE_FAILED","DOWNLOAD_STREAM_STATE_ERROR_STREAMS_MISSING",q),2);if(G.X!=3)return c1(n.RL,{entityKey:(t=n.X)==null?void 0:t.key,failureReason:M}),
c=n.X?g.Co(n.X.key).entityId:"",g.U(G,RC(n,c),3);Y=G.W;var k={videoId:c,Qw:n.X,offlineModeType:Y},b=q,d={transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_WITH_FAILURE",statusType:"FAILED"};b&&(d.transferFailureReason=b,d.failureReason=UbK(b));KG(d,k);g.Sk(G)})},wR=function(n,q,M,t){var c;
return g.u(function(Y){if(Y.X==1){if(!n.X)return oC(n,"saveTransferState: "+q),Y.return();n.X.transferState=q;n.X.failureReason=t;g.Ij(Y,2);return g.U(Y,TSF(n,function(G){return M?Rv(G,"offlineVideoStreams",n.X.offlineVideoStreams).then(function(k){for(var b=g.S(k),d=b.next();!d.done;d=b.next())if((d=d.value)&&d.streamsProgress){d=g.S(d.streamsProgress);for(var N=d.next();!N.done;N=d.next())N.value.streamState=M}return DAA(G,k.filter(function(O){return!!O}),"offlineVideoStreams")}):g.W6.resolve(void 0)}),
4)}if(Y.X!=2)return g.vd(Y,0);
c=g.TU(Y);return c instanceof g.dz&&c.type==="QUOTA_EXCEEDED"?g.U(Y,n.vr("TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"),0):Y.Fy(0)})},TSF=function(n,q){var M;
return g.u(function(t){if(!n.X)return t.return();M=n.X;return g.U(t,CR(n.W,{mode:"readwrite",fd:!0},function(c){var Y=[ws(c,M,"transfer")];q&&Y.push(q(c));return g.W6.all(Y)}),0)})},ZC=function(n){n.X=void 0;
n.S=void 0;n.J.stop()},UwL=function(n,q){var M,t,c,Y,G;
return g.u(function(k){if(k.X==1)return M=g.Co(q.key),t=M.entityId,c=g.rb(t,"playbackData"),g.U(k,xU(n.W,c,"playbackData"),2);Y=k.W;if((G=Y)==null?0:G.playerResponseJson)return k.return(JSON.parse(Y.playerResponseJson));throw Error("No PlayerResponse found");})},oC=function(n,q){n.api.Xy("woffle",{mcte:q});
iH("missing current transfer entity.")},RC=function(n,q){var M,t,c;
return g.u(function(Y){if(Y.X==1)return g.U(Y,xU(n.W,g.rb(q,"videoDownloadContextEntity"),"videoDownloadContextEntity"),2);M=Y.W;return Y.return((c=(t=M)==null?void 0:t.offlineModeType)!=null?c:void 0)})},uaS=function(n){return F7D[n.transferState]!==void 0},BSA=function(n,q){var M=F7D[n.transferState],t=F7D[q.transferState];
return M!==t?M-t:Number(n.enqueuedTimestampMs)-Number(q.enqueuedTimestampMs)},z9=function(n,q){var M=this;
this.Q1=n;this.api=q;this.C=new g.ZE;this.S=new g.NA;this.vg={S5:function(){return M.Z.vg.S5()},
qe:function(){return M.C},
gzg:function(){return M.Z},
CB:function(){return M.CB()},
Ub:function(){return M.Ub()},
vV:function(){return M.vV()},
WV:function(){return M.WV()},
M$:function(){return M.M$()},
BM:function(t){return M.BM(t)}};
this.Z=new S$O(function(){return ZrK(M)},function(){M.vV()},this.api.C1(),this.api.D.bind(this.api));
this.X=new t6(this.api);IDO(this.Z)},ZrK=function(n){return g.u(function(q){n.api.Km("onOrchestrationBecameLeader");
return g.U(q,n.Ub(),0)})},Rks=function(n){var q,M;
return g.u(function(t){if(t.X==1)return g.U(t,pR(),2);if(t.X!=3){q=t.W;if(!q)return iH("PES is undefined"),t.return();n.W=new ITQ(q,n.api,n.Z,n.X);M=n.t0(q);return g.U(t,cos(q,M,n.Z,n.X,n.Q1),3)}n.N=t.W;return g.U(t,aTw(n),0)})},aTw=function(n){var q;
return g.u(function(M){switch(M.X){case 1:if(!n.W)return iH("transferManager is undefined"),M.return();if(n.W.X){M.Fy(2);break}return g.U(M,aC(n.W),2);case 2:if(!n.Q1.D("woffle_enable_main_downloads_library")){M.Fy(4);break}return g.U(M,n.D_(),4);case 4:if(!n.Q1.D("html5_offline_playback_position_sync")){M.Fy(6);break}return g.U(M,n.r5(),7);case 7:return g.U(M,n.BM(864E5),6);case 6:return g.U(M,n.refreshAllStaleEntities(43200,!0),9);case 9:return g.U(M,n.QE(),10);case 10:if(!n.Q1.D("html5_retry_downloads_for_expiration")){M.Fy(11);
break}return g.U(M,n.M$(),11);case 11:return n.B=g.dO(function(){n.refreshAllStaleEntities(43200,!0);n.QE()},9E5),g.JJ(g.CL(),function(){return n.WV()}),g.U(M,pR(),13);
case 13:return q=M.W,g.U(M,jDw(q),14);case 14:fDF(n.Z),g.Sk(M)}})},ods=function(){var n,q,M,t,c,Y;
return g.u(function(G){switch(G.X){case 1:return g.U(G,pR(),2);case 2:n=G.W;if(!n)return G.return([]);q=Date.now()/1E3;return g.U(G,Qq(n,"offlineVideoPolicy"),3);case 3:M=G.W,t=g.S(M),c=t.next();case 4:if(c.done){G.Fy(6);break}Y=c.value;if(!(Y.expirationTimestamp&&Number(Y.expirationTimestamp)<q)){G.Fy(5);break}Y.action="OFFLINE_VIDEO_POLICY_ACTION_DISABLE";Y.offlinePlaybackDisabledReason="OFFLINE_PLAYBACK_DISABLED_REASON_CLIENT_OFFLINE_CONTENT_EXPIRED";return g.U(G,rs(n,Y,"offlineVideoPolicy"),5);
case 5:c=t.next();G.Fy(4);break;case 6:return G.return(M.map(function(k){return k.key}))}})},J6=function(n,q,M,t,c){var Y,G,k;
return g.u(function(b){if(b.X==1)return g.U(b,pR(),2);Y=b.W;if(!Y)return b.return([]);G=q.map(function(d){var N=g.rb(d,M);N={actionType:t,entityKey:N,actionMetadata:Object.assign({},mbd(),c)};t!=="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&(N.actionMetadata.priority=0);d=new h6(M,d,N);return yF(d)});
k=w2w(Y,G);IDO(n.Z);return b.return(k)})},wAD=function(n,q,M,t){var c,Y,G,k,b,d,N,O;
return g.u(function(e){switch(e.X){case 1:c=[],Y=g.S(q),G=Y.next();case 2:if(G.done){e.Fy(4);break}k=G.value;if(k.upToDate||M&&!k.shouldAutoSyncMetadata||!k.playlistId){e.Fy(3);break}b={};switch(t){case "mainPlaylistEntity":d={nextAutoRefreshIntervalSeconds:k.checkInSeconds,autoSync:M};b={mainPlaylistEntityActionMetadata:d};break;case "musicPlaylist":N={autoSync:M},b={musicPlaylistEntityActionMetadata:N}}return g.U(e,J6(n,[k.playlistId],t,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",b),6);case 6:(O=
e.W)&&c.push.apply(c,g.EJ(O));case 3:G=Y.next();e.Fy(2);break;case 4:return e.return(c)}})},zkS=function(n,q){var M;
return g.u(function(t){return q.length?(M=mbd(),g.uo(M,B1,{isEnqueuedForExpiredStreamUrlRefetch:!0}),n.api.Xy("qrd",{v:q.length}),t.return(J6(n,q,"playbackData","OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",M))):t.return([])})},JoA=function(n,q,M){this.X=n;
this.Q1=q;this.Z=M},roT=function(n,q){var M,t,c,Y,G,k,b,d,N,O,e,E,h,I,L,T,v;
return g.u(function(B){switch(B.X){case 1:return M=k_(q),t=g.Co(q.entityKey),c=t.entityId,Y=[],g.Ij(B,2),g.U(B,VUK(n,c),4);case 4:Y=B.W;if(!(n.Q1.D("woffle_enable_main_downloads_library")&&((G=Y)==null?0:G.length))){B.Fy(5);break}return g.U(B,xbs(n.X,[q.entityKey]),5);case 5:g.vd(B,3);break;case 2:return k=g.TU(B),b="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",d="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",k instanceof g.dz&&k.type==="QUOTA_EXCEEDED"?(b="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
d="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"):iH("Playlist add error"),B.return(new uH("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",M,void 0,b,d));case 3:N=[];if(!n.Q1.D("html5_offline_prevent_redownload_downloaded_video")){B.Fy(7);break}return g.U(B,Dbs(n.X,"mainVideoEntity",Y),8);case 8:Y=B.W;case 7:if((O=Y)==null?0:O.length)for(e=g.S(Y),E=e.next();!E.done;E=e.next())if(h=E.value,I=h.offlineVideoData,L=void 0,(L=I)==null?0:L.videoId)T=void 0,v=Number(((T=q.actionMetadata)==null?void 0:T.priority)||
0)+1,N.push(UB("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",I.videoId,"mainVideoEntity",v,VF,CWF(q,I,c)));return B.return(new uH("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",M,N))}})},QZO=function(n,q){var M,t,c,Y,G,k,b,d,N,O,e,E,h,I,L,T,v,B,m,a,x,V,bf,Ka,dd,gd,MR,lf,rd,gT,ND,V1,uf,K3,$w,zL,ku,l,uV,LQ,t_,Ps,f,qR,v7,xu,aG,Ca,MD,cg,w0,H,X,P,D,J,ks,z,p,A,La,ys,GU,kw,Rj,Hd,qE,Hs,FO,Pd,Ip,UJ,DA,vs;
return g.u(function(bV){switch(bV.X){case 1:return M=k_(q),t=q.entityKey,c=g.Co(t).entityId,Y=[],G=!1,c==="!*$_ALL_ENTITIES_!*$"?(G=!0,g.U(bV,Qq(n.X,"mainPlaylistEntity"),5)):g.U(bV,xU(n.X,t,"mainPlaylistEntity"),4);case 4:(k=bV.W)&&Y.push(k);bV.Fy(3);break;case 5:Y=bV.W;case 3:if((b=Y)==null||!b.length)return bV.return(new uH("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",M));d=g.R(q.actionMetadata,xww);O=(N=d)==null?void 0:N.nextAutoRefreshIntervalSeconds;E=(e=d)==null?void 0:e.autoSync;h=[];L=I=
!0;T=!1;if(!G&&E===!1){bV.Fy(6);break}g.Ij(bV,7);return g.U(bV,dNO(0,!!E,!0,Y),9);case 9:h=bV.W;g.vd(bV,8);break;case 7:v=g.TU(bV);if(!(v instanceof Error&&v.message==="No data")){v instanceof Error&&v.message==="Empty response body"&&iH(v.message);bV.Fy(8);break}return c==="!*$_ALL_ENTITIES_!*$"?g.U(bV,wCF(n.X,q,n.Z,"OFFLINE_DELETE_REASON_UNAVAILABLE"),8):g.U(bV,RBL(c,n.X,q,n.Z),8);case 8:if(!h.length||!G&&h[0].playlistId!==c)return bV.return(new uH("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
M));case 6:if(G){B=[];m=g.S(h);for(a=m.next();!a.done;a=m.next())x=a.value,x.upToDate||E&&!x.shouldAutoSyncMetadata||!x.playlistId||(V={nextAutoRefreshIntervalSeconds:x.checkInSeconds,autoSync:E},B.push(UB("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",x.playlistId,"mainPlaylistEntity",0,VF,{mainPlaylistEntityActionMetadata:V})));return bV.return(new uH("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",M,B))}h.length&&(bf=h[0],T=!!bf.upToDate,E&&(I=(Ka=bf.shouldAutoSyncMetadata)!=null?Ka:!0,L=(dd=bf.shouldAutoSyncVideos)!=
null?dd:!0,bf.checkInSeconds&&(O=bf.checkInSeconds)));if(T||!I)return bV.return(new uH("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",M));gd=[];MR=Y[0];if(!MR.downloadState){lf=void 0;bV.Fy(15);break}return g.U(bV,xU(n.X,MR.downloadState,"mainPlaylistDownloadStateEntity"),16);case 16:lf=bV.W;case 15:return rd=lf,ND=((gT=rd)==null?0:gT.addedTimestampMillis)?String(rd.addedTimestampMillis):void 0,g.Ij(bV,17),g.U(bV,VUK(n,c,ND,O),19);case 19:gd=bV.W;g.vd(bV,18);break;case 17:V1=g.TU(bV);if(!(V1 instanceof
Error&&V1.message==="No data for playlist")){if(V1 instanceof Error&&V1.message==="Empty response body for playlist")iH(V1.message);else return uf="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",K3="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",V1 instanceof g.dz&&V1.type==="QUOTA_EXCEEDED"&&(uf="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",K3="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),bV.return(new uH("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",M,void 0,uf,K3));
bV.Fy(18);break}return g.U(bV,RBL(c,n.X,q,n.Z),18);case 18:if(!L)return bV.return(new uH("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",M));$w=[];zL=new Map;if((ku=gd)==null?0:ku.length)for(l=g.S(gd),uV=l.next();!uV.done;uV=l.next())LQ=uV.value,t_=LQ.offlineVideoData,Ps=void 0,((Ps=t_)==null?0:Ps.videoId)&&zL.set(t_.videoId,t_);f=new Map;qR=[];if((v7=MR)==null?0:(xu=v7.videos)==null?0:xu.length)for(aG=g.S(MR.videos),Ca=aG.next();!Ca.done;Ca=aG.next())if(MD=Ca.value,cg=JSON.parse(g.Co(MD).entityId),
w0=cg.videoId)zL.has(w0)?(f.set(w0,zL.get(w0)),zL.delete(w0)):qR.push(w0);X=Number(((H=q.actionMetadata)==null?void 0:H.priority)||0)+1;P=g.S(zL.entries());for(D=P.next();!D.done;D=P.next())J=D.value,ks=g.S(J),z=ks.next().value,p=ks.next().value,A=z,La=p,$w.push(UB("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",A,"mainVideoEntity",X,VF,CWF(q,La,c)));ys=g.S(f.entries());for(GU=ys.next();!GU.done;GU=ys.next())kw=GU.value,Rj=g.S(kw),Hd=Rj.next().value,qE=Rj.next().value,Hs=Hd,FO=qE,$w.push(UB("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",
Hs,"mainVideoEntity",X,VF,CWF(q,FO,c)));Pd=g.S(qR);for(Ip=Pd.next();!Ip.done;Ip=Pd.next())UJ=Ip.value,DA={playlistId:c},vs={offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_REFRESH"},mainVideoEntityActionMetadata:DA},$w.push(UB("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",UJ,"mainVideoEntity",0,VF,vs));return bV.return(new uH("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",M,$w))}})},pAQ=function(n,q){var M,t,c,Y;
return g.u(function(G){switch(G.X){case 1:return M=k_(q),g.Ij(G,2),t=g.Co(q.entityKey).entityId,t==="!*$_ALL_ENTITIES_!*$"?g.U(G,wCF(n.X,q,n.Z,(c=q.actionMetadata)==null?void 0:(Y=c.offlineLoggingData)==null?void 0:Y.offlineDeleteReason),5):g.U(G,RBL(t,n.X,q,n.Z),6);case 6:if(!n.Q1.D("woffle_enable_main_downloads_library")){G.Fy(5);break}return g.U(G,QDK(n.X,q.entityKey),5);case 5:g.vd(G,3);break;case 2:return g.TU(G),G.return(new uH("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",M,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
"OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return G.return(new uH("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",M))}})},VUK=function(n,q,M,t){var c,Y,G,k,b,d,N;
return g.u(function(O){switch(O.X){case 1:return g.U(O,kSs([q]),2);case 2:return c=O.W,g.U(O,neK(n,c[0],M,t),3);case 3:return Y=O.W,G=Y.mainPlaylistEntity,k=Y.r1J,d=ZOA(G,(b=k)==null?void 0:b.avatar),g.Ij(O,4),g.U(O,XZ(d),6);case 6:g.vd(O,5);break;case 4:N=g.TU(O),N instanceof Error&&N.message==="Failed to fetch"&&iH(N.message);case 5:return O.return(c[0].videos)}})},neK=function(n,q,M,t){var c,Y,G,k,b,d,N,O,e,E,h,I,L,T,v,B,m;
return g.u(function(a){switch(a.X){case 1:c=Date.now().toString();M||(M=c);Y=q.videos;G=q.playlistId;k=[];b=[];if(Y)for(d=g.S(Y),N=d.next();!N.done;N=d.next()){O=N.value;e=O.offlineVideoData;if(!e||!e.videoId)throw iH("Invalid offlineVideoData for playlist"),Error("Invalid offlineVideoData for playlist");E=e.videoId;h={videoId:E,playlistId:G};I={id:g.rb(JSON.stringify(h),"mainPlaylistVideoEntity"),video:g.rb(E,"mainVideoEntity")};k.push(I);b.push(I.id)}T={key:g.rb(G,"mainPlaylistDownloadStateEntity"),
addedTimestampMillis:M,lastSyncedTimestampMillis:c};v={key:g.rb(G,"mainPlaylistEntity"),playlistId:G,videos:b,title:q.title,thumbnailStyleData:qHA(q),visibility:M6S(q),downloadState:T.key};q.channel&&(B=q.channel.offlineChannelData,L=ipT(g.rb(G,"ytMainChannelEntity"),B),v.channelOwner=L.id);((m=v)==null?0:m.entityMetadata)?(v.entityMetadata.offlineLastModifiedTimestampSeconds=q.lastModifiedTimestamp,t&&(v.entityMetadata.nextAutoRefreshIntervalSeconds=String(t))):v&&(v.entityMetadata={nextAutoRefreshIntervalSeconds:t?
String(t):void 0,offlineLastModifiedTimestampSeconds:q.lastModifiedTimestamp});g.Ij(a,2);return g.U(a,CR(n.X,{mode:"readwrite",fd:!0},function(x){var V=ws(x,v,"mainPlaylistEntity"),bf=ws(x,T,"mainPlaylistDownloadStateEntity");V=[V,bf];bf=g.S(k);for(var Ka=bf.next();!Ka.done;Ka=bf.next())V.push(ws(x,Ka.value,"mainPlaylistVideoEntity"));L&&V.push(ws(x,L,"ytMainChannelEntity"));return g.W6.all(V)}),4);
case 4:g.vd(a,3);break;case 2:throw g.TU(a),iH("PES failure for playlist"),Error("PES failure for playlist");case 3:return a.return({mainPlaylistEntity:v,r1J:L,Peg:k})}})},ipT=function(n,q){return{id:n,
channelId:q.channelId,title:q.title,avatar:q.thumbnail}},qHA=function(n){var q=[],M=n.videos;
M&&M.length>0&&q.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_FIRST_VIDEO"),value:{collageThumbnail:{coverThumbnail:M[0].offlineVideoData.thumbnail}}});if((n=n.additionalMetadadatas)&&n.length>0)for(n=g.S(n),M=n.next();!M.done;M=n.next()){var t=M.value.offlineBundleItemPlaylistData,c=void 0;M=(c=t)==null?void 0:c.style;c=void 0;t={collageThumbnail:{coverThumbnail:(c=t)==null?void 0:c.coverThumbnail}};switch(M){case "BUNDLE_ITEM_STYLE_UNSPECIFIED":q.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_UNKNOWN"),
value:t});break;case "BUNDLE_ITEM_STYLE_TWO_BY_TWO":q.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_TWO_BY_TWO"),value:t});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO_AVATAR":q.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO_AVATAR"),value:t});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO":q.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO"),value:t})}}return q},M6S=function(n){switch(n.privacy){case "PRIVATE":return"PLAYLIST_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_VISIBILITY_UNLISTED";default:return"PLAYLIST_VISIBILITY_UNKNOWN"}},CWF=function(n,q,M){q={offlineVideoData:q,
playlistId:M};if(n=g.R(n.actionMetadata,xww))q.maximumDownloadQuality=n.maximumDownloadQuality;return{mainVideoEntityActionMetadata:q}},t6G=function(n,q,M){this.X=n;
this.Q1=q;this.Z=M},GHQ=function(n,q){var M,t,c,Y,G,k,b,d,N,O,e,E,h;
return g.u(function(I){switch(I.X){case 1:return M=k_(q),t=g.Co(q.entityKey),c=t.entityId,Y=g.R(q.actionMetadata,CG),k=!((G=Y)==null?0:G.playlistId),g.Ij(I,2),g.U(I,cPL(n,c,void 0,(b=Y)==null?void 0:b.offlineVideoData,k),4);case 4:g.vd(I,3);break;case 2:return d=g.TU(I),N="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",O="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",d instanceof g.dz&&d.type==="QUOTA_EXCEEDED"&&(N="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",O="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
I.return(new uH("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",M,void 0,N,O));case 3:e=1;e=Number(((E=q.actionMetadata)==null?void 0:E.priority)||0)+1;var L=(L=g.R(q.actionMetadata,CG))?{playbackDataActionMetadata:{maximumDownloadQuality:L.maximumDownloadQuality}}:void 0;h=UB("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",c,"playbackData",e,YHD,L);return I.return(new uH("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",M,[h]))}})},K_w=function(n,q){var M,t,c,Y,G,k,b,d,N,O,e,E,h,I,L,T,v;
return g.u(function(B){switch(B.X){case 1:return M=k_(q),t=g.Co(q.entityKey),c=t.entityId,g.U(B,xU(n.X,q.entityKey,"mainVideoEntity"),2);case 2:Y=B.W;if(!Y){G=void 0;B.Fy(3);break}return g.U(B,xU(n.X,Y.downloadState,"mainVideoDownloadStateEntity"),4);case 4:G=B.W;case 3:k=G;if(!Y||!k)return B.return(new uH("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",M));g.Ij(B,5);return g.U(B,cPL(n,c,k.addedTimestampMillis,(d=g.R(q.actionMetadata,CG))==null?void 0:d.offlineVideoData),7);case 7:N=1;N=Number(((O=
q.actionMetadata)==null?void 0:O.priority)||0)+1;b=UB("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",c,"playbackData",N,YHD);g.vd(B,6);break;case 5:e=g.TU(B);if(!(e instanceof Error&&e.message==="No data")){if(e instanceof Error&&e.message==="Empty response body")iH(e.message);else return E="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",h="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",e instanceof g.dz&&e.type==="QUOTA_EXCEEDED"&&(E="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
h="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),B.return(new uH("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",M,void 0,E,h));B.Fy(6);break}return g.U(B,IC(n.X,c),9);case 9:I=B.W;L=g.R(q.actionMetadata,CG);if(v=(T=L)==null?void 0:T.playlistId)I.playlistId=v;I.offlineDeleteReason="OFFLINE_DELETE_REASON_UNAVAILABLE";return g.U(B,jD(c,n.X,q,n.Z,I),6);case 6:return B.return(new uH("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",M,b?[b]:void 0))}})},kHT=function(n,q){var M,t,c,Y,G,k,b,d,N,O;
return g.u(function(e){switch(e.X){case 1:return M=k_(q),g.Ij(e,2),t=g.Co(q.entityKey).entityId,t==="!*$_ALL_ENTITIES_!*$"?g.U(e,wCF(n.X,q,n.Z,(N=q.actionMetadata)==null?void 0:(O=N.offlineLoggingData)==null?void 0:O.offlineDeleteReason),5):g.U(e,IC(n.X,t),6);case 6:c=e.W;Y=g.R(q.actionMetadata,CG);if(k=(G=Y)==null?void 0:G.playlistId)c.playlistId=k;c.offlineDeleteReason=(b=q.actionMetadata)==null?void 0:(d=b.offlineLoggingData)==null?void 0:d.offlineDeleteReason;return g.U(e,jD(t,n.X,q,n.Z,c),7);
case 7:if(!n.Q1.D("woffle_enable_main_downloads_library")){e.Fy(5);break}return g.U(e,QDK(n.X,q.entityKey),5);case 5:g.vd(e,3);break;case 2:return g.TU(e),e.return(new uH("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",M,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return e.return(new uH("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",M))}})},cPL=function(n,q,M,t,c){var Y,G,k,b,d,N;
return g.u(function(O){switch(O.X){case 1:if(Y=t){O.Fy(2);break}return g.U(O,Kvn([q]),3);case 3:G=O.W,Y=G[0];case 2:return g.U(O,bpd(n,Y,M,c),4);case 4:k=O.W;b=k.mainVideoEntity;d=k.channelEntity;g.Ij(O,5);var e=EB(b.thumbnail),E=EB(d.avatar);return g.U(O,XZ(e.concat(E)),7);case 7:g.vd(O,0);break;case 5:N=g.TU(O),N instanceof Error&&N.message==="Failed to fetch"&&iH(N.message),g.Sk(O)}})},bpd=function(n,q,M,t){var c,Y,G,k,b,d,N,O,e,E,h,I,L;
return g.u(function(T){switch(T.X){case 1:M||(M=Date.now().toString());Y=(c=q.channel)==null?void 0:c.offlineChannelData;G={id:g.rb(q.videoId,"ytMainChannelEntity"),channelId:Y.channelId,title:Y.title,avatar:Y.thumbnail};k={key:g.rb(q.videoId,"mainVideoDownloadStateEntity"),playbackData:g.rb(q.videoId,"playbackData"),addedTimestampMillis:M,videoDownloadContextEntity:g.rb(q.videoId,"videoDownloadContextEntity")};b={key:g.rb(q.videoId,"videoPlaybackPositionEntity"),videoId:q.videoId,lastPlaybackPositionSeconds:"0"};
n.Q1.D("html5_offline_playback_position_sync")&&(d={playbackPosition:b.key});N=g.rb(q.videoId,"mainVideoEntity");O={key:N,videoId:q.videoId,title:q.title,thumbnail:q.thumbnail,localizedStrings:{viewCount:q.shortViewCountText},userState:d,lengthSeconds:q.lengthSeconds?Number(q.lengthSeconds):void 0,publishedTimestampMillis:q.publishedTimestamp?(Number(q.publishedTimestamp)*1E3).toString():void 0,formattedDescription:q.description,owner:G.id,downloadState:k.key};if(!n.Q1.D("woffle_enable_main_downloads_library")||
!t){T.Fy(2);break}return g.U(T,rdT(n.X,[N]),3);case 3:if(h=T.W)e=h.mainDownloadsLibraryEntity,E=h.mainDownloadsListEntity;case 2:return L=BEL,I={key:g.rb(q.videoId,"downloadStatusEntity"),downloadState:"DOWNLOAD_STATE_PENDING_DOWNLOAD"},g.uo(k,L,I),g.U(T,CR(n.X,{mode:"readwrite",fd:!0},function(v){var B=ws(v,G,"ytMainChannelEntity"),m=ws(v,k,"mainVideoDownloadStateEntity"),a=ws(v,O,"mainVideoEntity");B=[B,m,a];n.Q1.D("html5_offline_playback_position_sync")&&(m=ws(v,b,"videoPlaybackPositionEntity"),
B.push(m));e&&(m=ws(v,e,"mainDownloadsLibraryEntity"),B.push(m));E&&(m=ws(v,E,"mainDownloadsListEntity"),B.push(m));I&&(v=ws(v,I,"downloadStatusEntity"),B.push(v));return g.W6.all(B)}),4);
case 4:return T.return({mainVideoEntity:O,channelEntity:G})}})},dss=function(n,q,M){this.X=n;
this.Q1=q;this.Z=M},OpD=function(n,q){var M,t,c,Y,G,k,b,d,N,O,e,E,h,I,L,T,v,B,m,a,x,V,bf,Ka,dd,gd,MR;
return g.u(function(lf){switch(lf.X){case 1:return M=k_(q),t=[],g.U(lf,$U.getInstance(),2);case 2:c=lf.W;if(!c){lf.Fy(3);break}return g.U(lf,c.get("sdois"),4);case 4:return Y=lf.W,g.U(lf,(k=c)==null?void 0:k.get("lmqf"),5);case 5:G=lf.W;case 3:g.Ij(lf,6);if(Y===void 0)throw Error("prefStorage or opt-in state is undefined");b=[];if(Y){lf.Fy(8);break}return g.U(lf,CMn(n.X),9);case 9:b=lf.W,b.reverse();case 8:if(!b.length){lf.Fy(10);break}d=g.S(b);N=d.next();case 11:if(N.done){lf.Fy(10);break}O=N.value;
if(!O){lf.Fy(12);break}e=g.Co(O).entityId;return g.U(lf,IC(n.X,e),14);case 14:return E=lf.W,E.offlineDeleteReason="OFFLINE_DELETE_REASON_PARENT_LIST_DELETE",g.U(lf,jD(e,n.X,{entityKey:O,actionType:q.actionType},n.Z,E),12);case 12:N=d.next();lf.Fy(11);break;case 10:return g.U(lf,O4G(Y,(h=G)!=null?h:"SD"),16);case 16:return I=lf.W,g.U(lf,zBQ(I),17);case 17:L=Vwd(I);if(!n.Q1.D("woffle_enable_main_downloads_library")){lf.Fy(18);break}if(Y){lf.Fy(19);break}return g.U(lf,QDK(n.X,g.mj),19);case 19:return g.U(lf,
xbs(n.X,[g.mj]),18);case 18:if((T=L)==null?0:T.length)for(v=g.S(L),B=v.next();!B.done;B=v.next())if(a=m=B.value,x=a.actionType,V=a.entityKey,bf=a.actionMetadata,x&&V&&bf&&!g.R(bf,NOw)){x==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(bf.offlineLoggingData={offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});if(Ka=g.R(m.actionMetadata,CG))Ka.playlistId="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS",m.actionMetadata=Object.assign({},m.actionMetadata,{mainVideoEntityActionMetadata:Ka});t.push(m)}g.vd(lf,
7);break;case 6:return dd=g.TU(lf),gd="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",MR="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",dd instanceof g.dz&&dd.type==="QUOTA_EXCEEDED"&&(gd="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",MR="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),lf.return(new uH("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",M,void 0,gd,MR));case 7:return lf.return(new uH("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",M,t))}})},geO=function(){z9.apply(this,
arguments);
this.U="mainVideoEntity"},e_F=function(n,q,M){q=q===void 0?43200:q;
M=M===void 0?!0:M;var t=t===void 0?!1:t;var c,Y,G;return g.u(function(k){switch(k.X){case 1:if(!n.C.nT())return k.return([]);c=[];g.Ij(k,2);return g.U(k,dNO(q,M,t),4);case 4:c=k.W;g.vd(k,3);break;case 2:Y=g.TU(k),Y instanceof Error&&Y.message==="No data"||Y instanceof Error&&Y.message==="Empty response body"&&iH(Y.message);case 3:return G=wAD(n,c,M,"mainPlaylistEntity"),k.return(G)}})},EeF=function(n,q,M,t){t=t===void 0?!1:t;
var c,Y,G,k,b,d,N,O,e,E,h,I,L,T,v;return g.u(function(B){switch(B.X){case 1:return c=[],g.U(B,NYw(),2);case 2:return(Y=B.W)||t?g.U(B,giQ(q,M),3):B.return([]);case 3:G=B.W;if((k=G)==null||!k.length)return B.return([]);b={offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_REFRESH"};d=g.S(G);N=d.next();case 4:if(N.done){B.Fy(6);break}e=O=N.value;E=e.actionType;h=e.entityKey;I=e.actionMetadata;if(!(E&&h&&I)||g.R(I,NOw)){B.Fy(5);break}E==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(I.offlineLoggingData=
b);L=g.Co(h);T=L.entityId;return g.U(B,J6(n,[T],"mainVideoEntity",E,I),8);case 8:v=B.W,c=c.concat(v);case 5:N=d.next();B.Fy(4);break;case 6:return B.return(c)}})},h_n=function(n,q){this.X=n;
this.Z=q},yPs=function(n,q){var M,t,c,Y,G,k,b,d,N,O,e,E,h,I,L,T;
return g.u(function(v){switch(v.X){case 1:return M=k_(q),t=g.Co(q.entityKey),c=t.entityId,Y=[],g.Ij(v,2),g.U(v,W_G(n,c),4);case 4:Y=v.W;if((G=Y)==null||!G.length){v.Fy(5);break}return g.U(v,i4S(n.X,q.entityKey),5);case 5:g.vd(v,3);break;case 2:return k=g.TU(v),b="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",d="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",k instanceof g.dz&&k.type==="QUOTA_EXCEEDED"&&(b="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",d="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
v.return(new uH("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",M,void 0,b,d));case 3:return N=[],g.U(v,Dbs(n.X,"musicTrack",Y),7);case 7:Y=v.W;if(Y.length)for(O=g.S(Y),e=O.next();!e.done;e=O.next())if(E=e.value,h=E.offlineVideoData,I=void 0,(I=h)==null?0:I.videoId)L=void 0,T=Number(((L=q.actionMetadata)==null?void 0:L.priority)||0)+1,N.push(UB("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",h.videoId,"musicTrack",T,rR,P1(q,h,c)));return v.return(new uH("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",M,N))}})},
sNs=function(n,q){var M,t,c,Y,G,k,b,d,N,O,e,E,h,I,L,T,v,B,m,a,x,V,bf,Ka,dd,gd,MR,lf,rd,gT,ND,V1,uf,K3,$w,zL,ku,l,uV,LQ,t_,Ps,f,qR,v7,xu,aG,Ca,MD,cg,w0,H,X,P,D,J,ks,z,p;
return g.u(function(A){switch(A.X){case 1:return M=k_(q),t=q.entityKey,c=g.Co(t).entityId,Y=[],G=!1,c==="!*$_ALL_ENTITIES_!*$"?(G=!0,g.U(A,Qq(n.X,"musicAlbumRelease"),5)):g.U(A,xU(n.X,t,"musicAlbumRelease"),4);case 4:(k=A.W)&&Y.push(k);A.Fy(3);break;case 5:Y=A.W;case 3:if((b=Y)==null||!b.length)return A.return(new uH("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",M));if(G){d=[];N=g.S(Y);for(O=N.next();!O.done;O=N.next())e=O.value,E=g.Co(e.id).entityId,d.push(UB("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",
E,"musicAlbumRelease",0,rR));return A.return(new uH("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",M,d))}h=[];I=Y[0];L=void 0;if(!I.downloadMetadata){A.Fy(6);break}return g.U(A,xU(n.X,I.downloadMetadata,"musicAlbumReleaseDownloadMetadataEntity"),7);case 7:T=A.W,L=Number((B=(v=T)==null?void 0:v.addedTimestampMillis)!=null?B:"0")/1E3;case 6:return g.Ij(A,8),g.U(A,W_G(n,c,(m=L)==null?void 0:m.toString()),10);case 10:h=A.W;g.vd(A,9);break;case 8:a=g.TU(A);if(!(a instanceof Error&&a.message==="No data")){if(a instanceof
Error&&a.message==="Empty response body")iH(a.message);else return x="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",V="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",a instanceof g.dz&&a.type==="QUOTA_EXCEEDED"&&(x="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",V="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),A.return(new uH("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",M,void 0,x,V));A.Fy(9);break}return g.U(A,H1(c,"musicAlbumRelease",n.X,q,n.Z),9);case 9:bf=[];Ka=new Map;
if((dd=h)==null?0:dd.length)for(gd=g.S(h),MR=gd.next();!MR.done;MR=gd.next())lf=MR.value,rd=lf.offlineVideoData,gT=void 0,((gT=rd)==null?0:gT.videoId)&&Ka.set(rd.videoId,rd);ND=new Map;V1=[];if((uf=I)==null?0:(K3=uf.tracks)==null?0:K3.length)for($w=g.S(I.tracks),zL=$w.next();!zL.done;zL=$w.next())if(ku=zL.value,l=g.Co(ku).entityId)Ka.has(l)?(ND.set(l,Ka.get(l)),Ka.delete(l)):V1.push(l);LQ=Number(((uV=q.actionMetadata)==null?void 0:uV.priority)||0)+1;t_=g.S(Ka.entries());for(Ps=t_.next();!Ps.done;Ps=
t_.next())f=Ps.value,qR=g.S(f),v7=qR.next().value,xu=qR.next().value,aG=v7,Ca=xu,bf.push(UB("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",aG,"musicTrack",LQ,rR,P1(q,Ca)));MD=g.S(ND.entries());for(cg=MD.next();!cg.done;cg=MD.next())w0=cg.value,H=g.S(w0),X=H.next().value,P=H.next().value,D=X,J=P,bf.push(UB("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",D,"musicTrack",LQ,rR,P1(q,J)));ks=g.S(V1);for(z=ks.next();!z.done;z=ks.next())p=z.value,bf.push(UB("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",p,"musicTrack",
0,rR));return A.return(new uH("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",M,bf))}})},XkL=function(n,q){var M,t;
return g.u(function(c){switch(c.X){case 1:return M=k_(q),g.Ij(c,2),t=g.Co(q.entityKey).entityId,t==="!*$_ALL_ENTITIES_!*$"?g.U(c,LG(n.X,q,n.Z),5):g.U(c,H1(t,"musicAlbumRelease",n.X,q,n.Z),6);case 6:return g.U(c,tAG(n.X,q.entityKey),5);case 5:g.vd(c,3);break;case 2:return g.TU(c),c.return(new uH("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",M,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return c.return(new uH("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
M))}})},W_G=function(n,q,M){var t,c,Y;
return g.u(function(G){switch(G.X){case 1:return g.U(G,kSs([q]),2);case 2:return t=G.W,g.U(G,jNs(n,t[0],M),3);case 3:return c=G.W,Y=EB(c.thumbnailDetails),g.U(G,XZ(Y),4);case 4:return G.return(t[0].videos)}})},jNs=function(n,q,M){var t,c,Y,G,k,b,d,N,O,e,E,h,I,L;
return g.u(function(T){if(T.X==1){t=q.additionalMetadadatas;c=void 0;if(t&&t.length>0)for(Y=g.S(t),G=Y.next();!G.done;G=Y.next())if(k=G.value,k.offlineMusicPlaylistData){c=k.offlineMusicPlaylistData;break}b=q.playlistId;d=csT(q);N=d.nD;O=d.GO;e=M?(Number(M)*1E3).toString():Date.now().toString();E=q.lastModifiedTimestamp?(Number(q.lastModifiedTimestamp)*1E3).toString():"0";h={id:g.rb(b,"musicAlbumReleaseDownloadMetadataEntity"),trackDownloadMetadatas:O,lastModifiedTimestampMillis:E,addedTimestampMillis:e,
syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"};I={id:g.rb(b,"musicAlbumRelease"),title:q.title,audioPlaylistId:b,trackCount:q.totalVideoCount,tracks:N,downloadMetadata:h.id};c&&(I.thumbnailDetails=(L=c.albumHqThumbnail)!=null?L:c.albumArtistThumbnail,I.artistDisplayName=c.albumArtistDisplayName,I.releaseDate=c.albumReleaseDate,I.contentRating={explicitType:c.albumReleaseExplicitType},I.releaseType=c.albumReleaseType);return g.U(T,CR(n.X,{mode:"readwrite",fd:!0},function(v){var B=ws(v,I,"musicAlbumRelease");
v=ws(v,h,"musicAlbumReleaseDownloadMetadataEntity");return g.W6.all([B,v])}),2)}return T.return(I)})},SHD=function(n,q){this.X=n;
this.Z=q},f_n=function(n,q){var M,t,c,Y,G,k,b,d,N,O,e,E,h,I,L,T;
return g.u(function(v){switch(v.X){case 1:return M=k_(q),t=g.Co(q.entityKey),c=t.entityId,Y=[],g.Ij(v,2),g.U(v,I_F(n,c),4);case 4:Y=v.W;if((G=Y)==null||!G.length){v.Fy(5);break}return g.U(v,i4S(n.X,q.entityKey),5);case 5:g.vd(v,3);break;case 2:return k=g.TU(v),b="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",d="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",k instanceof g.dz&&k.type==="QUOTA_EXCEEDED"&&(b="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",d="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
v.return(new uH("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",M,void 0,b,d));case 3:return N=[],g.U(v,Dbs(n.X,"musicTrack",Y),7);case 7:Y=v.W;if(Y.length)for(O=g.S(Y),e=O.next();!e.done;e=O.next())if(E=e.value,h=E.offlineVideoData,I=void 0,(I=h)==null?0:I.videoId)L=void 0,T=Number(((L=q.actionMetadata)==null?void 0:L.priority)||0)+1,N.push(UB("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",h.videoId,"musicTrack",T,x_,P1(q,h,c)));return v.return(new uH("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",M,N))}})},
HpF=function(n,q){var M,t,c,Y,G,k,b,d,N,O,e,E,h,I,L,T,v,B,m,a,x,V,bf,Ka,dd,gd,MR,lf,rd,gT,ND,V1,uf,K3,$w,zL,ku,l,uV,LQ,t_,Ps,f,qR,v7,xu,aG,Ca,MD,cg,w0,H,X,P,D,J,ks,z,p,A,La,ys,GU,kw,Rj,Hd,qE,Hs,FO,Pd,Ip;
return g.u(function(UJ){switch(UJ.X){case 1:return M=k_(q),t=q.entityKey,c=g.Co(t).entityId,Y=[],G=!1,c==="!*$_ALL_ENTITIES_!*$"?(G=!0,g.U(UJ,Qq(n.X,"musicPlaylist"),5)):g.U(UJ,xU(n.X,t,"musicPlaylist"),4);case 4:(k=UJ.W)&&Y.push(k);UJ.Fy(3);break;case 5:Y=UJ.W;case 3:if((b=Y)==null||!b.length)return UJ.return(new uH("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",M));d=g.R(q.actionMetadata,YXd);O=(N=d)==null?void 0:N.autoSync;e=[];h=E=!0;I=!1;L=void 0;if(!G&&O===!1){UJ.Fy(6);break}g.Ij(UJ,7);return g.U(UJ,
eQs(0,!!O,!0,Y),9);case 9:e=UJ.W;g.vd(UJ,8);break;case 7:T=g.TU(UJ);if(!(T instanceof Error&&T.message==="No data")){T instanceof Error&&T.message==="Empty response body"&&iH(T.message);UJ.Fy(8);break}return c==="!*$_ALL_ENTITIES_!*$"?g.U(UJ,LG(n.X,q,n.Z),8):g.U(UJ,H1(c,"musicPlaylist",n.X,q,n.Z),8);case 8:if(!e.length||!G&&e[0].playlistId!==c)return UJ.return(new uH("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",M));case 6:if(G){v=[];B=g.S(e);for(m=B.next();!m.done;m=B.next())a=m.value,a.upToDate||
O&&!a.shouldAutoSyncMetadata||!a.playlistId||(x={autoSync:O},v.push(UB("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",a.playlistId,"musicPlaylist",0,x_,{musicPlaylistEntityActionMetadata:x})));return UJ.return(new uH("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",M,v))}e.length&&(V=e[0],I=!!V.upToDate,O&&(E=(bf=V.shouldAutoSyncMetadata)!=null?bf:!0,h=(Ka=V.shouldAutoSyncVideos)!=null?Ka:!0,V.checkInSeconds&&(L=V.checkInSeconds)));if(I||!E)return UJ.return(new uH("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
M));dd=[];gd=Y[0];MR=void 0;if(!gd.downloadMetadata){UJ.Fy(15);break}return g.U(UJ,xU(n.X,gd.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),16);case 16:lf=UJ.W,MR=Number((gT=(rd=lf)==null?void 0:rd.addedTimestampMillis)!=null?gT:"0")/1E3;case 15:return g.Ij(UJ,17),g.U(UJ,I_F(n,c,(ND=MR)==null?void 0:ND.toString(),L),19);case 19:dd=UJ.W;g.vd(UJ,18);break;case 17:V1=g.TU(UJ);if(!(V1 instanceof Error&&V1.message==="No data")){if(V1 instanceof Error&&V1.message==="Empty response body")iH(V1.message);
else return uf="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",K3="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",V1 instanceof g.dz&&V1.type==="QUOTA_EXCEEDED"&&(uf="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",K3="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),UJ.return(new uH("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",M,void 0,uf,K3));UJ.Fy(18);break}return g.U(UJ,H1(c,"musicPlaylist",n.X,q,n.Z),18);case 18:if(!h)return UJ.return(new uH("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
M));$w=[];zL=new Map;if((ku=dd)==null?0:ku.length)for(l=g.S(dd),uV=l.next();!uV.done;uV=l.next())LQ=uV.value,t_=LQ.offlineVideoData,Ps=void 0,((Ps=t_)==null?0:Ps.videoId)&&zL.set(t_.videoId,t_);f=new Map;qR=[];if((v7=gd)==null?0:(xu=v7.tracks)==null?0:xu.length)for(aG=g.S(gd.tracks),Ca=aG.next();!Ca.done;Ca=aG.next())if(MD=Ca.value,cg=g.Co(MD).entityId)zL.has(cg)?(f.set(cg,zL.get(cg)),zL.delete(cg)):qR.push(cg);H=Number(((w0=q.actionMetadata)==null?void 0:w0.priority)||0)+1;X=g.S(zL.entries());for(P=
X.next();!P.done;P=X.next())D=P.value,J=g.S(D),ks=J.next().value,z=J.next().value,p=ks,A=z,$w.push(UB("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",p,"musicTrack",H,x_,P1(q,A)));La=g.S(f.entries());for(ys=La.next();!ys.done;ys=La.next())GU=ys.value,kw=g.S(GU),Rj=kw.next().value,Hd=kw.next().value,qE=Rj,Hs=Hd,$w.push(UB("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",qE,"musicTrack",H,x_,P1(q,Hs)));FO=g.S(qR);for(Pd=FO.next();!Pd.done;Pd=FO.next())Ip=Pd.value,$w.push(UB("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
Ip,"musicTrack",0,x_));return UJ.return(new uH("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",M,$w))}})},L_D=function(n,q){var M,t;
return g.u(function(c){switch(c.X){case 1:return M=k_(q),g.Ij(c,2),t=g.Co(q.entityKey).entityId,t==="!*$_ALL_ENTITIES_!*$"?g.U(c,LG(n.X,q,n.Z),5):g.U(c,H1(t,"musicPlaylist",n.X,q,n.Z),6);case 6:return g.U(c,tAG(n.X,q.entityKey),5);case 5:g.vd(c,3);break;case 2:return g.TU(c),c.return(new uH("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",M,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return c.return(new uH("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
M))}})},I_F=function(n,q,M,t){var c,Y,G;
return g.u(function(k){switch(k.X){case 1:return g.U(k,kSs([q]),2);case 2:return c=k.W,g.U(k,PlL(n,c[0],M,t),3);case 3:return Y=k.W,G=EB(Y.thumbnailDetails),g.U(k,XZ(G),4);case 4:return k.return(c[0].videos)}})},PlL=function(n,q,M,t){var c,Y,G,k,b,d,N,O,e;
return g.u(function(E){return E.X==1?(c=q.playlistId,Y=csT(q),G=Y.nD,k=Y.GO,b=M?(Number(M)*1E3).toString():Date.now().toString(),d=q.lastModifiedTimestamp?(Number(q.lastModifiedTimestamp)*1E3).toString():"0",N={id:g.rb(c,"musicPlaylistDownloadMetadataEntity"),trackDownloadMetadatas:k,lastModifiedTimestampMillis:d,addedTimestampMillis:b,syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"},O={id:g.rb(c,"musicPlaylist"),title:q.title,playlistId:c,thumbnailDetails:q.thumbnail,visibility:veD(q),trackCount:q.totalVideoCount,
tracks:G,downloadMetadata:N.id},t&&(((e=O)==null?0:e.entityMetadata)?O.entityMetadata.nextAutoRefreshIntervalSeconds=String(t):O&&(O.entityMetadata={nextAutoRefreshIntervalSeconds:String(t)})),g.U(E,CR(n.X,{mode:"readwrite",fd:!0},function(h){var I=ws(h,O,"musicPlaylist");h=ws(h,N,"musicPlaylistDownloadMetadataEntity");return g.W6.all([I,h])}),2)):E.return(O)})},veD=function(n){switch(n.privacy){case "PRIVATE":return"PLAYLIST_ENTITY_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_ENTITY_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_ENTITY_VISIBILITY_UNLISTED";default:return"PLAYLIST_ENTITY_VISIBILITY_UNKNOWN"}},TOF=function(n,q){this.X=n;
this.Z=q},BOT=function(n,q){var M,t,c,Y,G,k,b,d,N,O,e,E,h;
return g.u(function(I){switch(I.X){case 1:return M=k_(q),t=g.Co(q.entityKey),c=t.entityId,Y=g.R(q.actionMetadata,l_s),g.Ij(I,2),g.U(I,UsK(n,c,void 0,(G=Y)==null?void 0:G.track,(k=Y)==null?void 0:k.albumRelease),4);case 4:if((b=Y)==null?0:b.playlistId){I.Fy(5);break}return g.U(I,i4S(n.X,q.entityKey),5);case 5:g.vd(I,3);break;case 2:return d=g.TU(I),N="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",O="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",d instanceof g.dz&&d.type==="QUOTA_EXCEEDED"&&
(N="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",O="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),I.return(new uH("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",M,void 0,N,O));case 3:E=Number(((e=q.actionMetadata)==null?void 0:e.priority)||0)+1;var L=(L=g.R(q.actionMetadata,l_s))?{playbackDataActionMetadata:{maximumDownloadQuality:L.maximumDownloadQuality}}:void 0;h=UB("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",c,"playbackData",E,u$T,L);return I.return(new uH("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
M,[h]))}})},Dss=function(n,q){var M,t,c,Y,G,k,b,d,N,O,e,E,h,I,L;
return g.u(function(T){switch(T.X){case 1:return M=k_(q),t=g.Co(q.entityKey),c=t.entityId,g.U(T,xU(n.X,q.entityKey,"musicTrack"),2);case 2:Y=T.W;if(!Y){G=void 0;T.Fy(3);break}return g.U(T,xU(n.X,Y.downloadMetadata,"musicTrackDownloadMetadataEntity"),4);case 4:G=T.W;case 3:k=G;if(!Y||!k)return T.return(new uH("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",M));d=g.R(q.actionMetadata,l_s);g.Ij(T,5);return g.U(T,UsK(n,c,k.addedTimestampMillis,(N=d)==null?void 0:N.track,(O=d)==null?void 0:O.albumRelease),
7);case 7:E=Number(((e=q.actionMetadata)==null?void 0:e.priority)||0)+1;b=UB("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",c,"playbackData",E,u$T);g.vd(T,6);break;case 5:h=g.TU(T);if(!(h instanceof Error&&h.message==="No data")){if(h instanceof Error&&h.message==="Empty response body")iH(h.message);else return I="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",L="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",h instanceof g.dz&&h.type==="QUOTA_EXCEEDED"&&(I="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
L="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),T.return(new uH("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",M,void 0,I,L));T.Fy(6);break}return g.U(T,fG(c,n.X,q,n.Z),6);case 6:return T.return(new uH("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",M,b?[b]:void 0))}})},APw=function(n,q){var M,t;
return g.u(function(c){switch(c.X){case 1:return M=k_(q),g.Ij(c,2),t=g.Co(q.entityKey).entityId,t==="!*$_ALL_ENTITIES_!*$"?g.U(c,LG(n.X,q,n.Z),5):g.U(c,fG(t,n.X,q,n.Z),6);case 6:return g.U(c,tAG(n.X,q.entityKey),5);case 5:g.vd(c,3);break;case 2:return g.TU(c),c.return(new uH("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",M,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return c.return(new uH("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
M))}})},UsK=function(n,q,M,t,c){var Y,G,k,b,d,N;
return g.u(function(O){switch(O.X){case 1:if(Y=t){O.Fy(2);break}return g.U(O,Kvn([q]),3);case 3:G=O.W,k=G[0],Y=MAd(k);case 2:return g.U(O,mss(n,Y,q,c,M),4);case 4:b=O.W;d=b.musicTrackEntity;N=b.VB;var e=EB(d.thumbnailDetails),E=[];N&&(E=EB(N.thumbnailDetails));return g.U(O,XZ(e.concat(E)),0)}})},mss=function(n,q,M,t,c){var Y;
return g.u(function(G){return G.X==1?(c||(c=Date.now().toString()),Y={id:g.rb(M,"musicTrackDownloadMetadataEntity"),playbackData:g.rb(M,"playbackData"),addedTimestampMillis:c,videoDownloadContextEntity:g.rb(M,"videoDownloadContextEntity")},t&&(q.albumRelease=t.id),g.U(G,CR(n.X,{mode:"readwrite",fd:!0},function(k){var b=[],d=ws(k,Y,"musicTrackDownloadMetadataEntity");b.push(d);d=ws(k,q,"musicTrack");b.push(d);t&&(k=ws(k,t,"musicAlbumRelease"),b.push(k));return g.W6.all(b)}),2)):G.X!=3?g.U(G,OB(M,"musicTrackDownloadMetadataEntity",
n.X,"DOWNLOAD_STATE_PENDING_DOWNLOAD"),3):G.return({musicTrackEntity:q,
VB:t})})},QF=function(){z9.apply(this,arguments);
this.U="musicTrack"},$sG=function(n,q,M){q=q===void 0?43200:q;
M=M===void 0?!0:M;var t=t===void 0?!1:t;var c,Y;return g.u(function(G){switch(G.X){case 1:if(!n.C.nT())return G.return([]);c=[];g.Ij(G,2);return g.U(G,eQs(q,M,t),4);case 4:c=G.W;g.vd(G,3);break;case 2:g.TU(G);case 3:return Y=wAD(n,c,M,"musicPlaylist"),G.return(Y)}})},F_S=function(){g.Ib.apply(this,arguments);
var n=this;this.events=new g.f8(this);this.Q1=this.player.T();this.vg={aYt:function(){return n.X},
Hl:function(){return n.Hl()},
RP:function(q){return n.RP(q)}}},ZpQ=function(n){var q;
n=g.R((q=n.getWatchNextResponse())==null?void 0:q.currentVideoEndpoint,g.HO);if(n==null?0:n.playlistId)var M=n.playlistId;return M},a_s=function(n,q){var M,t,c,Y;
return g.u(function(G){if(G.X==1){M=q.clientPlaybackNonce;t={cpn:M,offlineSourceVisualElement:g.Ey(q.SX||"").getAsJson(),selectedOfflineMode:"OFFLINE_NOW",isPartialPlayback:!1};q.W&&(t.videoFmt=Number(q.W.itag));q.J&&(t.audioFmt=Number(q.J.itag));if((c=ZpQ(q))&&q.videoId){var k=q.videoId;k=c!=="PPSV"?Promise.resolve(!1):n.X.ze(k);G=g.U(G,k,3)}else G=G.Fy(2);return G}G.X!=2&&(Y=G.W)&&(t.selectedOfflineMode="OFFLINE_MODE_TYPE_AUTO_OFFLINE");n.W=M;g.tx("offlinePlaybackStarted",t);g.Sk(G)})};
g.Jv.prototype.Wa=g.cd(45,function(n){return this.app.Wa(n)});
g.hu.prototype.Wa=g.cd(44,function(n){return g.oSm(this,9,n)});
g.y(A7,Dp);g.Ys.Object.defineProperties(A7.prototype,{entityMetadata:{configurable:!0,enumerable:!0,get:function(){return this.X.entityMetadata},
set:function(n){this.X.entityMetadata=n}}});
g.y(vbF,A7);vbF.prototype.W=function(){return[]};
g.y(TlF,A7);TlF.prototype.W=function(){return[]};
g.y(l8Q,A7);l8Q.prototype.W=function(){return[]};
g.y(UOF,A7);UOF.prototype.W=function(){return[]};
g.y(u7Q,A7);u7Q.prototype.W=function(){return[]};
g.y(BlA,A7);BlA.prototype.W=function(){var n=[];this.X.alternateChannel&&n.push(this.X.alternateChannel);this.X.alternateChannelList&&n.push.apply(n,g.EJ(this.X.alternateChannelList));this.X.oneofChannelEntity&&n.push(this.X.oneofChannelEntity);return[].concat(g.EJ(new Set(n)))};
g.y(DOD,A7);DOD.prototype.W=function(){var n=[];this.X.entryCollection&&n.push(this.X.entryCollection);return[].concat(g.EJ(new Set(n)))};
g.y(Atd,Dp);Atd.prototype.W=function(){var n=[];this.X.video&&n.push(this.X.video);return[].concat(g.EJ(new Set(n)))};
g.y(mOQ,A7);mOQ.prototype.W=function(){var n=[];this.X.parentPlaylist&&n.push(this.X.parentPlaylist);if(this.X.entries)for(var q=g.S(this.X.entries),M=q.next();!M.done;M=q.next())n.push.apply(n,g.EJ((new Atd(M.value)).W()));return[].concat(g.EJ(new Set(n)))};
g.y($Os,A7);$Os.prototype.W=function(){var n=[];this.X.descriptionEntity&&n.push(this.X.descriptionEntity);this.X.creators&&n.push.apply(n,g.EJ(this.X.creators));this.X.theBiggestFan&&n.push(this.X.theBiggestFan);return[].concat(g.EJ(new Set(n)))};
g.y(FJF,A7);FJF.prototype.W=function(){return[]};
g.y(ZCF,A7);ZCF.prototype.W=function(){return[]};
g.y(a8w,A7);a8w.prototype.W=function(){return[]};
g.y(RwD,A7);RwD.prototype.W=function(){return[]};
g.y(obn,A7);obn.prototype.W=function(){return[]};
g.y(wLS,A7);wLS.prototype.W=function(){return[]};
g.y(zwd,A7);zwd.prototype.W=function(){return[]};
g.y(Jts,A7);Jts.prototype.W=function(){return[]};
g.y(VZF,A7);VZF.prototype.W=function(){return[]};
g.y(C9n,A7);C9n.prototype.W=function(){var n=[];this.X.downloadsList&&n.push(this.X.downloadsList);this.X.smartDownloadsList&&n.push(this.X.smartDownloadsList);this.X.recommendedDownloadsList&&n.push(this.X.recommendedDownloadsList);this.X.refresh&&n.push(this.X.refresh);return[].concat(g.EJ(new Set(n)))};
g.y(rtS,Dp);rtS.prototype.W=function(){var n=[];this.X.video&&n.push(this.X.video);this.X.playlist&&n.push(this.X.playlist);this.X.videoItem&&n.push(this.X.videoItem);this.X.playlistItem&&n.push(this.X.playlistItem);return[].concat(g.EJ(new Set(n)))};
g.y(xOF,A7);xOF.prototype.W=function(){var n=[];this.X.refresh&&n.push(this.X.refresh);if(this.X.downloads)for(var q=g.S(this.X.downloads),M=q.next();!M.done;M=q.next())n.push.apply(n,g.EJ((new rtS(M.value)).W()));return[].concat(g.EJ(new Set(n)))};
g.y(Qqd,A7);Qqd.prototype.W=function(){var n=[];this.X.localImageEntities&&n.push.apply(n,g.EJ(this.X.localImageEntities));return[].concat(g.EJ(new Set(n)))};
g.y(pLs,A7);pLs.prototype.W=function(){var n=[];this.X.playbackData&&n.push(this.X.playbackData);this.X.localImageEntities&&n.push.apply(n,g.EJ(this.X.localImageEntities));this.X.videoDownloadContextEntity&&n.push(this.X.videoDownloadContextEntity);return[].concat(g.EJ(new Set(n)))};
g.y(n4Q,A7);n4Q.prototype.W=function(){return[]};
g.y(qNs,A7);qNs.prototype.W=function(){var n=[];this.X.fakeChildren&&n.push.apply(n,g.EJ(this.X.fakeChildren));return[].concat(g.EJ(new Set(n)))};
g.y(Mgd,A7);Mgd.prototype.W=function(){var n=[];this.X.video&&n.push(this.X.video);this.X.playbackData&&n.push(this.X.playbackData);this.X.offlineVideoPolicy&&n.push(this.X.offlineVideoPolicy);return[].concat(g.EJ(new Set(n)))};
g.y(i1F,A7);i1F.prototype.W=function(){return[]};
g.y(tgO,A7);tgO.prototype.W=function(){var n=[];this.X.channelOwner&&n.push(this.X.channelOwner);this.X.videos&&n.push.apply(n,g.EJ(this.X.videos));this.X.collaboratorChannels&&n.push.apply(n,g.EJ(this.X.collaboratorChannels));this.X.downloadState&&n.push(this.X.downloadState);this.X.refresh&&n.push(this.X.refresh);return[].concat(g.EJ(new Set(n)))};
g.y(cbs,A7);cbs.prototype.W=function(){var n=[];this.X.video&&n.push(this.X.video);this.X.channelContributor&&n.push(this.X.channelContributor);return[].concat(g.EJ(new Set(n)))};
g.y(YNs,Dp);YNs.prototype.W=function(){var n=[];this.X.localImageEntities&&n.push.apply(n,g.EJ(this.X.localImageEntities));this.X.videoDownloadContextEntity&&n.push(this.X.videoDownloadContextEntity);return[].concat(g.EJ(new Set(n)))};
g.y(GDL,Dp);GDL.prototype.W=function(){var n=[];this.X.recommendedVideoMetadata&&n.push.apply(n,g.EJ((new YNs(this.X.recommendedVideoMetadata)).W()));return[].concat(g.EJ(new Set(n)))};
g.y(K5S,Dp);K5S.prototype.W=function(){var n=[];this.X.playbackPosition&&n.push(this.X.playbackPosition);return[].concat(g.EJ(new Set(n)))};
g.y(kDD,A7);kDD.prototype.W=function(){var n=[];this.X.owner&&n.push(this.X.owner);this.X.downloadState&&n.push(this.X.downloadState);this.X.userState&&n.push.apply(n,g.EJ((new K5S(this.X.userState)).W()));this.X.additionalMetadata&&n.push.apply(n,g.EJ((new GDL(this.X.additionalMetadata)).W()));return[].concat(g.EJ(new Set(n)))};
g.y(b1L,A7);b1L.prototype.W=function(){var n=[];this.X.userChannelDetails&&n.push(this.X.userChannelDetails);return[].concat(g.EJ(new Set(n)))};
g.y(den,A7);den.prototype.W=function(){var n=[];this.X.channelOwner&&n.push(this.X.channelOwner);this.X.playbackPosition&&n.push(this.X.playbackPosition);this.X.localImageEntities&&n.push.apply(n,g.EJ(this.X.localImageEntities));this.X.downloadStatus&&n.push(this.X.downloadStatus);return[].concat(g.EJ(new Set(n)))};
g.y(NMS,A7);NMS.prototype.W=function(){return[]};
g.y(O1F,A7);O1F.prototype.W=function(){return[]};
g.y(g4s,A7);g4s.prototype.W=function(){return[]};
g.y(ecs,A7);ecs.prototype.W=function(){return[]};
g.y(E4L,A7);E4L.prototype.W=function(){return[]};
g.y(hcL,A7);hcL.prototype.W=function(){return[]};
g.y(W5A,A7);W5A.prototype.W=function(){return[]};
g.y(ybF,A7);ybF.prototype.W=function(){return[]};
g.y(s9G,A7);s9G.prototype.W=function(){return[]};
g.y(X5O,A7);X5O.prototype.W=function(){return[]};
g.y(j9G,A7);j9G.prototype.W=function(){return[]};
g.y(SNn,A7);SNn.prototype.W=function(){return[]};
g.y(I5w,A7);I5w.prototype.W=function(){var n=[];this.X.trackDownloadMetadatas&&n.push.apply(n,g.EJ(this.X.trackDownloadMetadatas));return[].concat(g.EJ(new Set(n)))};
g.y(f5n,A7);
f5n.prototype.W=function(){var n=[];this.X.downloadedTracks&&n.push.apply(n,g.EJ(this.X.downloadedTracks));this.X.smartDownloadedTracks&&n.push.apply(n,g.EJ(this.X.smartDownloadedTracks));this.X.downloadedEpisodes&&n.push.apply(n,g.EJ(this.X.downloadedEpisodes));this.X.downloadedAlbumReleases&&n.push.apply(n,g.EJ(this.X.downloadedAlbumReleases));this.X.smartDownloadedAlbumReleases&&n.push.apply(n,g.EJ(this.X.smartDownloadedAlbumReleases));this.X.downloadedPlaylists&&n.push.apply(n,g.EJ(this.X.downloadedPlaylists));this.X.smartDownloadedPlaylists&&
n.push.apply(n,g.EJ(this.X.smartDownloadedPlaylists));this.X.metadataOnlyTracks&&n.push.apply(n,g.EJ(this.X.metadataOnlyTracks));return[].concat(g.EJ(new Set(n)))};
g.y(H1G,A7);H1G.prototype.W=function(){var n=[];this.X.trackDownloadMetadatas&&n.push.apply(n,g.EJ(this.X.trackDownloadMetadatas));return[].concat(g.EJ(new Set(n)))};
g.y(L5K,A7);L5K.prototype.W=function(){var n=[];this.X.playbackData&&n.push(this.X.playbackData);this.X.localImageEntities&&n.push.apply(n,g.EJ(this.X.localImageEntities));this.X.videoDownloadContextEntity&&n.push(this.X.videoDownloadContextEntity);return[].concat(g.EJ(new Set(n)))};
g.y(Pgn,A7);Pgn.prototype.W=function(){var n=[];this.X.musicLibraryStatusEntity&&n.push(this.X.musicLibraryStatusEntity);this.X.primaryArtists&&n.push.apply(n,g.EJ(this.X.primaryArtists));this.X.details&&n.push(this.X.details);this.X.userDetails&&n.push(this.X.userDetails);this.X.tracks&&n.push.apply(n,g.EJ(this.X.tracks));this.X.share&&n.push(this.X.share);this.X.downloadMetadata&&n.push(this.X.downloadMetadata);this.X.refresh&&n.push(this.X.refresh);return[].concat(g.EJ(new Set(n)))};
g.y(v4n,A7);v4n.prototype.W=function(){var n=[];this.X.albumRelease&&n.push(this.X.albumRelease);this.X.tracks&&n.push.apply(n,g.EJ(this.X.tracks));return[].concat(g.EJ(new Set(n)))};
g.y(TMG,A7);TMG.prototype.W=function(){var n=[];this.X.albumRelease&&n.push(this.X.albumRelease);return[].concat(g.EJ(new Set(n)))};
g.y(l5S,A7);l5S.prototype.W=function(){var n=[];this.X.details&&n.push(this.X.details);this.X.userDetails&&n.push(this.X.userDetails);return[].concat(g.EJ(new Set(n)))};
g.y(Ues,A7);Ues.prototype.W=function(){var n=[];this.X.parentArtist&&n.push(this.X.parentArtist);return[].concat(g.EJ(new Set(n)))};
g.y(uGL,A7);uGL.prototype.W=function(){var n=[];this.X.parentArtist&&n.push(this.X.parentArtist);return[].concat(g.EJ(new Set(n)))};
g.y(BMs,A7);BMs.prototype.W=function(){return[]};
g.y(DeL,A7);DeL.prototype.W=function(){return[]};
g.y(AbK,Dp);AbK.prototype.W=function(){var n=[];this.X.creatorEntity&&n.push(this.X.creatorEntity);return[].concat(g.EJ(new Set(n)))};
g.y(meS,A7);
meS.prototype.W=function(){var n=[];this.X.tracks&&n.push.apply(n,g.EJ(this.X.tracks));this.X.refresh&&n.push(this.X.refresh);this.X.musicLibraryStatusEntity&&n.push(this.X.musicLibraryStatusEntity);this.X.details&&n.push(this.X.details);this.X.downloadMetadata&&n.push(this.X.downloadMetadata);this.X.sideloadMetadata&&n.push(this.X.sideloadMetadata);this.X.userDetails&&n.push(this.X.userDetails);this.X.entryCollection&&n.push(this.X.entryCollection);this.X.share&&n.push(this.X.share);this.X.podcastShowAdditionalMetadata&&
n.push.apply(n,g.EJ((new AbK(this.X.podcastShowAdditionalMetadata)).W()));return[].concat(g.EJ(new Set(n)))};
g.y($eS,A7);$eS.prototype.W=function(){return[]};
g.y(F5F,A7);
F5F.prototype.W=function(){var n=[];this.X.musicLibraryStatusEntity&&n.push(this.X.musicLibraryStatusEntity);this.X.artists&&n.push.apply(n,g.EJ(this.X.artists));this.X.audioModeVersion&&n.push(this.X.audioModeVersion);this.X.videoModeVersion&&n.push(this.X.videoModeVersion);this.X.userDetails&&n.push(this.X.userDetails);this.X.details&&n.push(this.X.details);this.X.albumRelease&&n.push(this.X.albumRelease);this.X.share&&n.push(this.X.share);this.X.libraryEdit&&n.push(this.X.libraryEdit);this.X.downloadMetadata&&
n.push(this.X.downloadMetadata);this.X.playbackPosition&&n.push(this.X.playbackPosition);this.X.lyrics&&n.push(this.X.lyrics);return[].concat(g.EJ(new Set(n)))};
g.y(Z1s,A7);Z1s.prototype.W=function(){var n=[];this.X.parentTrack&&n.push(this.X.parentTrack);return[].concat(g.EJ(new Set(n)))};
g.y(a5T,A7);a5T.prototype.W=function(){var n=[];this.X.parentTrack&&n.push(this.X.parentTrack);return[].concat(g.EJ(new Set(n)))};
g.y(RcF,A7);RcF.prototype.W=function(){return[]};
g.y(o4K,A7);o4K.prototype.W=function(){return[]};
g.y(w5K,A7);w5K.prototype.W=function(){return[]};
g.y(zcd,A7);zcd.prototype.W=function(){return[]};
g.y(Jbn,A7);Jbn.prototype.W=function(){var n=[];this.X.transfer&&n.push(this.X.transfer);this.X.adsPlaybackData&&n.push.apply(n,g.EJ(this.X.adsPlaybackData));this.X.drmLicense&&n.push(this.X.drmLicense);this.X.offlineVideoPolicy&&n.push(this.X.offlineVideoPolicy);this.X.videoDownloadContextEntity&&n.push(this.X.videoDownloadContextEntity);return[].concat(g.EJ(new Set(n)))};
g.y(VgD,A7);VgD.prototype.W=function(){return[]};
g.y(CgQ,A7);CgQ.prototype.W=function(){var n=[];this.X.offlineVideoStreams&&n.push.apply(n,g.EJ(this.X.offlineVideoStreams));this.X.captionTrack&&n.push.apply(n,g.EJ(this.X.captionTrack));return[].concat(g.EJ(new Set(n)))};
g.y(rbD,A7);rbD.prototype.W=function(){return[]};
g.y(xeT,A7);xeT.prototype.W=function(){return[]};
g.y(Q9L,A7);Q9L.prototype.W=function(){return[]};
g.y(p5F,A7);p5F.prototype.W=function(){return[]};
g.y(nCF,A7);nCF.prototype.W=function(){return[]};
g.y(qow,A7);qow.prototype.W=function(){return[]};
g.y(MPF,A7);MPF.prototype.W=function(){return[]};
g.y(iYs,A7);iYs.prototype.W=function(){return[]};
g.y(tPS,A7);tPS.prototype.W=function(){return[]};
g.y(cQO,A7);cQO.prototype.W=function(){return[]};
g.y(YoG,A7);YoG.prototype.W=function(){return[]};
g.y(GMQ,A7);GMQ.prototype.W=function(){return[]};
g.y(KRG,A7);KRG.prototype.W=function(){return[]};
g.y(kMd,A7);kMd.prototype.W=function(){return[]};
g.y(bYT,A7);bYT.prototype.W=function(){return[]};
g.y(dAO,A7);dAO.prototype.W=function(){return[]};
g.y(NQF,A7);NQF.prototype.W=function(){return[]};
g.y(OYs,A7);OYs.prototype.W=function(){return[]};
g.y(gCF,A7);gCF.prototype.W=function(){return[]};
g.y(eMT,A7);eMT.prototype.W=function(){return[]};
g.y(ECn,A7);ECn.prototype.W=function(){return[]};
g.y(hMD,A7);hMD.prototype.W=function(){return[]};
var Eis=["browse","music/browse","unplugged/browse"],XXO=["offline/playlist_sync_check"],GSF=["offline"],hQn=["offline/offline_video_playback_position_sync"],ysn=["offline/get_playback_data_entity"],mF;$U.getInstance=function(){return g.u(function(n){return n.return(new Promise(function(q){g.VW().then(function(M){M?($U.instance||($U.instance=new $U(M)),q($U.instance)):q(void 0)})}))})};
$U.prototype.get=function(n){var q=this,M,t,c;return g.u(function(Y){if(Y.X==1)return g.U(Y,X2T(q.token),2);if(Y.X!=3)return M=Y.W,g.U(Y,M.get("prefs",n),3);t=Y.W;if(!t)return Y.return();c=(0,g.jt)();return t.expirationTimestampMs<=c?Y.return():Y.return(t.value)})};
$U.prototype.set=function(n,q,M){M=M===void 0?31536E3:M;var t=this,c,Y,G;return g.u(function(k){if(k.X==1)return c=(0,g.jt)(),Y={key:n,value:q,expirationTimestampMs:c+M*1E3},g.U(k,X2T(t.token),2);G=k.W;return g.U(k,g.v6(G,"prefs",Y),0)})};
$U.prototype.remove=function(n){var q=this,M;return g.u(function(t){if(t.X==1)return g.U(t,X2T(q.token),2);M=t.W;return g.U(t,M.delete("prefs",n),0)})};
g.y(Fk,g.aE);g.y(Zp,HYn);Zp.prototype.Z=function(n,q){q=P$G(q);n=(new TextEncoder).encode(JSON.stringify(n));return this.X.encrypt(n,q)};
Zp.prototype.W=function(n,q){if(!(n instanceof Uint8Array))throw j8w(1);var M=new TextDecoder;q=P$G(q);n=this.X.decrypt(n,q);return JSON.parse(M.decode(n))};
var vCK={accountLinkStatusEntity:a8w,booleanEntity:UOF,buttonEntity:bYT,captionTrack:RcF,channelHandle:vbF,chipEntity:MPF,commerceAcquisitionClientPayloadEntity:NQF,commerceCartListEntity:OYs,contextNoteFeedEntityPayload:TlF,contextNoteUserRatingEntityPayload:l8Q,continuationTokenEntity:i1F,downloadQualityPickerEntity:zwd,downloadsPageRefreshTokenEntity:VZF,downloadsPageViewConfigurationEntity:NMS,downloadStatusEntity:Jts,dismissState:iYs,sfvAudioItemCurrentlyPlayingEntity:p5F,emojiFountainDataEntity:KRG,
emojiCustomizationSetEntity:GMQ,fakeChannel:BlA,fakePlaylist:DOD,fakePlaylistEntryCollection:mOQ,fakeVideo:$Os,fakeVideoDescription:FJF,featuredProductsEntity:X5O,flowStateEntity:ZCF,iconBadgeEntity:gCF,interstitialInteractionStateEntity:obn,likeButtonAnimationEntity:O1F,liveChatPollStateEntity:wLS,dataFreshnessEntity:YoG,liveViewerLeaderboardChatEntryPointStateEntity:xeT,liveViewerLeaderboardPointsEntity:Q9L,liveReactionsDataEntity:kMd,logoEntity:RwD,macroMarkerEntity:g4s,mainDownloadsLibraryEntity:C9n,
mainDownloadsListEntity:xOF,mainPlaylistDownloadStateEntity:Qqd,mainPlaylistEntity:tgO,mainPlaylistVideoEntity:cbs,mainVideoDownloadStateEntity:pLs,mainVideoEntity:kDD,markersEngagementPanelSyncEntity:ecs,markersVisibilityOverrideEntity:E4L,musicAlbumReleaseDetail:v4n,musicAlbumReleaseDownloadMetadataEntity:I5w,musicAlbumRelease:Pgn,musicAlbumReleaseUserDetail:TMG,musicArtistDetail:Ues,musicArtist:l5S,musicArtistUserDetail:uGL,musicDownloadsLibraryEntity:f5n,musicLibraryEdit:BMs,musicLibraryStatusEntity:DeL,
musicPlaylist:meS,musicPlaylistDownloadMetadataEntity:H1G,musicShare:$eS,musicTrackDetail:Z1s,musicTrackDownloadMetadataEntity:L5K,musicTrack:F5F,musicTrackUserDetail:a5T,offlineOrchestrationActionWrapperEntity:o4K,offlineVideoPolicy:w5K,offlineVideoStreams:zcd,offlineabilityEntity:n4Q,orchestrationWebSamplingEntity:qNs,pageHeaderEntity:tPS,pdpStateEntity:eMT,pinnedProductEntity:j9G,playbackData:Jbn,playerStateEntity:hcL,quantityIncrementerEntity:ECn,refresh:VgD,saveToPlaylistListEntity:nCF,selectedChipIndexEntityPayload:W5A,
settingEntity:qow,stringEntity:u7Q,suggestedFeedbackChipStateEntity:ybF,transfer:CgQ,trendingOfferEntity:SNn,videoDownloadContextEntity:rbD,videoOverviewAsyncDataEntity:hMD,videoPlaybackPositionEntity:dAO,votingEntity:cQO,ytMainChannelEntity:b1L,youchatPendingResponseEntity:s9G,ytMainDownloadedVideoEntity:Mgd,ytMainVideoEntity:den};g.y(J7,HYn);J7.prototype.Z=function(n){return n};
J7.prototype.W=function(n){if(n instanceof Uint8Array)throw j8w(0);return n};
g.y(Vq,g.F);Vq.prototype.observe=function(n){var q=this;this.observers.push(n);return function(){var M=q.observers.indexOf(n);M>=0&&q.observers.splice(M,1)}};
Vq.prototype.W=function(n){oCw(this,n.data)};
Vq.prototype.ut=function(){this.channel.close()};
var C$F,JdL=new g.Xa("elementsCommand");var SD=new g.Xa("entityBatchUpdate");var BEL=new g.Xa("downloadStatusEntity");var xww=new g.Xa("mainPlaylistEntityActionMetadata");var CG=new g.Xa("mainVideoEntityActionMetadata");var YXd=new g.Xa("musicPlaylistEntityActionMetadata");var l_s=new g.Xa("musicTrackEntityActionMetadata");var NOw=new g.Xa("localImageEntityActionMetadata");var B1=new g.Xa("playbackDataActionMetadata");var VAK=new g.Xa("transferEntityActionMetadata");var UNO=new g.Xa("videoPlaybackPositionEntityActionMetadata");var bOG;new g.NA;new g.NA;eBQ.prototype.request=function(n,q,M){q=q===void 0?{}:q;return this.locks.request(n,q,function(t){return M(t)})};var Mx=g.pa.caches,qx,sDF;nG.prototype.open=function(n){return Mx.open(WXO(n))};
nG.prototype.has=function(n){return Mx.has(WXO(n))};
nG.prototype.delete=function(n){return Mx.delete(WXO(n))};
nG.prototype.match=function(n,q){var M=this,t,c,Y,G,k,b;return g.u(function(d){switch(d.X){case 1:return g.U(d,M.keys(),2);case 2:t=d.W,c=g.S(t),Y=c.next();case 3:if(Y.done){d.Fy(5);break}G=Y.value;return g.U(d,M.open(G),6);case 6:return k=d.W,g.U(d,k.match(n,q),7);case 7:if(b=d.W)return d.return(b);Y=c.next();d.Fy(3);break;case 5:return d.return()}})};
g.y(hBK,nG);hBK.prototype.keys=function(){var n,q,M,t,c,Y,G,k,b;return g.u(function(d){if(d.X==1)return n=[],q=g.RE("CacheStorage keys"),g.U(d,Mx.keys(),2);M=d.W;t=g.S(M);for(c=t.next();!c.done;c=t.next()){Y=c.value;var N=Y.indexOf(":");G=N===-1?{DL:Y}:{DL:Y.substring(0,N),datasyncId:Y.substring(N+1)};k=G.DL;b=G.datasyncId;b===q&&n.push(k)}return d.return(n)})};g.y(t6,g.F);t6.prototype.Z=function(n){this.api.Km("onOfflineOperationFailure",n.data)};
t6.prototype.J=function(n){this.api.publish("offlinetransferpause",n.data)};
t6.prototype.ut=function(){var n;(n=this.X)==null||n.close();var q;(q=this.W)==null||q.close()};S$O.prototype.Lu=function(){this.X&&Y_(this)};
S$O.prototype.Rb=function(){this.W&&this.W.resolve();this.Z=this.X=!1;this.U()};var brd=["OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"];var oDL="captionTrack downloadStatusEntity ytMainChannelEntity mainPlaylistEntity mainPlaylistDownloadStateEntity mainPlaylistVideoEntity mainVideoEntity mainVideoDownloadStateEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity videoPlaybackPositionEntity".split(" ");var qXK="downloadStatusEntity musicAlbumRelease musicDownloadsLibraryEntity musicPlaylist musicTrack musicTrackDownloadMetadataEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity".split(" ");g.y(SXF,lH);SXF.prototype.W=function(n){return bH(n)?H4Q(this,n):dR(n)?viT(this,n):Promise.reject(Error("Unsupported action type: "+n.actionType))};g.y(TYF,lH);TYF.prototype.W=function(n){return dR(n)?lHO(this,n):uWT(n)?uAQ(this,n):Nx(n)?BYD(this,n):Promise.reject(Error("Unsupported action type: "+n.actionType))};g.W=DNA.prototype;g.W.Vis=function(n){var q=this,M,t,c,Y;return g.u(function(G){if(!g.C(n.state,128))return G.Fy(0);M=n.state.Vr;var k=(t=M)==null?void 0:t.errorCode,b=(c=M)==null?void 0:c.Rl;Y=k==="net.connect"&&b===1?"TRANSFER_FAILURE_REASON_NETWORK_LOST":(k==null?0:k.startsWith("net."))?"TRANSFER_FAILURE_REASON_NETWORK":"TRANSFER_FAILURE_REASON_INTERNAL";return g.U(G,q.vr(q.player.getVideoData().videoId,Y),0)})};
g.W.vr=function(n,q){var M=this;return g.u(function(t){if(t.X==1){if(M.W)return t.return();M.W=!0;return q==="TRANSFER_FAILURE_REASON_NETWORK_LOST"?(mg(M,n,!1,!0),t.Fy(0)):g.U(t,A6(M,n),3)}g.GT(n,4);return g.U(t,M.X.vr(q),0)})};
g.W.gb=function(n){n.status===2?(n.status!==this.Z&&(lTs(this.X),g.GT(n.videoId,2)),n.An&&AoQ(this.X,n.videoId,n.An)):n.status===4?(A6(this,n.videoId),this.vr(n.videoId,n.MR?"TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":"TRANSFER_FAILURE_REASON_INTERNAL")):n.status===1&&DwS(this.X);this.Z=n.status;this.api.Km("localmediachange",{videoId:n.videoId,status:n.status})};
g.W.TB=function(){var n=this,q;return g.u(function(M){if(M.X==1){if(n.W)return M.return();n.W=!0;q=n.player.getVideoData().videoId;return g.U(M,A6(n,q),2)}return g.U(M,n.X.TB(),0)})};
g.W.qE=function(n){switch(n){case "HD_1080":return"hd1080";case "HD":return"hd720";case "SD":return"large";case "LD":return"tiny";default:return"hd720"}};
g.W.D=function(n){return this.api.T().D(n)};g.y(RQS,lH);RQS.prototype.W=function(n){return bH(n)?wXd(this,n):dR(n)?zQK(this,n):uWT(n)?Jss(this,n):Promise.reject(Error("Unsupported action type: "+n.actionType))};pXT.prototype.X=function(n,q){var M=n.action.actionMetadata.priority-q.action.actionMetadata.priority;M===0&&(n.X<q.X?M=-1:n.X>q.X&&(M=1));return M};g.y($_,g.F);$_.prototype.ut=function(){this.U&&this.U();g.F.prototype.ut.call(this)};
$_.prototype.createAction=function(n,q){var M=g.Co(n.entityKey).entityType,t=g.Ec(16);return new h6(M,t,n,q.actionId,q.rootActionId)};
$_.prototype.RL=function(n){var q=this,M,t,c,Y,G,k,b,d,N;return g.u(function(O){if(O.X==1){if(q.qm())return O.return();t=(M=n.offlineOrchestrationActionWrapperEntity)!=null?M:new Set;c=[];Y=g.S(t);for(G=Y.next();!G.done;G=Y.next())k=G.value,b=g.Co(k),d=b.entityId,MUD(q.X,d)||c.push(k);return g.U(O,Orn(q,c),2)}N=O.W;return g.U(O,NSd(q,N),0)})};
$_.prototype.retry=function(){var n=this;return g.u(function(q){return g.U(q,gdQ(n),0)})};EdF.prototype.VP=function(n,q){q=q===void 0?!0:q;var M=this,t,c,Y,G,k,b,d,N;return g.u(function(O){switch(O.X){case 1:if(!M.X)return O.return();t=[];c=g.iy(M.X.W,q);Y=[];for(G={m9:0};G.m9<c.length;G={m9:G.m9},G.m9++)k=c[G.m9],b=M.X.KU(k,"json3"),d=g.fp(b,{withCredentials:!0,format:"RAW"},3,500).then(function(e){return function(E){E={metadata:g.z3(c[e.m9]),trackData:E.xhr.responseText};Y.push(E)}}(G)).M9(function(e){iH("Caption fetch error",e)}),t.push(d);
return g.U(O,P9S(t),2);case 2:return g.Ij(O,3),g.U(O,iOA(n,Y),5);case 5:g.vd(O,0);break;case 3:N=g.TU(O),iH("Caption DB transaction error",N),g.Sk(O)}})};g.y(FZ,g.F);FZ.prototype.ut=function(){this.W&&this.W();g.F.prototype.ut.call(this)};
FZ.prototype.Z=function(n){var q=this,M,t,c,Y,G,k,b,d;return g.u(function(N){t=(M=n.transfer)!=null?M:new Set;c=[];Y=g.S(t);for(G=Y.next();!G.done;G=Y.next())k=G.value,b=g.Co(k),d=b.entityId,c.push(d);return c.length===0?N.return():g.U(N,yoQ(q,c),0)})};g.y(ITQ,g.F);g.W=ITQ.prototype;g.W.ut=function(){this.wJ&&this.wJ();this.jX.dispose();this.J.dispose();this.SX&&g.xb(this.C.l1,this.SX);this.nm&&g.xb(this.C.l1,this.nm);g.F.prototype.ut.call(this)};
g.W.gBJ=function(n){var q=this,M,t,c;return g.u(function(Y){switch(Y.X){case 1:M=g.rb(n,"transfer");if(q.X&&M===q.X.key){mg(q.N,q.S,!0);q.J.stop();Y.Fy(0);break}return g.U(Y,CR(q.W,{mode:"readwrite",fd:!0},function(G){return av(G,M,"transfer").then(function(k){if(k&&k.transferState!=="TRANSFER_STATE_COMPLETE"&&k.transferState!=="TRANSFER_STATE_FAILED")return k.transferState="TRANSFER_STATE_PAUSED_BY_USER",ws(G,k,"transfer").then(function(){return k})})}),3);
case 3:t=Y.W;if(!t){Y.Fy(0);break}if(!n||!q.Z){Y.Fy(5);break}return g.U(Y,OB(n,q.Z,q.W,"DOWNLOAD_STATE_PAUSED"),5);case 5:return g.U(Y,RC(q,n),7);case 7:c=Y.W,lDn({videoId:n,Qw:t,offlineModeType:c}),g.Sk(Y)}})};
g.W.dVd=function(){var n=this;if(this.X&&this.S){mg(this.N,this.S,!1);var q=this.X,M=(q==null?0:q.key)?g.Co(q.key).entityId:"";M&&this.Z&&(new Promise(function(t,c){OB(M,n.Z,n.W,"DOWNLOAD_STATE_PAUSED").catch(function(Y){c(Y)})})).catch(function(t){iH("Download state setting error",t)})}this.J.stop()};
g.W.ZQ=function(){this.X?L7F(this,this.X):aC(this)};
g.W.mW=function(n){var q=this;return g.u(function(M){switch(M.X){case 1:if(!q.X){M.Fy(2);break}if(q.X.transferState==="TRANSFER_STATE_COMPLETE"||q.X.transferState==="TRANSFER_STATE_FAILED"||!n.transfer||!n.transfer.has(q.X.key)){M.Fy(3);break}return g.U(M,xU(q.W,q.X.key,"transfer"),4);case 4:q.X=M.W;if(q.X){M.Fy(3);break}return g.U(M,PWA(q),3);case 3:if(q.X)return M.return();case 2:return g.U(M,aC(q),0)}})};
g.W.vr=function(n,q){var M=this,t,c,Y,G,k;return g.u(function(b){switch(b.X){case 1:if(!M.X){oC(M,"onTransferFailure: "+n);b.Fy(2);break}t=M.X;Y=((c=t)==null?0:c.key)?g.Co(t.key).entityId:"";a:switch(n){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_PLAYABILITY":case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":var d=!1;break a;default:d=!0}return d&&mwT(M)?g.U(b,wR(M,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),8):g.U(b,
$ws(M,n),5);case 5:if(!Y||!M.Z){b.Fy(2);break}return g.U(b,OB(Y,M.Z,M.W,"DOWNLOAD_STATE_FAILED"),2);case 8:return g.U(b,RC(M,Y),9);case 9:G=b.W;KG({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_RETRY"},{videoId:Y,Qw:t,offlineModeType:G});if(!Y||!M.Z){b.Fy(2);break}return g.U(b,OB(Y,M.Z,M.W,"DOWNLOAD_STATE_RETRYABLE_FAILURE"),2);case 2:ZC(M),k=aC(M,!0),q&&q(k),g.Sk(b)}})};
g.W.TB=function(n){var q=this,M,t,c,Y,G,k,b,d,N,O,e,E;return g.u(function(h){switch(h.X){case 1:if(!q.X){oC(q,"onMaybeTransferStreamsExpired");h.Fy(2);break}return mwT(q)?g.U(h,wR(q,"TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"),9):g.U(h,$ws(q,"TRANSFER_FAILURE_REASON_STREAM_MISSING"),5);case 5:if(!q.Z){h.Fy(2);break}M=q.X;c=((t=M)==null?0:t.key)?g.Co(M.key).entityId:"";if(!c){h.Fy(2);break}return g.U(h,OB(c,q.Z,q.W,"DOWNLOAD_STATE_FAILED"),2);case 9:return q.X||oC(q,"onMaybeTransferStreamsExpiredRetryAttempting"),
Y=q.X,k=((G=Y)==null?0:G.key)?g.Co(Y.key).entityId:"",g.U(h,RC(q,k),10);case 10:return b=h.W,KG({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_PLAYER_RESPONSE_EXPIRATION"},{videoId:k,Qw:Y,offlineModeType:b}),d=mbd(),g.uo(d,B1,{isEnqueuedForExpiredStreamUrlRefetch:!0}),N=g.rb(k,"playbackData"),O={actionType:"OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",entityKey:N,actionMetadata:d},e=yF(new h6("playbackData",k,O)),g.U(h,rs(q.W,e,"offlineOrchestrationActionWrapperEntity"),2);case 2:ZC(q),E=aC(q,!0),
n&&n(E),g.Sk(h)}})};
var R_d={},F7D=(R_d.TRANSFER_STATE_TRANSFERRING=1,R_d.TRANSFER_STATE_TRANSFER_IN_QUEUE=2,R_d);g.W=z9.prototype;g.W.CB=function(){return this.S.promise};
g.W.Ub=function(){if(this.W&&this.N)return this.S.promise;Rks(this).then(this.S.resolve).catch(this.S.reject);return this.S.promise};
g.W.t0=function(n){var q={};return q.playbackData=new SXF(n,this.Q1,this.X),q.transfer=new RQS(n,this.Q1),q.videoPlaybackPositionEntity=new TYF(n,this.Q1),q};
g.W.WV=function(){var n=this;return g.u(function(q){return n.W?g.U(q,fTQ(n.W),0):q.Fy(0)})};
g.W.vV=function(){var n=this,q,M;return g.u(function(t){if(t.X==1)return n.W||n.N?g.U(t,n.CB(),2):t.return();n.B!==void 0&&(g.OH(n.B),n.B=void 0);n.J!==void 0&&(g.OH(n.J),n.J=void 0);(q=n.W)==null||q.dispose();n.W=void 0;(M=n.N)==null||M.dispose();n.N=void 0;n.api.Km("onOrchestrationLostLeader");n.S=new g.NA;g.Sk(t)})};
g.W.isOrchestrationLeader=function(){return this.Z.X};
g.W.ze=function(){return g.u(function(n){return n.return(!1)})};
g.W.l8=function(n){var q=this.X;q.api.publish("offlinetransferpause",n);var M;(M=q.W)==null||M.postMessage(n)};
g.W.ZQ=function(n){var q,M;return g.u(function(t){if(t.X==1)return g.U(t,pR(),2);q=t.W;if(!q)return t.return();M=g.rb(n,"transfer");return g.U(t,CR(q,{mode:"readwrite",fd:!0},function(c){var Y=av(c,M,"transfer"),G=av(c,g.rb(n,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.W6.all([Y,G]).then(function(k){k=g.S(k);var b=k.next().value;var d=k.next().value;return b&&b.transferState==="TRANSFER_STATE_PAUSED_BY_USER"?(b.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE",ws(c,b,"transfer").then(function(){KG({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_USER_RESUME",
statusType:"USER_RESUMED"},{videoId:n,Qw:b,offlineModeType:d==null?void 0:d.offlineModeType});return g.W6.resolve(null)})):g.W6.resolve(null)})}),0)})};
g.W.H7=function(n){n=n===void 0?43200:n;var q=this,M,t,c,Y,G,k,b,d;return g.u(function(N){if(N.X==1)return q.C.nT()?g.U(N,pR(),2):N.return(ods());if(N.X!=3){M=N.W;if(!M)return N.return([]);t=Date.now()/1E3;return g.U(N,Qq(M,"offlineVideoPolicy"),3)}c=N.W;Y=[];G=g.S(c);for(k=G.next();!k.done;k=G.next())b=k.value,Number(b.lastUpdatedTimestampSeconds)+n<=t&&(d=g.Co(b.key).entityId,Y.push(d));return Y.length?N.return(J6(q,Y,q.U,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH")):N.return([])})};
g.W.deleteAll=function(){return J6(this,["!*$_ALL_ENTITIES_!*$"],this.U,"OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",{offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_USER_INITIATED"}})};
g.W.refreshAllStaleEntities=function(n){var q=this;return g.u(function(M){return M.X==1?g.U(M,q.H7(n),2):M.return(M.W)})};
g.W.setUpPositionSyncInterval=function(n){var q=this;this.J!==void 0&&(g.OH(this.J),this.J=void 0);var M=n!=null?n:864E5;this.J=g.dO(function(){q.BM(M)},M)};
g.W.BM=function(n){var q=this,M,t,c,Y,G,k;return g.u(function(b){switch(b.X){case 1:return g.Ij(b,2),g.U(b,$U.getInstance(),4);case 4:M=b.W;if(!M)throw Error("prefStorage is undefined");return g.U(b,M.get("psi"),5);case 5:t=b.W;Y=((c=t)==null?0:c.bC)?Number(t.bC)/1E3:0;G=Date.now();if(!(Y+n<=G)){b.Fy(6);break}return g.U(b,J6(q,["!*$_ALL_ENTITIES_!*$"],"videoPlaybackPositionEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"),6);case 6:g.vd(b,0);break;case 2:k=g.TU(b),iH("Offline manager error",k),
g.Sk(b)}})};
g.W.M$=function(){var n=this,q,M,t,c,Y,G,k;return g.u(function(b){if(b.X==1)return g.U(b,pR(),2);if(b.X!=3)return(q=b.W)?g.U(b,Qq(q,"transfer"),3):b.return([]);M=b.W;t=[];c=g.S(M);for(Y=c.next();!Y.done;Y=c.next())G=Y.value,G.transferState==="TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"&&G.key&&(k=g.Co(G.key).entityId,t.push(k));return b.return(zkS(n,t))})};
g.W.QE=function(){return g.u(function(n){return n.return([])})};
g.W.D_=function(){return g.u(function(n){g.Sk(n)})};
g.W.r5=function(){return g.u(function(n){g.Sk(n)})};g.y(JoA,lH);JoA.prototype.W=function(n){return bH(n)?roT(this,n):dR(n)?QZO(this,n):Nx(n)?pAQ(this,n):Promise.reject(Error("Unsupported action type: "+n.actionType))};
var VF=[10];g.y(t6G,lH);t6G.prototype.W=function(n){return bH(n)?GHQ(this,n):dR(n)?K_w(this,n):Nx(n)?kHT(this,n):Promise.reject(Error("Unsupported action type: "+n.actionType))};
var YHD=[10];g.y(dss,lH);dss.prototype.W=function(n){return dR(n)?OpD(this,n):Promise.reject(Error("Unsupported action type: "+n.actionType))};g.y(geO,z9);g.W=geO.prototype;g.W.t0=function(n){var q=z9.prototype.t0.call(this,n);q.mainVideoEntity=new t6G(n,this.Q1,this.X);q.mainPlaylistEntity=new JoA(n,this.Q1,this.X);q.mainDownloadsListEntity=new dss(n,this.Q1,this.X);return q};
g.W.refreshAllStaleEntities=function(n,q){var M=this,t,c,Y,G,k,b,d,N,O,e,E;return g.u(function(h){switch(h.X){case 1:t=[];if(!M.Q1.D("web_player_offline_playlist_auto_refresh")){h.Fy(2);break}return g.U(h,e_F(M,n,q),3);case 3:t=h.W;case 2:return g.U(h,$U.getInstance(),4);case 4:return c=h.W,g.U(h,(Y=c)==null?void 0:Y.get("sdois"),5);case 5:return G=h.W,g.U(h,(k=c)==null?void 0:k.get("lmqf"),6);case 6:b=h.W;if(!G){h.Fy(7);break}N=t;O=N.concat;return g.U(h,EeF(M,G,(d=b)!=null?d:"SD",n===0),8);case 8:t=
O.call(N,h.W);case 7:return e=t,E=e.concat,g.U(h,z9.prototype.refreshAllStaleEntities.call(M,n,q),9);case 9:return t=E.call(e,h.W),h.return(t)}})};
g.W.ze=function(n){var q,M,t,c,Y,G,k,b;return g.u(function(d){if(d.X==1)return g.U(d,pR(),2);if(d.X!=3)return(q=d.W)?g.U(d,xU(q,g.mj,"mainDownloadsListEntity"),3):d.return(!1);M=d.W;if((t=M)==null?0:(c=t.downloads)==null?0:c.length)for(Y=g.rb(n,"mainVideoEntity"),G=g.S(M.downloads),k=G.next();!k.done;k=G.next())if(b=k.value,b.videoItem===Y)return d.return(!0);return d.return(!1)})};
g.W.QE=function(){var n=this,q,M,t,c,Y,G,k,b;return g.u(function(d){if(d.X==1)return g.U(d,pR(),2);if(d.X!=3)return(q=d.W)?g.U(d,Qq(q,"downloadStatusEntity"),3):d.return([]);M=d.W;t=[];c=g.S(M);for(Y=c.next();!Y.done;Y=c.next())G=Y.value,G.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&G.key&&(k=g.Co(G.key).entityId,t.push(k));return t.length?(b={offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_USER_INITIATED"}},d.return(J6(n,t,"mainVideoEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
b))):d.return([])})};
g.W.r5=function(){var n;return g.u(function(q){return q.X==1?g.U(q,pR(),2):(n=q.W)?g.U(q,CR(n,{mode:"readwrite",fd:!0},function(M){return Rv(M,"mainVideoEntity").then(function(t){var c=[];t=g.S(t);for(var Y=t.next();!Y.done;Y=t.next()){Y=Y.value;var G=void 0;(G=Y.userState)!=null&&G.playbackPosition||(G=g.Co(Y.key).entityId,G={key:g.rb(G,"videoPlaybackPositionEntity"),videoId:G,lastPlaybackPositionSeconds:"0"},c.push(ws(M,G,"videoPlaybackPositionEntity")),Y.userState={playbackPosition:G.key},c.push(ws(M,
Y,"mainVideoEntity")))}return g.W6.all(c)})}),0):q.return()})};
g.W.D_=function(){var n,q,M,t,c,Y,G,k,b,d,N,O,e,E,h,I,L,T,v,B,m,a,x,V,bf,Ka,dd,gd,MR,lf,rd,gT,ND,V1,uf,K3,$w,zL;return g.u(function(ku){if(ku.X==1)return g.U(ku,pR(),2);if(ku.X!=3){n=ku.W;if(!n)return ku.return();q=g.rb("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity");return g.U(ku,CR(n,{mode:"readonly",fd:!0},function(l){return g.W6.all([av(l,q,"mainDownloadsListEntity"),av(l,g.mj,"mainDownloadsListEntity"),Rv(l,"mainVideoEntity"),Rv(l,"mainPlaylistEntity")])}),3)}M=ku.W;
t=g.S(M);c=t.next().value;Y=t.next().value;G=t.next().value;k=t.next().value;b=c;d=Y;N=G;O=k;e=new Set;if((E=b)==null?0:(h=E.downloads)==null?0:h.length)for(I=g.S(b.downloads),L=I.next();!L.done;L=I.next())T=L.value,v=void 0,(B=(v=T.videoItem)!=null?v:T.playlistItem)&&e.add(B);if((m=d)==null?0:(a=m.downloads)==null?0:a.length)for(x=g.S(d.downloads),V=x.next();!V.done;V=x.next())bf=V.value,bf.videoItem&&e.add(bf.videoItem);Ka=new Set;dd=[];gd=g.S(O);for(MR=gd.next();!MR.done;MR=gd.next()){lf=MR.value;
if(lf.videos)for(rd=g.S(lf.videos),gT=rd.next();!gT.done;gT=rd.next())ND=gT.value,(V1=JSON.parse(g.Co(ND).entityId).videoId)&&Ka.add(V1);lf.key&&!e.has(lf.key)&&dd.push(lf.key)}uf=g.S(N);for(K3=uf.next();!K3.done;K3=uf.next())$w=K3.value,$w.key&&!e.has($w.key)&&(zL=g.Co($w.key).entityId,Ka.has(zL)||dd.push($w.key));return dd.length?g.U(ku,xbs(n,dd),0):ku.Fy(0)})};g.y(h_n,lH);h_n.prototype.W=function(n){return bH(n)?yPs(this,n):dR(n)?sNs(this,n):Nx(n)?XkL(this,n):Promise.reject(Error("Unsupported action type: "+n.actionType))};
var rR=[10];g.y(SHD,lH);SHD.prototype.W=function(n){return bH(n)?f_n(this,n):dR(n)?HpF(this,n):Nx(n)?L_D(this,n):Promise.reject(Error("Unsupported action type: "+n.actionType))};
var x_=[10];g.y(TOF,lH);TOF.prototype.W=function(n){return bH(n)?BOT(this,n):dR(n)?Dss(this,n):Nx(n)?APw(this,n):Promise.reject(Error("Unsupported action type: "+n.actionType))};
var u$T=[10];g.y(QF,z9);QF.prototype.t0=function(n){var q=z9.prototype.t0.call(this,n);q.musicTrack=new TOF(n,this.X);q.musicPlaylist=new SHD(n,this.X);q.musicAlbumRelease=new h_n(n,this.X);return q};
QF.prototype.refreshAllStaleEntities=function(n,q){var M=this,t,c,Y;return g.u(function(G){if(G.X==1)return g.U(G,$sG(M,n,q),2);if(G.X!=3)return c=t=G.W,Y=c.concat,g.U(G,z9.prototype.refreshAllStaleEntities.call(M,n,q),3);t=Y.call(c,G.W);return G.return(t)})};g.y(F_S,g.Ib);g.W=F_S.prototype;g.W.create=function(){var n=this;g.Z(this,this.events);if(g.fl(this.Q1))this.X=new geO(this.Q1,this.player);else if(g.BD(this.Q1)||g.Ll(this.Q1))this.X=new QF(this.Q1,this.player);this.events.V(this.player,"onPlaybackStartExternal",function(){n.Hl()});
this.events.V(this.player,"videodatachange",function(){n.Hl()});
this.Q1.D("html5_offline_playback_position_sync")&&this.events.V(this.player,"presentingplayerstatechange",this.RP)};
g.W.b1=function(){return!1};
g.W.vX=function(n,q,M,t){var c=this;return g.u(function(Y){return c.X?Y.return(J6(c.X,n,q,M,t)):Y.return(Promise.reject())})};
g.W.deleteAll=function(){return this.X.deleteAll()};
g.W.H7=function(n){return this.X.H7(n)};
g.W.refreshAllStaleEntities=function(n){return this.X.refreshAllStaleEntities(n)};
g.W.setUpPositionSyncInterval=function(n){this.X.setUpPositionSyncInterval(n)};
g.W.l8=function(n){this.X.l8(n)};
g.W.ZQ=function(n){return this.X.ZQ(n)};
g.W.Hl=function(){var n=this,q;return g.u(function(M){q=n.player.getVideoData();return g.s9(q)?ZpQ(q)&&n.W!==q.clientPlaybackNonce?g.U(M,a_s(n,q),0):M.Fy(0):M.return()})};
g.W.RP=function(n){var q=this,M,t,c,Y,G,k,b;return g.u(function(d){if(d.X==1)return M=q.player.getVideoData(),t=M.rZ,g.dU(n,2)||g.dU(n,512)?g.U(d,pR(),2):d.return();if(d.X!=3){c=d.W;if(!c)return iH("PES is undefined"),d.return();Y=M.videoId;return g.U(d,xU(c,g.rb(Y,"mainVideoEntity"),"mainVideoEntity"),3)}G=d.W;if(!G)return d.return();k=Math.floor(t).toString();b={videoPlaybackPositionEntityActionMetadata:{lastPlaybackPositionSeconds:k}};return g.U(d,q.vX([Y],"videoPlaybackPositionEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE",
b),0)})};
g.W.isOrchestrationLeader=function(){return this.X.isOrchestrationLeader()};
g.W.updateDownloadState=function(n,q){var M,t,c,Y;return g.u(function(G){if(G.X==1)return g.U(G,pR(),2);M=G.W;if(!M)return iH("PES is undefined"),G.return();t=g.Co(n);c=t.entityType;Y=t.entityId;return g.U(G,OB(Y,c,M,q,!0),0)})};g.SC("offline",F_S);})(_yt_player);
